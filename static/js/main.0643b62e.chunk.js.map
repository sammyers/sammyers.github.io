{"version":3,"sources":["state/game/types.ts","components/AnchorLink.tsx","state/players/utils.ts","state/players/selectors.ts","state/game/partialSelectors.ts","state/game/utils.ts","utils/labels.ts","state/prompts/prompts.ts","state/game/selectors.ts","utils/hooks.ts","components/ScoreBug.tsx","state/game/slice.ts","utils/common.ts","components/SettingsMenu.tsx","components/BasesPreview.tsx","components/TopBar.tsx","components/prompts/PromptAccordion.tsx","state/prompts/selectors.ts","components/prompts/PlateAppearancePreview.tsx","components/prompts/OptionSelector.tsx","state/prompts/slice.ts","components/prompts/subprompts/ContactPrompt.tsx","components/prompts/subprompts/FielderPrompt.tsx","components/prompts/panels/ContactPanel.tsx","components/prompts/subprompts/RunnerPrompt.tsx","components/prompts/HitPrompt.tsx","components/prompts/OutPrompt.tsx","components/prompts/SacrificeFlyPrompt.tsx","components/prompts/subprompts/OutOnPlayPrompt.tsx","components/prompts/FieldersChoicePrompt.tsx","components/prompts/DoublePlayPrompt.tsx","components/prompts/EventDetailPrompt.tsx","components/EventReporter.tsx","icons/base.svg","icons/home.svg","components/Bases.tsx","components/LineupPlayer.tsx","components/Lineup.tsx","components/Teams.tsx","state/stats/stats.ts","state/stats/selectors.ts","components/BoxScore.tsx","components/plays/Play.tsx","components/plays/HalfInningPlays.tsx","state/plays/plays.ts","state/plays/selectors.ts","components/plays/Plays.tsx","theme.ts","state/players/slice.ts","state/players/testData.ts","components/GameOver.tsx","components/App.tsx","state/store.ts","reportWebVitals.ts","serviceWorkerRegistration.ts","index.tsx"],"names":["HalfInning","TeamRole","BaseType","FieldingPosition","PlateAppearanceType","ContactType","GameStatus","AnchorLink","props","match","useRouteMatch","path","to","Anchor","color","as","colorProp","hasIcon","hasLabel","rest","formatShortName","firstName","lastName","getPlayer","state","playerId","players","getShortPlayerName","player","getAllPlayersList","createSelector","Object","values","getBattingTeam","halfInning","half","BOTTOM","HOME","AWAY","getBattingLineup","teams","battingTeam","lineup","getOnDeckBatter","atBat","batterId","lineupIndex","_","findIndex","id","length","allPositions","keys","shouldTeamUseFourOutfielders","getAvailablePositionsForTeam","team","filter","position","CENTER_FIELD","RIGHT_CENTER","LEFT_CENTER","includes","getBaseForRunner","runners","runnerId","findKey","runner","moveRunner","startBase","endBase","removeRunner","getNewBase","currentBase","numAdvanced","getPreviousBase","THIRD","SECOND","getNumBasesForPlateAppearance","paType","HOMERUN","TRIPLE","DOUBLE","SINGLE","WALK","getEndBaseForBatterRunner","FIELDERS_CHOICE","FIRST","getBaseNumber","base","mustRunnerAdvance","batterEndBase","prevBase","getSortedRunners","toPairs","sort","baseA","baseB","getLeadRunner","last","forEachRunner","callback","sortedPairs","forEachRight","getDefaultRunnersAfterPlateAppearance","runnersScored","newRunners","numBasesAdvanced","times","i","push","moveRunnersOnGroundBall","updateScore","runs","score","applyGameEvent","event","inning","outs","recordedPlay","gameState","runnersBattedIn","runnersAfter","scoreAfter","recordRunnersScored","battedIn","kind","getRunners","getCurrentBaseForRunner","success","type","size","newBaseRunners","SACRIFICE_FLY","runsScoredOnSacFly","runnersOutOnPlay","DOUBLE_PLAY","forEach","contactType","GROUNDER","OUT","outsOnBasepaths","basesTaken","gameHistory","formatShortBaseName","getPositionAbbreviation","PITCHER","CATCHER","FIRST_BASE","SECOND_BASE","THIRD_BASE","SHORTSTOP","LEFT_FIELD","RIGHT_FIELD","getPlateAppearanceLabel","getOutLabelFromContact","LAZY_FLY","LINE_DRIVE","LONG_FLY","POPUP","NONE","getHitLabelFromContact","getRunnerOptionLabel","option","attemptedAdvance","successfulAdvance","baseName","getOrdinalInning","suffix","inPlayContactOptions","ct","getContactOptionsForHit","contactTypes","map","label","getContactOptionsForOut","infieldPositions","getOutfieldPositions","fourOutfielders","getAllPositions","makeFielderOptions","positions","getFielderOptionsForContactType","hit","getRunnerOptions","expectedBases","allowScoring","leadRunner","getRunnerOptionsRecursive","runnerAhead","nextRunner","leadBase","trailingRunner","getTrailingRunner","options","bases","advancedOptions","flatten","getBasepathOutcomesForBases","possibleBases","inRange","getAvailableBases","defaultOption","nextBase","getTrailingRunnerOptions","outcome","currentOuts","getTeams","game","present","getNumOuts","getScore","getHalfInning","getInning","getCurrentBatter","doesFieldingTeamHaveFourOutfielders","getRunnerNames","mapValues","getBatterName","getPlayerPosition","find","getLineups","getPlayersNotInGame","allPlayers","lineups","allPlayersInGame","canStartGame","numAwayPlayers","numHomePlayers","Math","abs","getGameStatus","status","isGameInProgress","IN_PROGRESS","isGameOver","FINISHED","getPlateAppearanceOptions","notPossible","Set","add","has","getNextBatter","getInTheHoleBatter","getOnDeckBatterName","getInTheHoleBatterName","createPlateAppearancePromptSelector","contactOptions","getNextOptions","required","fielderOptions","runnerOptions","runnersScoredOptions","range","numScored","outOnPlayOptions","runnerIds","runnerOut","undefined","reverse","multiple","runnersOut","defaultRunnerPositions","runnersToBases","invert","getPlateAppearanceDetailPrompt","getGameHistory","getCurrentGameLength","gameLength","getMinGameLength","awayScore","homeScore","max","getMaxGameLength","isGameInExtraInnings","getFuture","future","isUndoPossible","past","isRedoPossible","useAppDispatch","useDispatch","useAppSelector","useSelector","boldStyle","fontWeight","ScoreBug","numOuts","Box","direction","gap","align","Text","TOP","CaretUpFill","CaretDownFill","Table","TableBody","TableRow","style","TableCell","scope","initialTeamState","name","initialState","NOT_STARTED","getNextAvailablePosition","takenPositions","updatePositions","some","cleanUpAfterPlateAppearance","nextBatter","upNextHalfInning","createSlice","reducers","addPlayerToGame","payload","movePlayer","fromTeam","toTeam","list","startIndex","endIndex","result","Array","from","splice","removed","reorderItemInList","sourceTeam","destTeam","sourceList","destList","sourceClone","destClone","moveItemBetweenLists","newSourceLineup","newDestLineup","removePlayerFromGame","changePlayerPosition","currentPlayerWithPosition","startGame","recordGameEvent","homeLeadingAfterTop","awayLeadingAfterBottom","changeGameLength","incrementGameLength","decrementGameLength","extendGame","resetGame","fullResetGame","gameActions","actions","reducer","undoable","includeAction","limit","syncFilter","ResetConfirm","dispatch","onConfirm","useCallback","pad","width","textAlign","Button","onClick","SettingsMenu","minInnings","maxInnings","currentGameLength","inProgress","inExtraInnings","useState","resetConfirmOpen","setResetConfirmOpen","handleChangeGameLength","target","parseInt","value","handleClickSubtractGameLength","handleClickAddGameLength","vertical","horizontal","Heading","level","margin","alignSelf","icon","Subtract","disabled","RangeInput","step","min","onChange","Add","DropButton","PowerReset","open","onOpen","dropContent","dropProps","top","onClose","BasesPreview","first","second","third","Blank","version","xmlns","xmlnsXlink","preserveAspectRatio","viewBox","height","d","xlinkHref","opacity","fill","fillOpacity","clipPath","stroke","strokeWidth","strokeOpacity","TopBar","history","useHistory","gameInProgress","gameCanStart","settingsButtonRef","useRef","showSettings","setShowSettings","toggleSettings","show","Header","background","Nav","right","plain","left","SettingsOption","ref","current","Drop","promptAccordionContext","createContext","PromptAccordionPanel","preview","children","active","useContext","AccordionPanel","header","justify","round","weight","Edit","PromptAccordion","numPanels","Children","count","activeIndices","setActiveIndices","handleActiveIndicesChange","indices","currentIndices","sortBy","slice","Accordion","activeIndex","onActive","child","Provider","getSelectedContactOption","prompts","contactChoice","getSelectedFielderOption","fielderChoice","getSelectedOutOnPlayOptions","outOnPlayChoices","getSelectedSacFlyRunsScored","sacFlyRunsScoredChoice","getPlateAppearanceResult","fieldedBy","allRunnerChoices","getExtraRunnerMovementForPlateAppearance","runnerChoices","getAllRunnerChoices","PlateAppearancePreview","promptContext","createNextState","getPresent","getPlateAppearancePreview","border","OptionSelector","isSelected","val","handleClickOption","clickedVal","isArray","concat","overflow","index","negative","isObject","selected","flex","hoverIndicator","side","setRunnerChoice","clearRunnerChoice","setContactChoice","clearContactChoice","setFielderChoice","clearFielderChoice","setOutOnPlayChoices","clearOutOnPlayChoices","setSacFlyRunsScoredChoice","resetSacFlyRunsScoredChoice","clearPrompt","promptActions","ContactPrompt","useEffect","selectedOption","formattedOptions","useMemo","handleChange","FielderPrompt","showTitle","bottom","ContactPanel","RunnerPrompt","getSelectedRunnerOption","runnerName","trailingRunnerOptions","whiteSpace","HitPrompt","setCanSubmit","selectedContactType","OutPrompt","SacrificeFlyPrompt","selectedRunsScored","handleChangeRunsScored","shouldShowOOPPrompt","OutOnPlayPrompt","dontShow","selector","selectedOptions","handleChangeSingle","handleChangeMultiple","playerIds","getPlayerOptionsForSelector","FieldersChoicePrompt","selectedOutOnPlay","canSubmit","DoublePlayPrompt","selectedOutsOnPlay","nextOptions","outsOnPlayFulfilled","EventDetailPrompt","promptView","onSubmit","onCancel","promptSelector","prompt","batter","Layer","buttonGroups","types","EventReporter","pendingPlateAppearance","setPendingPlateAppearance","handleSubmitPlateAppearance","getState","handleCancelPrompt","gridArea","alignContent","wrap","_extends","assign","arguments","source","key","prototype","hasOwnProperty","call","apply","this","_objectWithoutProperties","excluded","sourceKeys","indexOf","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","SvgBase","_ref","svgRef","title","titleId","ForwardRef","SvgHome","Base","occupied","HomePlate","Bases","firstBaseRunner","secondBaseRunner","thirdBaseRunner","onDeck","inTheHole","undoPossible","redoPossible","undo","ActionCreators","redo","Grid","rows","columns","areas","scoped","Undo","Redo","LineupPlayer","availablePositions","getAvailablePositions","positionOptions","handleRemove","handleChangePosition","draggableId","innerRef","draggableProps","dragHandleProps","ThemeContext","Extend","global","xsmall","Select","labelKey","valueKey","reduce","Close","Lineup","teamRole","getLineup","availablePlayers","searchValue","setSearchValue","suggestions","toLowerCase","startsWith","handleSearchChange","currentTarget","handleSuggestionSelect","suggestion","TextInput","placeholder","onSelect","lineupSpot","droppableId","droppableProps","Teams","handleDragEnd","destination","onDragEnd","shrink","basis","initialStats","atBats","hits","doubles","triples","homeRuns","walks","stolenBases","caughtStealing","runsBattedIn","runsScored","strikeouts","sacrificeFlies","groundIntoDoublePlays","leftOnBase","getBoxScore","allStats","plays","updatePlayer","stats","aggregateStats","playerStats","battingAverage","onBasePercentage","sluggingPercentage","onBasePlusSlugging","isolatedPower","getRateStats","isNaN","formatted","toFixed","formatDecimal","NameCell","fontStyle","TeamBoxScore","Card","DataTable","property","primary","render","data","BoxScore","awayStats","homeStats","PlayTypeTag","toUpperCase","ScoreTag","away","home","Play","description","HalfInningPlays","CardHeader","CardBody","play","getPositionTitle","getContactVerb","formatBaseName","makeOutPhrase","getPlayDescription","newNumOuts","newScore","sentences","finishSentence","parts","join","fielderToken","outBase","hitType","getHitVerb","token","makeInterpolatedPlayDescription","interpolatedDescription","replace","RegExp","p","getPlayerAtPosition","getAllPlays","groupedPlays","lastGroup","getScoringPlays","groups","group","Plays","lastPlay","nextPlay","gameStarted","scoringPlays","allPlays","currentInning","selectedInning","setSelectedInning","allPlaysForInning","selectInning","xxsmall","theme","colors","brand","focus","outline","rangeInput","track","extend","borderRadius","accordion","addPlayer","newPlayer","games","prepare","uuidv1","GameOver","gameStatus","maxGameLength","onClickExtendGame","onClickResetGame","onClickFullResetGame","Main","App","effect","pathname","useLocation","gameOver","split","Grommet","full","persistCombineReducers","storage","store","configureStore","middleware","getDefaultMiddleware","serializableCheck","immutableCheck","persistor","persistStore","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","isLocalhost","Boolean","window","location","hostname","registerValidSW","swUrl","config","navigator","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","console","log","onUpdate","onSuccess","catch","error","ReactDOM","loading","StrictMode","document","getElementById","URL","process","href","origin","addEventListener","fetch","headers","response","contentType","get","ready","unregister","reload","checkValidServiceWorker","serviceWorkerRegistration"],"mappings":"6JAAYA,EAIAC,EAIAC,EAKAC,EAaAC,EAWAC,EAmDAC,E,8KCxEGC,EAV+B,SAAAC,GAC5C,IAAMC,EAAQC,YAAc,CAAEC,KAAMH,EAAMI,KAC1C,OACE,cAACC,EAAA,EAAD,aACEC,MAASL,EAAQ,WAAa,WAC9BM,GAAI,cAAGC,UAAH,EAAcC,QAAd,EAAuBC,SAAvB,IAAoCC,EAApC,yDAA+C,cAAC,IAAD,eAAUA,MACzDX,K,qECVGY,EAAkB,SAAC,GAAD,IAAGC,EAAH,EAAGA,UAAWC,EAAd,EAAcA,SAAd,gBAAwCD,EAAxC,YAAqDC,EAAS,KCKvFC,EAAY,SAACC,EAAiBC,GAAlB,OAChBD,EAAME,QAAQD,IAOHE,EAAqB,SAACH,EAAiBC,GAClD,IAAMG,EAASL,EAAUC,EAAOC,GAChC,OAAOG,EAASR,EAAgBQ,GAAU,IAI/BC,EAAoBC,aADJ,SAACN,GAAD,OAAqBA,EAAME,WACO,SAAAA,GAAO,OAAIK,OAAOC,OAAON,M,kBHrB5E1B,O,aAAAA,I,oBAAAA,M,cAIAC,O,eAAAA,I,gBAAAA,M,cAIAC,K,cAAAA,E,gBAAAA,E,eAAAA,M,cAKAC,K,kBAAAA,E,kBAAAA,E,wBAAAA,E,0BAAAA,E,wBAAAA,E,sBAAAA,E,wBAAAA,E,4BAAAA,E,0BAAAA,E,4BAAAA,E,2BAAAA,M,cAaAC,K,UAAAA,E,YAAAA,E,gBAAAA,E,gBAAAA,E,gBAAAA,E,kBAAAA,E,8BAAAA,E,kCAAAA,E,2BAAAA,M,cAWAC,K,YAAAA,E,oBAAAA,E,wBAAAA,E,cAAAA,E,oBAAAA,E,qBAAAA,M,cAmDAC,K,0BAAAA,E,0BAAAA,E,qBAAAA,M,gBIzEC2B,EAAiBH,aAFD,SAACN,GAAD,OAAsBA,EAAMU,cAEG,SAAAC,GAAI,OAC9DA,IAASnC,EAAWoC,OAASnC,EAASoC,KAAOpC,EAASqC,QAE3CC,EAAmBT,aAZR,SAACN,GAAD,OAAsBA,EAAMgB,QAclDP,GACA,SAACO,EAAOC,GAAR,OAAwBD,EAAMC,GAAaC,UAGhCC,EAAkBb,aAhBC,SAACN,GAAD,OAAsBA,EAAMoB,QAkB1DL,GACA,SAACM,EAAUH,GACT,IAAMI,EAAcC,IAAEC,UAAUN,GAAQ,SAAAO,GAAE,OAAIA,IAAOJ,KACrD,OAAIC,IAAgBJ,EAAOQ,OAAS,EAC3BR,EAAO,GAETA,EAAOI,EAAc,MChBnBK,EAAeJ,IAAEK,KAAKjD,GAEtBkD,EAA+B,SAAC,GAAD,SAAGX,OAA0BQ,OAAS,GACrEI,EAA+B,SAACC,GAC3C,OAAIF,EAA6BE,GACxBJ,EAAaK,QAAO,SAAAC,GAAQ,OAAIA,IAAatD,EAAiBuD,gBAEhEP,EAAaK,QAClB,SAAAC,GAAQ,OAAK,CAACtD,EAAiBwD,aAAcxD,EAAiByD,aAAaC,SAASJ,OAI3EK,EAAmB,SAACC,EAAsBC,GAAvB,OAC9BjB,IAAEkB,QAAQF,GAAS,SAAAG,GAAM,OAAIA,IAAWF,MAE7BG,EAAa,SAACJ,EAAsBK,EAAqBC,GACpE,OAAIA,GACFN,EAAQM,GAAWN,EAAQK,UACpBL,EAAQK,IACR,WAEAL,EAAQK,IACR,IAIEE,GAAe,SAACP,EAAsBC,UAC1CD,EAAQD,EAAiBC,EAASC,KAK9BO,GAAa,SAACC,GAAoD,IAA7BC,EAA4B,uDAAN,EACtE,OAAqB,IAAjBA,EAA2BC,GAAgBF,GAC3B,IAAhBC,EAA0BD,EAC1BA,IAAgBtE,EAASyE,MAAc,KACvCH,IAAgBtE,EAAS0E,OACvBH,EAAc,EAAU,KACrBvE,EAASyE,MAEdF,EAAc,EAAU,KACR,IAAhBA,EAA0BvE,EAASyE,MAChCzE,EAAS0E,QAGLC,GAAgC,SAACC,GAC5C,OAAQA,GACN,KAAK1E,EAAoB2E,QACvB,OAAO,EACT,KAAK3E,EAAoB4E,OACvB,OAAO,EACT,KAAK5E,EAAoB6E,OACvB,OAAO,EACT,KAAK7E,EAAoB8E,OACzB,KAAK9E,EAAoB+E,KACvB,OAAO,EACT,QACE,OAAO,IAIAC,GAA4B,SAACN,GACxC,OAAQA,GACN,KAAK1E,EAAoB4E,OACvB,OAAO9E,EAASyE,MAClB,KAAKvE,EAAoB6E,OACvB,OAAO/E,EAAS0E,OAClB,KAAKxE,EAAoB8E,OACzB,KAAK9E,EAAoB+E,KACzB,KAAK/E,EAAoBiF,gBACvB,OAAOnF,EAASoF,MAClB,QACE,OAAO,OAIAC,GAAgB,SAACC,GAAD,aAClB,OAATA,EACI,GACA,mBACGtF,EAASoF,MAAQ,GADpB,cAEGpF,EAAS0E,OAAS,GAFrB,cAGG1E,EAASyE,MAAQ,GAHpB,GAIEa,IACKd,GAAkB,SAACc,GAC9B,OAAQA,GACN,KAAK,KACH,OAAOtF,EAASyE,MAClB,KAAKzE,EAASyE,MACZ,OAAOzE,EAAS0E,OAClB,KAAK1E,EAAS0E,OACZ,OAAO1E,EAASoF,MAClB,KAAKpF,EAASoF,MACZ,SAIOG,GAAoB,SAApBA,EACXD,EACAzB,GAEa,IADb2B,EACY,uDADIxF,EAASoF,MAEnBK,EAAWjB,GAAgBc,GAEjC,OAAID,GAAcC,GAAQD,GAAcG,IAAkB,KACrDC,KACA5B,EAAQ4B,IAENF,EAAkBE,EAAU5B,EAAS2B,KAGjCE,GAAmB,SAAC7B,GAAD,OAC7BhB,IAAE8C,QAAQ9B,GAAkC+B,MAC3C,kBAAEC,EAAF,oBAAWC,EAAX,2BAAsBT,GAAcQ,GAASR,GAAcS,OAGlDC,GAAgB,SAAClC,GAAD,OAA0BhB,IAAEmD,KAAKN,GAAiB7B,KAElEoC,GAAgB,SAC3BpC,EACAqC,GAEA,IAAMC,EAAcT,GAAiB7B,GACrChB,IAAEuD,aAAaD,GAAa,mCAAEb,EAAF,KAAQxB,EAAR,YAAsBoC,EAASpC,EAAUwB,OAG1De,GAAwC,SACnDxC,EACAe,EACAjC,GAEA,IAAI2D,EAA0B,GACxBC,EAAU,eAAQ1C,GAClB2C,EAAmB7B,GAA8BC,GAevD,OAbA/B,IAAE4D,MAAMD,GAAkB,SAAAE,GACxBT,GAAcM,GAAY,SAACzC,EAAUwB,GAC/BC,GAAkBD,EAAMiB,EAAYrB,GAA0BN,KAC5DX,EAAWsC,EAAYjB,EAAMjB,GAAWiB,KAC1CgB,EAAcK,KAAK7C,MAIf,IAAN4C,GAAWxB,GAA0BN,KACvC2B,EAAWvG,EAASoF,OAASzC,MAI1B,CAAC4D,EAAYD,IAGTM,GAA0B,SAAC/C,GACtC,IAAIyC,EAA0B,GAQ9B,OAPAL,GAAcpC,GAAS,SAACC,EAAUwB,GAC5BC,GAAkBD,EAAMzB,IACtBI,EAAWJ,EAASyB,EAAMjB,GAAWiB,KACvCgB,EAAcK,KAAK7C,MAIlBwC,GAMHO,GAAc,SAACvF,GAAwC,IAAtBwF,EAAqB,uDAAN,EACpDxF,EAAMyF,MAAMhF,EAAeT,KAAWwF,GAG3BE,GAAiB,SAAC1F,EAAkB2F,GAAsB,IAC7DvE,EAAoDpB,EAApDoB,MAAOwE,EAA6C5F,EAA7C4F,OAAQlF,EAAqCV,EAArCU,WAAYmF,EAAyB7F,EAAzB6F,KAAMtD,EAAmBvC,EAAnBuC,QAASkD,EAAUzF,EAAVyF,MAC5CK,EAA6B,CACjCH,MAAOA,EACPI,UAAW,CACT3E,MAAOA,EACPwE,SACAlF,aACAmF,OACAtD,QAAQ,eAAMA,GACdkD,MAAM,YAAKA,IAEbO,gBAAiB,GACjBhB,cAAe,GACfiB,aAAc1D,EACd2D,WAAYT,GAGRU,EAAsB,SAAC5D,GAAwC,IAAD,EACpD,EADgC6D,IAAoB,yDAC9DA,IACF,EAAAN,EAAaE,iBAAgBX,KAA7B,oBAAqC9C,KAEvC,EAAAuD,EAAad,eAAcK,KAA3B,oBAAmC9C,KAGrC,GAAmB,sBAAfoD,EAAMU,KAA8B,CACtC,IAAMzD,ED1M6B,SAAC5C,EAAkBC,GAAnB,OACrCqC,EAJwB,SAACtC,GAAD,OAAsBA,EAAMuC,QAInC+D,CAAWtG,GAAQC,GCyMhBsG,CAAwBvG,EAAO2F,EAAMnD,UACvD,GAAImD,EAAMa,QAAS,CACjB,IAAM3D,EAAUE,GAAWH,UACpB5C,EAAMuC,QAAQK,GACjBC,EACF7C,EAAMuC,QAAQM,GAAW8C,EAAMnD,UAG/B+C,GAAYvF,GACZmG,EAAoB,CAACR,EAAMnD,WAAW,gBAGjCxC,EAAMuC,QAAQK,GACrB5C,EAAM6F,YAEH,GAAmB,oBAAfF,EAAMU,KAA4B,CAC3C,OAAQV,EAAMc,MACZ,KAAK7H,EAAoB2E,QACvBgC,GAAYvF,EAAOuB,IAAEmF,KAAK1G,EAAMuC,SAAW,GAC3C4D,EAAoB,GAAD,mBAAM5E,IAAEf,OAAOR,EAAMuC,UAArB,CAA4CnB,KAC/DpB,EAAMuC,QAAU,GAChB,MACF,KAAK3D,EAAoB4E,OACvB+B,GAAYvF,EAAOuB,IAAEmF,KAAK1G,EAAMuC,UAChC4D,EAAoB5E,IAAEf,OAAOR,EAAMuC,UACnCvC,EAAMuC,QAAN,eAAmB7D,EAASyE,MAAQ/B,GACpC,MACF,KAAKxC,EAAoB6E,OACzB,KAAK7E,EAAoB8E,OACzB,KAAK9E,EAAoB+E,KAAzB,MAC0CoB,GACtC/E,EAAMuC,QACNoD,EAAMc,KACNrF,GAJJ,mBACSuF,EADT,KACyB3B,EADzB,KAMEhF,EAAMuC,QAAUoE,EAChBpB,GAAYvF,EAAOgF,EAActD,QACjCyE,EAAoBnB,GACpB,MACF,KAAKpG,EAAoBgI,cACvBrF,IAAE4D,MAAMQ,EAAMkB,oBAAqB,WAAO,IAAD,EACdpC,GAAclC,GADA,mBAChCyB,EADgC,KAC1BxB,EAD0B,KAEvCG,EAAWJ,EAASyB,EAAM,MAC1BuB,GAAYvF,GACZmG,EAAoB,CAAC3D,OAEvBxC,EAAM6F,OACN,MACF,KAAKjH,EAAoBiF,gBACvBf,GAAa9C,EAAMuC,QAASoD,EAAMmB,iBAAiB,IACnD,IAAM9B,EAAgBM,GAAwBtF,EAAMuC,SACpDvC,EAAMuC,QAAQ7D,EAASoF,OAAS1C,EAC5B4D,EAActD,QAAUmE,EAAO,IACjCN,GAAYvF,GACZmG,EAAoBnB,IAEtBhF,EAAM6F,OACN,MAEF,KAAKjH,EAAoBmI,YAKvB,GAJA/G,EAAM6F,MAAQ,EACdF,EAAMmB,iBAAiBE,SAAQ,SAAAxE,GAC7BM,GAAa9C,EAAMuC,QAASC,MAE1BmD,EAAMsB,cAAgBpI,EAAYqI,SAAU,CAC9C,IAAMlC,EAAgBM,GAAwBtF,EAAMuC,SAChDyC,EAActD,QAAmB,IAATmE,IAC1BN,GAAYvF,EAAOgF,EAActD,QACjCyE,EAAoBnB,GAAe,IAGhCW,EAAMmB,iBAAiBzE,SAASjB,KACnCpB,EAAMuC,QAAQ7D,EAASoF,OAAS1C,GAGpC,MACF,KAAKxC,EAAoBuI,IACvB,GAAIxB,EAAMsB,cAAgBpI,EAAYqI,SAAU,CAC9C,IAAMlC,EAAgBM,GAAwBtF,EAAMuC,SAChDyC,EAActD,QAAUmE,EAAO,IACjCN,GAAYvF,EAAOgF,EAActD,QACjCyE,EAAoBnB,IAGxBhF,EAAM6F,OAIVlB,GAAc3E,EAAMuC,SAAS,SAACC,EAAUwB,GAClCxB,KAAYmD,EAAMyB,wBACbpH,EAAMuC,QAAQyB,GACrBhE,EAAM6F,QACGrD,KAAYmD,EAAM0B,YACvB1E,EAAW3C,EAAMuC,QAASyB,EAAM2B,EAAM0B,WAAW7E,MACnD+C,GAAYvF,GACZmG,EAAoB,CAAC3D,GAAWmD,EAAMc,OAAS7H,EAAoBmI,iBAKzEjB,EAAaG,aAAejG,EAAMuC,QAClCuD,EAAaI,WAAalG,EAAMyF,MAChCzF,EAAMsH,YAAYjC,KAAKS,KCjTdyB,GAAsB,SAACvD,GAA2B,IAAD,EAC5D,OAAa,OAATA,EAAsB,QACnB,mBACJtF,EAASoF,MAAQ,OADb,cAEJpF,EAAS0E,OAAS,OAFd,cAGJ1E,EAASyE,MAAQ,OAHb,GAILa,IAGSwD,GAA0B,SAACvF,GAAD,aACpC,mBACEtD,EAAiB8I,QAAU,KAD7B,cAEE9I,EAAiB+I,QAAU,KAF7B,cAGE/I,EAAiBgJ,WAAa,MAHhC,cAIEhJ,EAAiBiJ,YAAc,MAJjC,cAKEjJ,EAAiBkJ,WAAa,MALhC,cAMElJ,EAAiBmJ,UAAY,MAN/B,cAOEnJ,EAAiBoJ,WAAa,MAPhC,cAQEpJ,EAAiBuD,aAAe,MARlC,cASEvD,EAAiByD,YAAc,OATjC,cAUEzD,EAAiBwD,aAAe,OAVlC,cAWExD,EAAiBqJ,YAAc,MAXjC,GAYC/F,IAESgG,GAA0B,SAAC3E,GAAD,aACpC,mBACE1E,EAAoBuI,IAAM,OAD5B,cAEEvI,EAAoB8E,OAAS,UAF/B,cAGE9E,EAAoB6E,OAAS,UAH/B,cAIE7E,EAAoB4E,OAAS,UAJ/B,cAKE5E,EAAoB2E,QAAU,YALhC,cAME3E,EAAoB+E,KAAO,QAN7B,cAOE/E,EAAoBgI,cAAgB,iBAPtC,cAQEhI,EAAoBiF,gBAAkB,oBARxC,cASEjF,EAAoBmI,YAAc,eATpC,GAUCzD,IAES4E,GAAyB,SAACjB,GAAD,aACnC,mBACEpI,EAAYqI,SAAW,aADzB,cAEErI,EAAYsJ,SAAW,eAFzB,cAGEtJ,EAAYuJ,WAAa,WAH3B,cAIEvJ,EAAYwJ,SAAW,eAJzB,cAKExJ,EAAYyJ,MAAQ,UALtB,cAMEzJ,EAAY0J,KAAO,aANrB,GAOCtB,IAESuB,GAAyB,SAACvB,GAAD,aACnC,mBACEpI,EAAYqI,SAAW,eADzB,cAEErI,EAAYsJ,SAAW,iBAFzB,cAGEtJ,EAAYuJ,WAAa,cAH3B,cAIEvJ,EAAYwJ,SAAW,iBAJzB,cAKExJ,EAAYyJ,MAAQ,WALtB,GAMCrB,IAESwB,GAAuB,SAACC,GACnC,IAAKA,EAAOC,iBACV,MAAM,WAAN,OAAkBpB,GAAoBmB,EAAO7F,UAE/C,GAAuB,OAAnB6F,EAAO7F,QACT,OAAI6F,EAAOE,kBACF,SAEF,cAET,IAAMC,EAAWtB,GAAoBmB,EAAO7F,SAC5C,OAAI6F,EAAOE,kBACH,QAAN,OAAeC,GAEX,UAAN,OAAiBA,IAGNC,GAAmB,SAAClD,GAC/B,IAAImD,EACJ,OAAQnD,GACN,KAAK,EACHmD,EAAS,KACT,MACF,KAAK,EACHA,EAAS,KACT,MACF,KAAK,EACHA,EAAS,KACT,MACF,QACEA,EAAS,KAGb,MAAM,GAAN,OAAUnD,GAAV,OAAmBmD,ICzCfC,GAAuBzH,IAAEf,OAAO3B,GAAamD,QACjD,SAAAiH,GAAE,OAAIA,IAAOpK,EAAY0J,QAErBW,GAA0B,eAACC,EAAD,uDAAkCH,GAAlC,OAC9BG,EAAaC,KAAI,SAACnC,EAAaxF,GAAd,MAAsB,CACrCA,KACAwF,cACAoC,MAAOb,GAAuBvB,QAE5BqC,GAA0B,eAACH,EAAD,uDAA+B5H,IAAEf,OAAO3B,GAAxC,OAC9BsK,EAAaC,KAAI,SAACnC,EAAaxF,GAAd,MAAsB,CACrCA,KACAwF,cACAoC,MAAOnB,GAAuBjB,QAG5BsC,GAAmB,CACvB5K,EAAiB8I,QACjB9I,EAAiB+I,QACjB/I,EAAiBgJ,WACjBhJ,EAAiBiJ,YACjBjJ,EAAiBkJ,WACjBlJ,EAAiBmJ,WAEb0B,GAAuB,SAACC,GAAD,OAC3B9K,EAAiBoJ,YADU,mBAEvB0B,EACA,CAAC9K,EAAiByD,YAAazD,EAAiBwD,cAChD,CAACxD,EAAiBuD,eAJK,CAK3BvD,EAAiBqJ,eAEb0B,GAAkB,SAACD,GAAD,gBACnBF,GADmB,YAEnBC,GAAqBC,MAEpBE,GAAqB,SAACC,GAAD,OACzBA,EAAUR,KAAI,SAACnH,EAAUR,GAAX,MAAmB,CAAEA,KAAIQ,WAAUoH,MAAO7B,GAAwBvF,QAE5E4H,GAAkC,SACtC5C,EACA6C,EACAL,GAEA,IAAIG,EACJ,OAAQ3C,GACN,KAAKpI,EAAYqI,SACf0C,EAAYE,EAAMJ,GAAgBD,GAAmBF,GACrD,MACF,KAAK1K,EAAYyJ,MACfsB,EAAYL,GACZ,MACF,KAAK1K,EAAYsJ,SACjB,KAAKtJ,EAAYwJ,SACfuB,EAAYJ,GAAqBC,GACjC,MACF,KAAK5K,EAAYuJ,WACfwB,EAAYF,GAAgBD,GAAiBzH,QAC3C,SAAAC,GAAQ,OAAIA,IAAatD,EAAiB+I,WAE5C,MACF,KAAK7I,EAAY0J,KACfqB,EAAY,GAGhB,OAAOD,GAAmBC,IAwBfG,GAAmB,SAC9BxH,EACAsD,GAG+B,IAF/BmE,EAE8B,uDAFmB,GACjDC,IAC8B,yDACxBC,EAAazF,GAAclC,GACjC,GAAK2H,EAAL,CAF8B,kBAGRA,EAHQ,GAGvBlH,EAHuB,KAK9B,OAAOmH,GAA0B5H,EAASsD,EAAM7C,EAAa,KAAMgH,EAAeC,KAE9EE,GAA4B,SAA5BA,EACJ5H,EACAsD,EACA7C,EACAoH,EACAJ,EACAC,GAEA,IAAMzH,EAAWD,EAAQS,GACnBqH,EAvIkB,SAAC9H,EAAsB+H,GAC/C,OAAiB,OAAbA,EACK7F,GAAclC,IAIvBoC,GAAcpC,GAAS,SAACC,EAAUwB,GAChC,GAAID,GAAcC,GAAQD,GAAcuG,GAEtC,OADAC,EAAiB,CAACvG,EAAMxB,IACjB,KAIJ+H,GARP,IAAIA,EAkIeC,CAAkBjI,EAASS,GACxCyH,EA3C4B,SAACC,GACnC,IAAKA,EAAMhJ,OAAQ,MAAO,GAE1B,IAAMiJ,EAAkBpJ,IAAEqJ,QACxBrJ,IAAE6H,IAAIsB,GAAO,SAAA7H,GAAO,MAClB,EAAC,GAAM,GAAOuG,KAAI,SAAAR,GAAiB,MAAK,CACtCD,kBAAkB,EAClBC,oBACA/F,kBAUN,MALa,CACX,CAAE8F,kBAAkB,EAAgB9F,QAASK,GAAgByH,EAAgB,GAAG9H,WADrE,mBAER8H,IAGUvB,KAAI,WAAgB3H,GAAhB,IAAMiH,EAAN,wCAA0BjH,MAAOiH,MAyBpCmC,CAxHe,SAAC7H,EAAuBqH,GACvD,IAAMS,EAAa,sBAAOvJ,IAAEf,OAAO9B,IAAhB,CAA2B,OAC9C,OAAmB,OAAf2L,EACKS,EAAc9I,QAAO,SAAAgC,GAAI,OAAID,GAAcC,GAAQD,GAAcf,MAEnE8H,EAAc9I,QAAO,SAAAgC,GAAI,OAC9BzC,IAAEwJ,QAAQhH,GAAcC,GAAOD,GAAcf,GAAe,EAAGe,GAAcsG,OAkHnCW,CAAkBhI,EAAaoH,IAAcpI,QACvF,SAAA0G,GAAM,OAAIA,EAAO7F,SAAWoH,KAExBgB,EACJzI,KAAYwH,EACRzI,IAAEC,UAAUiJ,GAAS,qBAAG5H,UAA0BmH,EAAcxH,MAChE,EAEN,KAAIiI,EAAQ/I,OAAS,GAArB,CACA,IAAK2I,EAAY,MAAO,CAAE7H,WAAUiI,UAASQ,iBAZf,IAcvBC,EAduB,YAcXb,EAdW,MAexBpF,EAAU,eAAQ1C,GAExB,MAAO,CACLC,WACAiI,UACAQ,gBACAE,yBAA0B,SAAAC,GACxB,IAAIC,EAAcxF,EACdhD,EAA2BG,EAC/B,GAAIoI,EAAQzC,iBAEV,GADA9F,EAAUuI,EAAQvI,QACbuI,EAAQxC,kBAKD/F,EAGVF,EAAWsC,EAAYjC,EAAaH,UAF7BoC,EAAWjC,OANY,CAG9B,UAFOiC,EAAWjC,GAEE,MADpBqI,EACuB,OACvBxI,EAAUuH,EAQd,OAAOD,EACLlF,EACAoG,EACAH,EACArI,EACAmH,EACAC,OC7LKqB,GAAW,SAACtL,GAAD,OAAqBA,EAAMuL,KAAKC,QAAQxK,OAEnDsF,GAAa,SAACtG,GAAD,OAAqBA,EAAMuL,KAAKC,QAAQjJ,SACrDkJ,GAAa,SAACzL,GAAD,OAAqBA,EAAMuL,KAAKC,QAAQ3F,MACrD6F,GAAW,SAAC1L,GAAD,OAAqBA,EAAMuL,KAAKC,QAAQ/F,OACnDkG,GAAgB,SAAC3L,GAAD,OAAqBA,EAAMuL,KAAKC,QAAQ9K,YACxDkL,GAAY,SAAC5L,GAAD,OAAqBA,EAAMuL,KAAKC,QAAQ5F,QACpDiG,GAAmB,SAAC7L,GAAD,OAAqBA,EAAMuL,KAAKC,QAAQpK,OAE3DX,GAAiBH,YAAeqL,IAAe,SAAAhL,GAAI,OAC9DA,IAASnC,EAAWoC,OAASnC,EAASoC,KAAOpC,EAASqC,QAG3CC,GAAmBT,YAC9BgL,GACA7K,IACA,SAACO,EAAOC,GAAR,OAAwBD,EAAMC,GAAaC,UAMhC4K,GAAsCxL,YACjDgL,GACAK,IACA,SAAC3K,EAAON,GAAR,OAAuBmB,EAA6Bb,EAAM,EAAIN,OAGnDqL,GAAiBzL,aAC5B,SAAAN,GAAK,OAAIA,IACTsG,IACA,SAACtG,EAAOuC,GAAR,OACEhB,IAAEyK,UAAuBzJ,GAAS,SAACd,GAAD,OAAgBtB,EAAmBH,EAAOyB,SAInEwK,GAAgB3L,aAC3B,SAAAN,GAAK,OAAIA,KAFO,SAACA,GAAD,OAAqBA,EAAMuL,KAAKC,QAAQpK,SAIxD,SAACpB,EAAOqB,GAAR,OAAsBA,EAAWlB,EAAmBH,EAAOqB,GAAY,MAM5D6K,GAAoB,SAAClM,EAAiBC,GAEjD,OADsBsB,IAAE4K,KAAKb,GAAStL,IAAQ,qBAAGkB,OAAoBmB,SAASpC,MAAtE2J,UACS3J,IAGNmM,GAAa9L,YACxBgL,IACA,SAAAtK,GAAK,OAAIA,EAAMoI,KAAI,SAAArH,GAAI,OAAIA,EAAKb,aAIrBmL,GAAsB/L,YACjCD,EACA+L,IACA,SAACE,EAAYC,GACX,IAAMC,EAAmBjL,IAAEqJ,QAAQ2B,GACnC,OAAOD,EAAWtK,QAAO,gBAAG/B,EAAH,EAAGA,SAAH,OAAmBuM,EAAiBnK,SAASpC,SAI7DwM,GAAenM,YAC1B8L,IACA,mCAAYM,EAAZ,KAAIhL,OAAoCiL,EAAxC,KAAgCjL,OAAhC,OACEkL,KAAKC,IAAIH,EAAiBC,IAAmB,GAC7CD,GAvEwB,GAwExBC,GAxEwB,KA2EfG,GAAgB,SAAC9M,GAAD,OAAqBA,EAAMuL,KAAKC,QAAQuB,QACxDC,GAAmB1M,YAC9BwM,IACA,SAAAC,GAAM,OAAIA,IAAWjO,EAAWmO,eAErBC,GAAa5M,YAAewM,IAAe,SAAAC,GAAM,OAAIA,IAAWjO,EAAWqO,YAE3EC,GAA4B9M,YAAegG,GAAYmF,IAAY,SAAClJ,EAASsD,GACxF,IAAMwH,EAAwC,IAAIC,IAWlD,OATK/L,IAAEmF,KAAKnE,IACV8K,EAAYE,IAAI3O,EAAoBiF,iBAGzB,IAATgC,GAAetE,IAAEmF,KAAKnE,KACxB8K,EAAYE,IAAI3O,EAAoBmI,aACpCsG,EAAYE,IAAI3O,EAAoBgI,gBAG/BrF,IAAEf,OAAO5B,GAAqBoD,QAAO,SAAAsB,GAAM,OAAK+J,EAAYG,IAAIlK,SAGnEmK,GAAgB,SAACpM,EAA8BH,GACnD,IAAMI,EAAcC,IAAEC,UAAUN,GAAQ,SAAAO,GAAE,OAAIA,IAAOJ,KACrD,OAAIC,IAAgBJ,EAAOQ,OAAS,EAC3BR,EAAO,GAETA,EAAOI,EAAc,IAEjBH,GAAkBb,YAAeuL,GAAkB9K,GAAkB0M,IACrEC,GAAqBpN,YAAea,GAAiBJ,GAAkB0M,IACvEE,GAAsBrN,aACjC,SAAAN,GAAK,OAAIA,IACTmB,GACAhB,GAEWyN,GAAyBtN,aACpC,SAAAN,GAAK,OAAIA,IACT0N,GACAvN,GAGW0N,GAAsC,SAACvK,GAAD,OACjDhD,YACEuL,GACAJ,GACAnF,GACAwF,IACA,SAACzK,EAAUwE,EAAMtD,EAASkH,GAA1B,OD0E0C,SAC5CnG,EACAjC,EACAwE,EACAtD,EACAkH,GAEA,OAAQnG,GACN,KAAK1E,EAAoB+E,KACvB,OAEF,KAAK/E,EAAoB2E,QACvB,MAAO,CACL8C,KAAM,MACNyH,eAAgB,CACdrD,QAASvB,GAAwB,CAACrK,EAAYuJ,WAAYvJ,EAAYwJ,YAExE0F,eAAgB,iBAAO,CACrBtD,QAASd,GAAmBH,GAAqBC,OAIvD,KAAK7K,EAAoBuI,IACvB,MAAO,CACLd,KAAM,MACNyH,eAAgB,CACdE,UAAU,EACVvD,QAASnB,MAEXyE,eAAgB,SAAC9G,GACf,IAAMhC,EAAU,eAAQ1C,GACxB,GAAI0E,IAAgBpI,EAAY0J,KAAhC,CACA,IAAM0F,EAAiB,CACrBxD,QAASZ,GAAgC5C,GAAa,EAAOwC,IAE/D,OAAa,IAAT5D,EACK,CAAEoI,mBAEPhH,IAAgBpI,EAAYqI,UAC9B5B,GAAwBL,GAEnB,CACLgJ,iBACAC,cAAenE,GACb9E,EACAY,EAAO,EACP,GACAoB,IAAgBpI,EAAYqI,eAMtC,KAAKtI,EAAoBgI,cACvB,IAAMqH,EAAiB,CAAExD,QAASd,GAAmBH,GAAqBC,KAC1E,OAAwB,IAApBlI,IAAEmF,KAAKnE,GACF,CAAE8D,KAAM,eAAgB4H,kBAG1B,CACL5H,KAAM,eACN4H,iBACAE,qBAAsB5M,IAAE6M,MAAM,EAAG7M,IAAEmF,KAAKnE,GAAW,GACnDwL,eAAgB,SAAAM,GACd,IAAMpJ,EAAU,eAAQ1C,GAKxB,OAJAhB,IAAE4D,MAAMkJ,GAAW,WACjB1L,EAAWsC,EAAYR,GAAcQ,GAAa,GAAI,SAGjD8E,GAAiB9E,EAAYY,EAAO,EAAG,IAAI,KAIxD,KAAKjH,EAAoBiF,gBACvB,MAAO,CACLwC,KAAM,iBACNiI,iBAAkB,CAAEC,UAAWhN,IAAEf,OAAO+B,IACxC0L,eAAgB,CACdxD,QAASZ,GAAgChL,EAAYqI,UAAU,EAAOuC,IAExEsE,eACElI,EAAO,EACH,SAAA2I,GACE,IAAMvJ,EAAU,eAAQ1C,GAIxB,OAHAO,GAAamC,EAAYuJ,GACzBlJ,GAAwBL,GACxBA,EAAWvG,EAASoF,OAASzC,EACtB0I,GAAiB9E,EAAYY,EAAO,SAE7C4I,GAGV,KAAK7P,EAAoBmI,YACvB,IAAMwH,EAAYhN,IAAE6H,IAAI7H,IAAEmN,QAAQtK,GAAiB7B,IAAW,GAC9D,MAAO,CACL8D,KAAM,aACNyH,eAAgB,CACdrD,QAASnB,GAAwBN,IACjCgF,UAAU,GAEZD,eAAgB,SAAA9G,GACd,IAAMgH,EAAiB,CACrBxD,QAASZ,GAAgC5C,GAAa,EAAOwC,IAE/D,OAAwB,IAApBlI,IAAEmF,KAAKnE,GACF,CACL0L,iBACAK,iBAAkB,CAChBC,UAAU,GAAD,mBAAMA,GAAN,CAAiBlN,IAC1BsN,UAAU,IAKZ1H,IAAgBpI,EAAYqI,SACvB,CACL+G,iBACAK,iBAAkB,CAChBC,UAAU,GAAD,mBAAMA,GAAN,CAAiBlN,IAC1BsN,UAAU,GAEZZ,eACW,IAATlI,EACI,SAAA+I,GACE,IAAM3J,EAAU,eAAQ1C,GAOxB,OANAqM,EAAW5H,SAAQ,SAAAxE,GAAQ,OAAIM,GAAamC,EAAYzC,MACxD8C,GAAwBL,GACnB2J,EAAWvM,SAAShB,KAEvB4D,EAAWvG,EAASoF,OAASzC,GAExB0I,GAAiB9E,EAAYY,EAAO,SAE7C4I,GAIH,CACLH,iBAAkB,CAAEC,aACpBN,iBACAF,eACW,IAATlI,EACI,SAAA+I,GACE,IAAM3J,EAAU,eAAQ1C,GAExB,OADAO,GAAamC,EAAY2J,EAAW,IAC7B7E,GAAiB9E,EAAYY,EAAO,SAE7C4I,KAKd,QAAQ,IAAR,EACmC1J,GAC/BxC,EACAe,EACAjC,GAHKwN,EADT,oBAOQC,EAAiBvN,IAAEwN,OAAOxM,GAC1ByH,EAAgBzI,IAAEyK,UAAU8C,GAAgB,SAAC9K,GAAD,OAChDjB,GAAWiB,EAAMX,GAA8BC,OAGjD,MAAO,CACL+C,KAAM,MACNyH,eAAgB,CAAErD,QAASvB,MAC3BgF,cAAenE,GAAiB8E,EAAwBhJ,EAAMmE,GAC9D+D,eAAgB,SAAA9G,GAAW,MAAK,CAC9BwD,QAASZ,GAAgC5C,GAAa,EAAMwC,OClPhEuF,CAA+B1L,EAAQjC,EAAWwE,EAAMtD,EAASkH,OAG1DwF,GAAiB,SAACjP,GAAD,OAAqBA,EAAMuL,KAAKC,QAAQlE,aAEzD4H,GAAuB,SAAClP,GAAD,OAAqBA,EAAMuL,KAAKC,QAAQ2D,YAC/DC,GAAmB9O,YAC9BsL,GACAD,GACAD,IACA,SAAC9F,EAAQlF,EAAT,GAAiD,IAAD,mBAA1B2O,EAA0B,KAAfC,EAAe,KAC9C,OAAI5O,IAAelC,EAAWoC,QAAU0O,EAAYD,EAC3CzC,KAAK2C,IAAI,EAAG3J,EAAS,GAEvBgH,KAAK2C,IAAI,EAAG3J,MAGV4J,GAAmB,kBAAM,IAEzBC,GAAuBnP,YAClCsL,GACAsD,IACA,SAACtJ,EAAQuJ,GAAT,OAAwBvJ,EAASuJ,KAKtBO,GAAY,SAAC1P,GAAD,OAAqBA,EAAMuL,KAAKoE,QAE5CC,GAAiBtP,aAHP,SAACN,GAAD,OAAqBA,EAAMuL,KAAKsE,QAGD,SAAAA,GAAI,OAAIA,EAAKnO,OAAS,KAC/DoO,GAAiBxP,YAAeoP,IAAW,SAAAC,GAAM,OAAIA,EAAOjO,OAAS,KCnKrEqO,GAAiB,kBAAMC,eACvBC,GAAiDC,I,oBCKxDC,GAA2B,CAAEC,WAAY,QAkChCC,GAhCE,WAAO,IAAD,EACUJ,GAAevE,IADzB,mBACd2D,EADc,KACHC,EADG,KAEfrO,EAAcgP,GAAexP,IAC7BC,EAAauP,GAAetE,IAC5B/F,EAASqK,GAAerE,IACxB0E,EAAUL,GAAexE,IAE/B,OACE,eAAC8E,EAAA,EAAD,CAAKC,UAAU,MAAMC,IAAI,SAASC,MAAM,SAAxC,UACE,eAACC,EAAA,EAAD,WACGL,EADH,IACyB,IAAZA,EAAgB,MAAQ,UAErC,eAACC,EAAA,EAAD,CAAKC,UAAU,MAAME,MAAM,SAA3B,UACGhQ,IAAelC,EAAWoS,IAAM,cAACC,GAAA,EAAD,IAAkB,cAACC,GAAA,EAAD,IACnD,cAACH,EAAA,EAAD,UAAO/K,OAET,cAACmL,EAAA,EAAD,UACE,eAACC,EAAA,EAAD,WACE,eAACC,EAAA,EAAD,CAAUC,MAAOjQ,IAAgBxC,EAASqC,KAAOqP,QAAY1B,EAA7D,UACE,cAAC0C,EAAA,EAAD,CAAWC,MAAM,MAAjB,kBACA,cAACD,EAAA,EAAD,UAAY9B,OAEd,eAAC4B,EAAA,EAAD,CAAUC,MAAOjQ,IAAgBxC,EAASoC,KAAOsP,QAAY1B,EAA7D,UACE,cAAC0C,EAAA,EAAD,CAAWC,MAAM,MAAjB,kBACA,cAACD,EAAA,EAAD,UAAY7B,gB,yFChBlB+B,GAAyB,CAC7BC,KAAM,GACNpQ,OAAQ,GACR0I,UAAW,IAGP2H,GAA0B,CAC9BxE,OAAQjO,EAAW0S,YACnBxQ,MAAO,CAACqQ,GAAkBA,IAC1BzL,OAAQ,EACRlF,WAAYlC,EAAWoS,IACvBrO,QAAS,GACTsD,KAAM,EACNyB,YAAa,GACb7B,MAAO,CAAC,EAAG,GACX0J,WAAY,GAGRsC,GAA2B,SAAC1P,GAChC,IAAM2P,EAAiBnQ,IAAEf,OAAOuB,EAAK6H,WAErC,OADqB9H,EAA6BC,GAC9BoK,MAAK,SAAAlK,GAAQ,OAAKyP,EAAerP,SAASJ,OAG1D0P,GAAkB,SAAC5P,GACvB,IAAM0H,EAAkB5H,EAA6BE,GACrDR,IAAEyF,QAAQjF,EAAK6H,WAAW,SAAC3H,EAAUhC,GAC/BwJ,GAAmBxH,IAAatD,EAAiBuD,aAC9CX,IAAEqQ,KAAK7P,EAAK6H,WAAW,SAAA3H,GAAQ,OAAIA,IAAatD,EAAiByD,eAE1Db,IAAEqQ,KAAK7P,EAAK6H,WAAW,SAAA3H,GAAQ,OAAIA,IAAatD,EAAiBwD,gBAG3EJ,EAAK6H,UAAU3J,GAAYwR,GAAyB1P,GAFpDA,EAAK6H,UAAU3J,GAAYtB,EAAiBwD,aAF5CJ,EAAK6H,UAAU3J,GAAYtB,EAAiByD,aAO7CqH,GACD,CAAC9K,EAAiBwD,aAAcxD,EAAiByD,aAAaC,SAASJ,KAElEV,IAAEqQ,KAAK7P,EAAK6H,WAAW,SAAA3H,GAAQ,OAAIA,IAAatD,EAAiBuD,gBAGpEH,EAAK6H,UAAU3J,GAAYwR,GAAyB1P,GAFpDA,EAAK6H,UAAU3J,GAAYtB,EAAiBuD,kBAQ9C2P,GAA8B,SAAC7R,GACnC,IAAM8R,EAAa3Q,EAAgBnB,GAChB,IAAfA,EAAM6F,MACR7F,EAAMoB,MAAQpB,EAAM+R,iBACpB/R,EAAM+R,iBAAmBD,EACzB9R,EAAMuC,QAAU,GAChBvC,EAAM6F,KAAO,EACT7F,EAAMU,aAAelC,EAAWoC,QAClCZ,EAAM4F,SAER5F,EAAMU,WAAa,EAAIV,EAAMU,YAE7BV,EAAMoB,MAAQ0Q,G,GAIwBE,aAAY,CACpDV,KAAM,OACNC,gBACAU,SAAU,CACRC,gBADQ,SACQlS,EADR,GAC8D,IAA7CmS,EAA4C,EAA5CA,QACjBpQ,EAAO/B,EAAMgB,MAAMmR,EAAQpQ,MAC5BA,EAAKb,OAAOmB,SAAS8P,EAAQlS,YAChC8B,EAAKb,OAAOmE,KAAK8M,EAAQlS,UACzB8B,EAAK6H,UAAUuI,EAAQlS,UAAYwR,GAAyB1P,GAC5D4P,GAAgB5P,KAGpBqQ,WATQ,SASGpS,EATH,GAS0D,IAA9CmS,EAA6C,EAA7CA,QAClB,GAAIA,EAAQE,WAAaF,EAAQG,OAAQ,CACvC,IAAMvQ,EAAO/B,EAAMgB,MAAMmR,EAAQE,UACjCtQ,EAAKb,OCvGoB,SAAIqR,EAAWC,EAAoBC,GAClE,IAAMC,EAASC,MAAMC,KAAKL,GAD6D,EAErEG,EAAOG,OAAOL,EAAY,GAArCM,EAFgF,oBAKvF,OAFAJ,EAAOG,OAAOJ,EAAU,EAAGK,GAEpBJ,EDkGaK,CAAkBhR,EAAKb,OAAQiR,EAAQK,WAAYL,EAAQM,cACpE,CACL,IAAMO,EAAahT,EAAMgB,MAAMmR,EAAQE,UACjCY,EAAWjT,EAAMgB,MAAMmR,EAAQG,QAFhC,EChGuB,SAClCY,EACAC,EACAX,EACAC,GAEA,IAAMW,EAAcT,MAAMC,KAAKM,GACzBG,EAAYV,MAAMC,KAAKO,GAF1B,EAGeC,EAAYP,OAAOL,EAAY,GAA1CM,EAHJ,oBAMH,OADAO,EAAUR,OAAOJ,EAAU,EAAGK,GACvB,CAACM,EAAaC,GDwF0BC,CACvCN,EAAW9R,OACX+R,EAAS/R,OACTiR,EAAQK,WACRL,EAAQM,UAPL,mBAGEc,EAHF,KAGmBC,EAHnB,KASCvT,EAAW+S,EAAW9R,OAAOiR,EAAQK,YAC3CQ,EAAW9R,OAASqS,EACpBN,EAAS/R,OAASsS,EACgBjS,IAAEkB,QAClCwQ,EAASrJ,WACT,SAAA3H,GAAQ,OAAIA,IAAa+Q,EAAWpJ,UAAU3J,QAI7C6B,EAA6BmR,GAAU5Q,SAAS2Q,EAAWpJ,UAAU3J,IAEtEgT,EAASrJ,UAAU3J,GAAYwR,GAAyBwB,GAExDA,EAASrJ,UAAU3J,GAAY+S,EAAWpJ,UAAU3J,UAE/C+S,EAAWpJ,UAAU3J,GAC5B0R,GAAgBqB,GAChBrB,GAAgBsB,KAGpBQ,qBA1CQ,SA0CazT,EA1Cb,GA0CyD,IAAnCmS,EAAkC,EAAlCA,QAC5BnS,EAAMgB,MAAMgG,SAAQ,SAAAjF,GAClBA,EAAKb,OAASa,EAAKb,OAAOc,QAAO,SAAA/B,GAAQ,OAAIA,IAAakS,YACnDpQ,EAAK6H,UAAUuI,GACtBR,GAAgB5P,OAGpB2R,qBAjDQ,SAiDa1T,EAjDb,GAiD8E,IAAxDmS,EAAuD,EAAvDA,QACpBvI,EAAc5J,EAAMgB,MAAMmL,MAAK,qBAAGjL,OAAoBmB,SAAS8P,EAAQlS,aAAvE2J,UACF+J,EAA4BpS,IAAEkB,QAClCmH,GACA,SAAA3H,GAAQ,OAAIA,IAAakQ,EAAQlQ,YAE/B0R,IACF/J,EAAU+J,GAA6B/J,EAAUuI,EAAQlS,WAE3D2J,EAAUuI,EAAQlS,UAAYkS,EAAQlQ,UAExC2R,UA5DQ,SA4DE5T,GACRA,EAAMoB,MAAQpB,EAAMgB,MAAM,GAAGE,OAAO,GACpClB,EAAM+R,iBAAmB/R,EAAMgB,MAAM,GAAGE,OAAO,GAC/ClB,EAAM+M,OAASjO,EAAWmO,aAE5B4G,gBAjEQ,SAiEQ7T,EAjER,GAiEuD,IAAtCmS,EAAqC,EAArCA,QACvBzM,GAAe1F,EAAOmS,GADsC,kBAG7BnS,EAAMyF,MAHuB,GAGrD4J,EAHqD,KAG1CC,EAH0C,KAItDwE,EACW,IAAf9T,EAAM6F,MAAc7F,EAAMU,aAAelC,EAAWoS,KAAOvB,EAAYC,EACnEyE,EACW,IAAf/T,EAAM6F,MAAc7F,EAAMU,aAAelC,EAAWoC,QAAUyO,EAAYC,EAG1EtP,EAAM4F,QAAU5F,EAAMmP,aACrB2E,GACCC,GACC/T,EAAMU,aAAelC,EAAWoC,QAAUyO,EAAYC,GAEzDtP,EAAM+M,OAASjO,EAAWqO,SAE1B0E,GAA4B7R,IAGhCgU,iBArFQ,SAqFShU,EArFT,GAqFqD,IAAnCmS,EAAkC,EAAlCA,QACxBnS,EAAMmP,WAAagD,GAErB8B,oBAxFQ,SAwFYjU,GAClBA,EAAMmP,YAAc,GAEtB+E,oBA3FQ,SA2FYlU,GAClBA,EAAMmP,YAAc,GAEtBgF,WA9FQ,SA8FGnU,GACTA,EAAMmP,WAAavC,KAAK2C,IAAIvP,EAAM4F,OAAQ5F,EAAMmP,YAAc,EAC9DnP,EAAM+M,OAASjO,EAAWmO,YAC1B4E,GAA4B7R,IAE9BoU,UAnGQ,SAmGEpU,GACR,OAAO,2BACFuR,IADL,IAEEvQ,MAAOhB,EAAMgB,SAGjBqT,cAzGQ,WA0GN,OAAO,eAAK9C,QA7GD+C,G,GAATC,QAAsBC,G,GAAAA,QAmHfC,QAASD,GAAS,CAC/BxS,OAAQ0S,yBAAcJ,GAAYT,gBAAgBpN,MAClDkO,MAAO,GACPC,YAAY,IEhMRC,GAAe,WACnB,IAAMC,EAAW/E,KAEXgF,EAAYC,uBAAY,WAC5BF,EAASR,GAAYF,eACpB,CAACU,IAEJ,OACE,eAACvE,EAAA,EAAD,CAAK0E,IAAI,QAAQC,MAAM,QAAQzE,IAAI,QAAnC,UACE,cAACE,EAAA,EAAD,CAAMwE,UAAU,SAASzO,KAAK,QAA9B,sDAGA,cAAC0O,EAAA,EAAD,CAAQ1O,KAAK,QAAQpH,MAAM,kBAAkB+J,MAAM,QAAQgM,QAASN,QAkF3DO,GA7EM,WACnB,IAAMR,EAAW/E,KAEXwF,EAAatF,GAAeb,IAC5BoG,EAAavF,GAAeT,IAC5BiG,EAAoBxF,GAAef,IACnCwG,EAAazF,GAAejD,IAC5B2I,EAAiB1F,GAAeR,IAPb,EASuBmG,oBAAS,GAThC,mBASlBC,EATkB,KASAC,EATA,KAWnBC,EAAyBf,uBAC7B,YAAgD,IAA7CgB,EAA4C,EAA5CA,OACDlB,EAASR,GAAYN,iBAAiBiC,SAASD,EAAOE,WAExD,CAACpB,IAGGqB,EAAgCnB,uBACpC,kBAAMF,EAASR,GAAYJ,yBAC3B,CAACY,IAEGsB,EAA2BpB,uBAAY,kBAAMF,EAASR,GAAYL,yBAAwB,CAC9Fa,IAGF,OACE,eAACvE,EAAA,EAAD,CAAK0E,IAAK,CAAEoB,SAAU,SAAUC,WAAY,SAAW7F,IAAI,SAA3D,UACE,eAACF,EAAA,EAAD,WACE,cAACgG,GAAA,EAAD,CAASC,MAAO,EAAGC,OAAO,OAAOC,UAAU,SAA3C,yBAGA,eAACnG,EAAA,EAAD,CAAKC,UAAU,MAAME,MAAM,SAASD,IAAI,SAAxC,UACE,cAAC2E,EAAA,EAAD,CACEuB,KAAM,cAACC,GAAA,EAAD,IACNvB,QAASc,EACTU,SAAUpB,IAAsBF,GAAcI,IAEhD,cAACmB,GAAA,EAAD,CACEC,KAAM,EACNC,IAAKzB,EACLhG,IAAKiG,EACLU,MAAOT,EACPwB,SAAUlB,EACVc,SAAUlB,IAEZ,cAACP,EAAA,EAAD,CACEuB,KAAM,cAACO,GAAA,EAAD,IACN7B,QAASe,EACTS,SAAUpB,IAAsBD,GAAcG,OAGlD,eAAChF,EAAA,EAAD,CACEjK,KAAK,QACLgQ,UAAU,SACVpX,MAAOqW,EAAiB,uBAAoBlH,EAH9C,UAKGkH,EAAiB,WAAaF,EALjC,iBAQDC,GACC,cAACyB,GAAA,EAAD,CACE9N,MAAM,aACNsN,KAAM,cAACS,GAAA,EAAD,CAAY9X,MAAM,oBACxBA,MAAM,kBACNoX,UAAU,SACVW,KAAMxB,EACNyB,OAAQ,kBAAMxB,GAAoB,IAClCyB,YAAa,cAAC,GAAD,IACbC,UAAW,CAAE9G,MAAO,CAAE+G,IAAK,WAC3BC,QAAS,kBAAM5B,GAAoB,U,UCH9B6B,GA1F6B,SAAC,GAAyB,IAAvBjN,EAAsB,EAAtBA,MAAU1L,EAAY,yBACzC4Y,EAA8DlN,EAA/EhM,EAASoF,OAAkC+T,EAAoCnN,EAAtDhM,EAAS0E,QAAmC0U,EAAUpN,EAA3BhM,EAASyE,OACtE,OACE,cAAC4U,GAAA,EAAD,yBAAOrR,KAAK,SAAY1H,GAAxB,aACE,sBACEgZ,QAAQ,MACRC,MAAM,6BACNC,WAAW,+BACXC,oBAAoB,gBACpBC,QAAQ,YACRlD,MAAM,KACNmD,OAAO,KAPT,UASE,iCACE,sBAAMC,EAAE,sDAAsD7W,GAAG,eACjE,0BAAUA,GAAG,iBAAb,SACE,qBAAK8W,UAAU,cAAcC,QAAQ,QAEvC,sBAAMF,EAAE,+DAA+D7W,GAAG,cAC1E,0BAAUA,GAAG,gBAAb,SACE,qBAAK8W,UAAU,aAAaC,QAAQ,QAEtC,sBAAMF,EAAE,8DAA8D7W,GAAG,cACzE,0BAAUA,GAAG,iBAAb,SACE,qBAAK8W,UAAU,aAAaC,QAAQ,WAGxC,4BACE,8BACE,8BACE,qBACED,UAAU,aACVC,QAAQ,IACRC,KAAK,UACLC,YAAad,EAAQ,IAAM,MAE7B,mBAAGe,SAAS,sBAAZ,SACE,qBACEJ,UAAU,aACVC,QAAQ,IACRE,YAAY,IACZE,OAAO,UACPC,YAAY,IACZC,cAAc,WAIpB,8BACE,qBACEP,UAAU,cACVC,QAAQ,IACRC,KAAK,UACLC,YAAab,EAAS,IAAM,MAE9B,mBAAGc,SAAS,uBAAZ,SACE,qBACEJ,UAAU,cACVC,QAAQ,IACRE,YAAY,IACZE,OAAO,UACPC,YAAY,IACZC,cAAc,WAIpB,8BACE,qBACEP,UAAU,aACVC,QAAQ,IACRC,KAAK,UACLC,YAAaZ,EAAQ,IAAM,MAE7B,mBAAGa,SAAS,uBAAZ,SACE,qBACEJ,UAAU,aACVC,QAAQ,IACRE,YAAY,IACZE,OAAO,UACPC,YAAY,IACZC,cAAc,uBCRjBC,GAjEA,WACb,IAAMjE,EAAW/E,KACXiJ,EAAUC,cAEVC,EAAiBjJ,GAAejD,IAChCmM,EAAelJ,GAAexD,IAC9BlK,EAAU0N,GAAelE,IAEzB6H,EAAYoB,uBAAY,WAC5BF,EAASR,GAAYV,aACrBoF,EAAQ3T,KAAK,YACZ,CAACyP,EAAUkE,IAERI,EAAoBC,iBAAiC,MAbxC,EAcqBzD,oBAAS,GAd9B,mBAcZ0D,EAdY,KAcEC,EAdF,KAgBbC,EAAiBxE,uBAAY,kBAAMuE,GAAgB,SAAAE,GAAI,OAAKA,OAAO,CAACF,IAE1E,OACE,eAACG,EAAA,EAAD,CAAQC,WAAW,QAAnB,UACE,eAACC,EAAA,EAAD,CAAKpJ,UAAU,MAAMyE,IAAI,SAAzB,UACE,cAAC,EAAD,CAAY7V,GAAG,SAAf,mBACC8Z,GAAkB,cAAC,EAAD,CAAY9Z,GAAG,SAAf,mBAClB8Z,GAAkB,cAAC,EAAD,CAAY9Z,GAAG,aAAf,uBAClB8Z,GAAkB,cAAC,EAAD,CAAY9Z,GAAG,SAAf,sBAErB,eAACmR,EAAA,EAAD,CAAKC,UAAU,MAAMiG,OAAQ,CAAEoD,MAAO,SAAtC,UACGX,GACC,cAAC3I,EAAA,EAAD,CAAKmG,UAAU,SAASD,OAAQ,CAAEoD,MAAO,UAAzC,SACE,cAAC,GAAD,CAAcnP,MAAOnI,EAASjD,MAAM,cAGvC4Z,EACC,cAAC,GAAD,IAEA,cAAC,IAAD,CAAO/Z,KAAK,SAAZ,SACE,cAACiW,EAAA,EAAD,CACE0E,OAAO,EACPjD,UAAWsC,EACX9D,QAASzB,EACT6C,OAAQ,CAAEoD,MAAO,SAJnB,0BAUJ,cAACzE,EAAA,EAAD,CACEqB,OAAQ,CAAEsD,KAAM,SAChBpD,KAAM,cAACqD,EAAA,EAAD,IACNF,OAAO,EACPpD,UAAU,SACVpX,MAAM,UACN2a,IAAKb,EACL/D,QAASmE,IAEVF,GAAgBF,EAAkBc,SACjC,cAACC,EAAA,EAAD,CAAMnE,OAAQoD,EAAkBc,QAASxJ,MAAO,CAAE+G,IAAK,SAAUoC,MAAO,SAAxE,SACE,cAAC,GAAD,a,sEC1DNO,GAAyBC,yBAAc,GAwChCC,GAAsD,SAAC,GAI7D,IAHLjR,EAGI,EAHJA,MACAkR,EAEI,EAFJA,QACAC,EACI,EADJA,SAEMC,EAASC,qBAAWN,IAE1B,OACE,cAACO,GAAA,EAAD,CACEC,OACE,eAACrK,EAAA,EAAD,CACEC,UAAU,MACVqK,QAAQ,UACR5F,IAAI,QACJ6F,MAAM,MACNnB,WAAYc,OAAShM,EAAY,QALnC,UAOE,cAACkC,EAAA,EAAD,CAAMoK,OAAO,OAAb,SAAqB1R,KACnBoR,GACA,qCACGF,EACD,cAACS,GAAA,EAAD,UAbV,SAmBGR,KAKQS,GAtEa,SAAC,GAAkB,IAAhBT,EAAe,EAAfA,SACvBU,EAAYC,WAASC,MAAMZ,GADW,EAGF5E,mBAASrU,IAAE6M,MAAM8M,IAHf,mBAGrCG,EAHqC,KAGtBC,EAHsB,KAKtCC,EAA4BvG,uBAChC,SAACwG,GACCF,GAAiB,SAAAG,GACf,OAAID,EAAQ9Z,OAAS+Z,EAAe/Z,OAC3BH,IAAEma,OAAOF,GAASG,MAAM,GAE1BF,OAGX,CAACH,IAGH,OACE,cAACM,GAAA,EAAD,CACEjN,UAAQ,EACRkN,YAAaR,EACbS,SAAUP,EACV9K,IAAI,QAJN,SAMG0K,WAAS/R,IAAIoR,GAAU,SAACuB,EAAO3W,GAAR,OACtB,cAACgV,GAAuB4B,SAAxB,CAAyC9F,MAAOmF,EAAchZ,SAAS+C,GAAvE,SACG2W,GADmC3W,S,SC3BjC6W,GAA2B,SAACjc,GAAD,OAAqBA,EAAMkc,QAAQC,eAC9DC,GAA2B,SAACpc,GAAD,OAAqBA,EAAMkc,QAAQG,eAC9DC,GAA8B,SAACtc,GAAD,OAAqBA,EAAMkc,QAAQK,kBAEjEC,GAA8B,SAACxc,GAAD,OACzCA,EAAMkc,QAAQO,wBAIHC,GAA2B,SACtC1c,EACAyG,GAFsC,4BAItCJ,KAAM,kBACNI,OACAQ,YAAW,UAAEgV,GAAyBjc,UAA3B,aAAE,EAAiCiH,YAC9C0V,UAAS,UAAEP,GAAyBpc,UAA3B,aAAE,EAAiCiC,SAC5C6E,iBAAkBwV,GAA4Btc,GAC9C6G,mBAAoB2V,GAA4Bxc,IVsWM,SACtD4c,GAEA,IAAMvV,EAA8C,GAC9CD,EAAmD,GAYzD,OAVA7F,IAAEyF,QAAQ4V,GAAkB,SAACxR,EAAS5I,GAChC4I,EAAQzC,mBACNyC,EAAQxC,kBACVvB,EAAW7E,GAAY4I,EAAQvI,QAE/BuE,EAAgB5E,GAAY4I,EAAQvI,YAKnC,CAAEwE,aAAYD,mBUrXlByV,CAZ8B,SAAC7c,GAAD,OAAqBA,EAAMkc,QAAQY,cAYxBC,CAAoB/c,MCWnDgd,GAlCoB,WACjC,IAAM1Z,EAASoX,qBAAWuC,IADa,EAOnChN,IAAe,SAAAjQ,GAAK,ODmBe,SAACA,EAAiByG,GACzD,IAAMd,EAAQ+W,GAAyB1c,EAAOyG,GADyC,EAEhDyW,aTiIf,SAACld,GAAD,OAAqBA,EAAMuL,KAAKC,QSjID2R,CAAWnd,IAAQ,SAAAA,GAAK,OAC7E0F,GAAe1F,EAAO2F,MADhB2B,EAF+E,EAE/EA,YAAa/E,EAFkE,EAElEA,QAASsD,EAFyD,EAEzDA,KAI9B,MAAO,CAAEtD,UAASyC,cADQzD,IAAEmD,KAAK4C,GAAzBtC,cACyBa,QCzBLuX,CAA0Bpd,EAAOsD,MAH3Df,EAJqC,EAIrCA,QACyBiD,EALY,EAKrCR,cAAiBtD,OACjBmE,EANqC,EAMrCA,KAGF,OACE,eAAC0K,EAAA,EAAD,CAAKC,UAAU,MAAME,MAAM,SAASgG,UAAU,SAASjG,IAAI,SAA3D,UACE,cAACE,EAAA,EAAD,CAAMoK,OAAO,OAAb,qBACA,eAACxK,EAAA,EAAD,CACEuK,OAAK,EACLtK,UAAU,MACVE,MAAM,SACND,IAAI,QACJ4M,SAAU7X,EACVyP,IAAKzP,EAAO,cAAWiJ,EANzB,UAQE,eAAC8B,EAAA,EAAD,CAAKuK,OAAK,EAACtK,UAAU,MAAME,MAAM,SAASD,IAAI,QAAQkJ,WAAW,QAAQ1E,IAAI,QAA7E,UACE,cAAC,GAAD,CAAcvK,MAAOnI,IACrB,cAACoO,EAAA,EAAD,UAAgB,IAAT9K,EAAa,cAAb,UAAgCA,EAAhC,eAAoD,IAATA,EAAa,IAAM,WAEpEL,GACD,eAACmL,EAAA,EAAD,WACGnL,EADH,IACUA,EAAO,EAAI,aAAe,aADpC,cCkDK8X,GA9DQ,YAMK,IAL1B7S,EAKyB,EALzBA,QACAkE,EAIyB,EAJzBA,SACAuH,EAGyB,EAHzBA,MACAe,EAEyB,EAFzBA,SACGjY,EACsB,yDACnBue,EAAavI,uBACjB,SAACwI,GAAD,OAAa7O,EAAYuH,EAAc7T,SAASmb,GAAOA,IAAQtH,IAC/D,CAACvH,EAAUuH,IAGPuH,EAAoBzI,uBACxB,SAAC0I,GAAD,OAAmB,WACb/O,GAAYpN,IAAEoc,QAAQzH,GACvBe,EACCf,EAAM7T,SAASqb,GACXxH,EAAMlU,QAAO,SAAAwb,GAAG,OAAIA,IAAQE,KAC5BxH,EAAM0H,OAAOF,IAGlBzG,EAA8CyG,MAGnD,CAAC/O,EAAUuH,EAAOe,IAGpB,OACE,cAAC1G,EAAA,EAAD,yBAAKC,UAAU,MAAMsK,OAAK,EAACuC,QAAM,EAACQ,SAAS,UAAa7e,GAAxD,aACGyL,EAAQrB,KAAI,SAACV,EAAQoV,GACpB,IAAIzU,EAAO6M,EAAO6H,EACdxc,IAAEyc,SAAStV,IAAW,UAAWA,GACnCW,EAAQX,EAAOW,MACf6M,EAAQxN,EAAOwN,MACf6H,EAAWrV,EAAOqV,WAElB1U,EAAQ6M,EAAQxN,EAChBqV,GAAW,GAEb,IAAME,EAAWV,EAAWrH,GAE5B,OACE,cAAC3F,EAAA,EAAD,CAEE2N,MAAI,EACJhJ,MAAwB,kBAAV7L,GAAsBA,EAAM3H,OAAS,EAAI,UAAY,SACnE2T,QAASoI,EAAkBvH,GAC3ByD,WAAYsE,EAAW,QAAUF,EAAW,6BAA0BtP,EACtE0P,gBAAiBF,EACjBhJ,IAAI,QACJvE,MAAM,SACNmK,QAAQ,SACRwC,OAAQS,EAAQ,EAAI,CAAEM,KAAM,OAAQ1X,KAAM,YAAU+H,EAVtD,SAYE,cAACkC,EAAA,EAAD,CAAMwE,UAAU,SAAhB,SAA0B9L,KAZ5B,UACUyU,EADV,eACsBrT,EAAQ/I,gBCrDlC6P,GAA4B,CAChCuL,cAAe,GACfP,iBAAkB,GAClBE,uBAAwB,G,GAGkBzK,aAAY,CACtDV,KAAM,SACNC,gBACAU,SAAU,CACRoM,gBADQ,SAENre,EAFM,GAIL,IADCmS,EACF,EADEA,QAEFnS,EAAM8c,cAAc3K,EAAQ3P,UAAY2P,EAAQzJ,QAElD4V,kBAPQ,SAOUte,EAPV,GAOsD,IAAnCmS,EAAkC,EAAlCA,eAClBnS,EAAM8c,cAAc3K,IAE7BoM,iBAVQ,SAUSve,EAVT,GAU4D,IAA1CmS,EAAyC,EAAzCA,QACxBnS,EAAMmc,cAAgBhK,GAExBqM,mBAbQ,SAaWxe,UACVA,EAAMmc,eAEfsC,iBAhBQ,SAgBSze,EAhBT,GAgB4D,IAA1CmS,EAAyC,EAAzCA,QACxBnS,EAAMqc,cAAgBlK,GAExBuM,mBAnBQ,SAmBW1e,UACVA,EAAMqc,eAEfsC,oBAtBQ,SAsBY3e,EAtBZ,GAsB0D,IAArCmS,EAAoC,EAApCA,QAC3BnS,EAAMuc,iBAAmBpK,GAE3ByM,sBAzBQ,SAyBc5e,GACpBA,EAAMuc,iBAAmB,IAE3BsC,0BA5BQ,SA4BkB7e,EA5BlB,GA4B8D,IAAnCmS,EAAkC,EAAlCA,QACjCnS,EAAMyc,uBAAyBtK,GAEjC2M,4BA/BQ,SA+BoB9e,GAC1BA,EAAMyc,uBAAyB,GAEjCsC,YAAa,kBAAMxN,OArCfiD,G,GAAAA,QAAkBwK,G,GAATzK,QAyCFC,MCrBAyK,GA5B2B,SAAC,GAA2B,IAAzBxU,EAAwB,EAAxBA,QACrCqK,GAD6D,EAAf9G,SACnC+B,MAEjBmP,qBACE,kBAAM,WACJpK,EAASkK,GAAcR,yBAEzB,CAAC1J,IAGH,IAAMqK,EAAiBlP,GAAegM,IAEhCmD,EAAmBC,mBAAQ,kBAAM5U,EAAQrB,KAAI,kBAAoB,CAAEC,MAAtB,EAAGA,MAA0B6M,MAA7B,EAAUzU,SAAkC,CAC7FgJ,IAGI6U,EAAetK,uBACnB,SAACkB,GACCpB,EAASkK,GAAcT,iBAAiB9T,EAAQyL,OAElD,CAACpB,EAAUrK,IAGb,OACE,cAAC,GAAD,CAAgBA,QAAS2U,EAAkBlJ,MAAK,OAAEiJ,QAAF,IAAEA,OAAF,EAAEA,EAAgB1d,GAAIwV,SAAUqI,KCgBrEC,GAxCqD,SAAC,GAG9D,IAFL9U,EAEI,EAFJA,QAEI,IADJ+U,iBACI,SACE1K,EAAW/E,KAEjBmP,qBACE,kBAAM,WACJpK,EAASkK,GAAcN,yBAEzB,CAAC5J,IAGH,IAAMqK,EAAiBlP,GAAemM,IAEhCgD,EAAmBC,mBAAQ,kBAAM5U,EAAQrB,KAAI,kBAAoB,CAAEC,MAAtB,EAAGA,MAA0B6M,MAA7B,EAAUzU,SAAkC,CAC7FgJ,IAGI6U,EAAetK,uBACnB,SAACkB,GAAD,OAAmBpB,EAASkK,GAAcP,iBAAiBhU,EAAQyL,OACnE,CAACpB,EAAUrK,IAGb,OACE,eAAC8F,EAAA,EAAD,CAAK2N,MAAI,EAAT,UACGsB,GACC,cAACjJ,GAAA,EAAD,CAASC,MAAO,EAAGC,OAAQ,CAAEgB,IAAK,OAAQgI,OAAQ,UAAY/I,UAAU,SAAxE,oBAIF,cAAC,GAAD,CACEjM,QAAS2U,EACTlJ,MAAK,OAAEiJ,QAAF,IAAEA,OAAF,EAAEA,EAAgB1d,GACvBwV,SAAUqI,QCrBHI,GATiB,SAAC,GAAD,IAAG5R,EAAH,EAAGA,eAAgBG,EAAnB,EAAmBA,eAAnB,OAC9B,cAAC,GAAD,CAAsB5E,MAAM,UAAUkR,QAAQ,GAA9C,SACE,eAAChK,EAAA,EAAD,CAAKE,IAAI,QAAT,UACE,cAAC,GAAD,eAAmB3C,IAClBG,GAAkB,cAAC,GAAD,2BAAmBA,GAAnB,IAAmCuR,WAAW,WCqDxDG,GAzDyB,SAAlCA,EAAmC,GAKlC,IAJLnd,EAII,EAJJA,SACAiI,EAGI,EAHJA,QACAQ,EAEI,EAFJA,cACAE,EACI,EADJA,yBAEM2J,EAAW9E,cAEjBkP,qBAAU,WAER,OADApK,EAASkK,GAAcX,gBAAgB,CAAE7b,WAAUkG,OAAQ+B,EAAQQ,MAC5D,WACL6J,EAASkK,GAAcV,kBAAkB9b,OAE1C,CAACsS,EAAUtS,EAAUiI,EAASQ,IAEjC,IAAMkU,EAAiBlP,IAAe,SAAAjQ,GAAK,OPnBN,SAACA,EAAiBwC,GAAlB,OACrCxC,EAAMkc,QAAQY,cAActa,GOkBmBod,CAAwB5f,EAAOwC,MACxEqd,EAAa5P,IAAe,SAAAjQ,GAAK,OAAIG,EAAmBH,EAAOwC,MAE/D4c,EAAmBC,mBACvB,kBACE5U,EAAQrB,KAAI,SAAAV,GAAM,MAAK,CACrBW,MAAOZ,GAAqBC,GAC5BwN,MAAOxN,EAAOjH,GACdsc,SAAUrV,EAAOC,mBAAqBD,EAAOE,wBAEjD,CAAC6B,IAGGqV,EAAwBT,mBAC5B,kBAAMF,IAAc,OAAIhU,QAAJ,IAAIA,OAAJ,EAAIA,EAA2BgU,MACnD,CAACA,EAAgBhU,IAGbmU,EAAetK,uBACnB,SAACkB,GAAD,OACEpB,EAASkK,GAAcX,gBAAgB,CAAE7b,WAAUkG,OAAQ+B,EAAQyL,QACrE,CAACpB,EAAUtS,EAAUiI,IAGvB,OACE,eAAC8F,EAAA,EAAD,CAAKE,IAAI,QAAT,UACE,eAACF,EAAA,EAAD,CAAKC,UAAU,MAAMC,IAAI,QAAzB,UACE,cAACE,EAAA,EAAD,CAAM+F,UAAU,SAASxF,MAAO,CAAE6O,WAAY,UAA9C,SACGF,IAEH,cAAC,GAAD,CACE3B,MAAI,EACJzT,QAAS2U,EACTlJ,MAAK,OAAEiJ,QAAF,IAAEA,OAAF,EAAEA,EAAgB1d,GACvBwV,SAAUqI,OAGbQ,GAAyB,cAACH,EAAD,eAAkBG,QCvBnCE,GA9BqC,SAAC,GAK9C,IAJLlS,EAII,EAJJA,eACAI,EAGI,EAHJA,cACAH,EAEI,EAFJA,eACAkS,EACI,EADJA,aAEAf,qBAAU,kBAAMe,GAAa,KAAO,CAACA,IAErC,IAAMC,EAAsBjQ,GAAegM,IAErChO,EAAiBoR,mBACrB,kBAAMa,GAAuBnS,EAAemS,EAAoBjZ,eAChE,CAACiZ,EAAqBnS,IAGxB,OACE,eAACwC,EAAA,EAAD,CAAKE,IAAI,SAAT,UACE,eAAC,GAAD,WACE,cAAC,GAAD,CAAc3C,eAAgBA,EAAgBG,eAAgBA,IAC7DC,GACC,cAAC,GAAD,CAAsB7E,MAAM,UAAUkR,QAAQ,GAA9C,SACE,cAAC,GAAD,eAAkBrM,SAIxB,cAAC,GAAD,QCISiS,GA7BqC,SAAC,GAI9C,IAHLrS,EAGI,EAHJA,eACAC,EAEI,EAFJA,eACAkS,EACI,EADJA,aAEMC,EAAsBjQ,GAAegM,IAE3CiD,qBAAU,kBAAMe,IAAeC,KAAsB,CAACA,EAAqBD,IAHvE,MAKsCZ,mBACxC,kCAAOa,GAAuBnS,EAAemS,EAAoBjZ,oBAAjE,QAAkF,KAClF,CAACiZ,EAAqBnS,IAFhBE,EALJ,EAKIA,eAAgBC,EALpB,EAKoBA,cAKxB,OACE,eAACqC,EAAA,EAAD,CAAKE,IAAI,SAAT,UACE,eAAC,GAAD,WACE,cAAC,GAAD,CAAc3C,eAAgBA,EAAgBG,eAAgBA,IAC7DC,GACC,cAAC,GAAD,CAAsB7E,MAAM,UAAUkR,QAAQ,GAA9C,SACE,cAAC,GAAD,eAAkBrM,WAIrBgS,GAAuB,cAAC,GAAD,QCwBjBE,GA/CuD,SAAC,GAKhE,IAJLnS,EAII,EAJJA,eACAE,EAGI,EAHJA,qBACAJ,EAEI,EAFJA,eACAkS,EACI,EADJA,aAEMnL,EAAW/E,KAEXsQ,EAAqBpQ,GAAeuM,IAE1C0C,qBAAU,kBAAMe,GAAa,KAAO,CAACA,IAErC,IAAM/R,EAAgBmR,mBAAQ,yBAAMtR,QAAN,IAAMA,OAAN,EAAMA,EAAiBsS,KAAqB,CACxEtS,EACAsS,IAGIC,EAAyBtL,uBAC7B,SAACkB,GACCpB,EAASkK,GAAcH,0BAA0B3I,MAEnD,CAACpB,IAGH,OACE,eAACvE,EAAA,EAAD,CAAKE,IAAI,SAASgG,OAAQ,CAAEgB,IAAK,UAAjC,UACE,eAAClH,EAAA,EAAD,CAAKC,UAAU,MAAMC,IAAI,QAAzB,UACGtC,GACC,eAACoC,EAAA,EAAD,CAAKE,IAAI,SAASyN,MAAI,EAAtB,UACE,cAAC3H,GAAA,EAAD,CAASC,MAAO,EAAGC,OAAO,OAAOC,UAAU,SAA3C,4BAGA,cAAC,GAAD,CACEjM,QAAS0D,EACT+H,MAAOmK,EACPpJ,SAAUqJ,OAIfrS,GAAkB,cAAC,GAAD,eAAmBA,OAEvCC,GAAiB,cAAC,GAAD,eAAkBA,IACpC,cAAC,GAAD,QC3COqS,GAAsB,SAAC,GAAD,IAAG5R,EAAH,EAAGA,SAAUJ,EAAb,EAAaA,UAAb,OACjCI,EAAWJ,EAAU7M,OAAS,EAAI6M,EAAU7M,OAAS,GAyExC8e,GAvEyD,SAAC,GAGlE,IAAD,IAFJhB,iBAEI,SADD/U,EACC,6BACIkE,EAAwBlE,EAAxBkE,SAAUJ,EAAc9D,EAAd8D,UAEZuG,EAAW/E,KAEX0Q,GAAYF,GAAoB9V,GAEtCyU,qBAAU,WACJuB,GAEA3L,EADEnG,EACOqQ,GAAcL,oBAAoBpQ,GAElCyQ,GAAcL,oBAAoB,CAACpQ,EAAU,QAGzD,CAACI,EAAU8R,EAAUlS,EAAWuG,IAEnC,IAoBI4L,EApBEC,EAAkB1Q,GAAeqM,IAEjCsE,EAAqB5L,uBACzB,SAACkB,GACCpB,EAASkK,GAAcL,oBAAoB,CAACzI,OAE9C,CAACpB,IAGG+L,EAAuB7L,uBAC3B,SAACkB,GACCpB,EAASkK,GAAcL,oBAAoBzI,EAAMxU,OAAS,EAAIH,IAAEoa,MAAMzF,EAAO,GAAKA,MAEpF,CAACpB,IAGG5G,EAAgB+B,IAAe,SAAAjQ,GAAK,OzB7BD,SAACA,EAAiB8gB,GAAlB,OACzCA,EAAU1X,KAAI,SAAA3H,GAAE,MAAK,CAAE4H,MAAOlJ,EAAmBH,EAAOyB,GAAKyU,MAAOzU,MyB4BtBsf,CAA4B/gB,EAAOuO,MAEjF,OAAIkS,EAAiB,MAInBC,EADE/R,EAEA,cAAC,GAAD,CACEA,UAAQ,EACRlE,QAASyD,EACTgI,MAAOyK,EACP1J,SAAU4J,IAKZ,cAAC,GAAD,CACEpW,QAASyD,EACTgI,MAAOyK,EAAgB,GACvB1J,SAAU2J,IAKd,eAACrQ,EAAA,EAAD,WACGiP,GACC,eAACjJ,GAAA,EAAD,CAASC,MAAO,EAAGC,OAAQ,CAAEgB,IAAK,OAAQgI,OAAQ,UAAY/I,UAAU,SAAxE,UACG/H,EAAW,UAAY,SAD1B,kBAID+R,OCxCQM,GA7B2D,SAAC,GAKpE,IAJL/S,EAII,EAJJA,eACAK,EAGI,EAHJA,iBACAP,EAEI,EAFJA,eACAkS,EACI,EADJA,aACI,EACwBhQ,GAAeqM,IAApC2E,EADH,oBAGEC,IAAY5S,EAAiBC,UAAU7M,OAAS,MAAMuf,EAE5D/B,qBAAU,kBAAMe,EAAaiB,KAAY,CAACA,EAAWjB,IAErD,IAAM/R,EAAgBmR,mBAAQ,kBAAM4B,IAAiB,OAAIlT,QAAJ,IAAIA,OAAJ,EAAIA,EAAiBkT,MAAoB,CAC5FlT,EACAkT,IAGF,OACE,eAAC1Q,EAAA,EAAD,CAAKE,IAAI,SAASgG,OAAQ,CAAEgB,IAAK,SAAjC,UACE,eAAClH,EAAA,EAAD,CAAKC,UAAU,MAAMC,IAAI,QAAQC,MAAM,SAAvC,UACE,cAAC,GAAD,eAAmBzC,IACnB,cAAC,GAAD,eAAqBK,OAEtBJ,GAAiB,cAAC,GAAD,eAAkBA,IACnCgT,GAAa,cAAC,GAAD,QCmCLC,GA1DmD,SAAC,GAI5D,IAHLrT,EAGI,EAHJA,eACAC,EAEI,EAFJA,eACAkS,EACI,EADJA,aAEMC,EAAsBjQ,GAAegM,IACrCmF,EAAqBnR,GAAeqM,IAEpC+E,EAAchC,mBAClB,kBAAMa,GAAuBnS,EAAemS,EAAoBjZ,eAChE,CAAC8G,EAAgBmS,IAGboB,IACFD,KACAA,EAAY/S,kBACZ8S,EAAmB1f,UAAY2f,EAAY/S,iBAAiBK,SAAW,EAAI,IACzEuS,IAAchB,GAAuBoB,EAE3CpC,qBAAU,kBAAMe,EAAaiB,KAAY,CAACA,EAAWjB,IAErD,IAAM/R,EAAgBmR,mBACpB,wBACEgC,KACED,EAAmB1f,SADrB,UAEA2f,EAAYtT,sBAFZ,aAEA,OAAAsT,EAA6BD,MAC/B,CAACC,EAAaD,IAGhB,OACE,eAAC7Q,EAAA,EAAD,CAAKE,IAAI,SAAT,UACE,eAAC,GAAD,WACE,cAAC,GAAD,CACE3C,eAAgBA,EAChBG,eAAc,OAAEoT,QAAF,IAAEA,OAAF,EAAEA,EAAapT,kBAEnB,OAAXoT,QAAW,IAAXA,OAAA,EAAAA,EAAa/S,oBACXiS,GAAoBc,EAAY/S,kBAC/B,cAAC,GAAD,CACEjF,MAAK,gBAAWgY,EAAY/S,iBAAiBK,SAAW,IAAM,GAAzD,gBACL4L,QAAQ,GAFV,SAIE,cAAC,GAAD,2BAAqB8G,EAAY/S,kBAAjC,IAAmDkR,WAAW,OAGhE,cAAC,GAAD,eAAqB6B,EAAY/S,oBAEpCJ,GACC,cAAC,GAAD,CAAsB7E,MAAM,UAAUkR,QAAQ,GAA9C,SACE,cAAC,GAAD,eAAkBrM,SAIvBgT,GAAa,cAAC,GAAD,QC7CPjE,GAAgB5C,wBAAczb,EAAoBuI,KA8DhDoa,GA5DsB,SAAC,GAAoC,IAmBpEC,EAnBkCle,EAAiC,EAAjCA,OAAQme,EAAyB,EAAzBA,SAAUC,EAAe,EAAfA,SAClD5M,EAAW/E,KADsD,EAGrC6F,oBAAS,GAH4B,mBAGhEsL,EAHgE,KAGrDjB,EAHqD,KAKjE0B,EAAiBtC,mBAAQ,kBAAMxR,GAAoCvK,KAAS,CAACA,IAC7Ese,EAAS3R,GAAe0R,GACxBE,EAAS5R,GAAehE,IAU9B,GARAiT,qBAAU,kBAAM,WAAWpK,EAASkK,GAAcD,kBAAgB,CAACjK,IAEnEoK,qBAAU,WACH0C,GACHH,MAED,CAACG,EAAQH,KAEPG,EAAQ,OAAO,KAGpB,OAAQA,EAAOvb,MACb,IAAK,MACHmb,EAAa,cAAC,GAAD,2BAAeI,GAAf,IAAuB3B,aAAcA,KAClD,MACF,IAAK,MACHuB,EAAa,cAAC,GAAD,2BAAeI,GAAf,IAAuB3B,aAAcA,KAClD,MACF,IAAK,eACHuB,EAAa,cAAC,GAAD,2BAAwBI,GAAxB,IAAgC3B,aAAcA,KAC3D,MACF,IAAK,iBACHuB,EAAa,cAAC,GAAD,2BAA0BI,GAA1B,IAAkC3B,aAAcA,KAC7D,MACF,IAAK,aACHuB,EAAa,cAAC,GAAD,2BAAsBI,GAAtB,IAA8B3B,aAAcA,KAI7D,OACE,cAAC6B,GAAA,EAAD,UACE,eAACvR,EAAA,EAAD,CAAK0E,IAAI,SAAT,UACE,eAACsB,GAAA,EAAD,CAASC,MAAO,EAAGC,OAAO,OAAOC,UAAU,SAA3C,UACGzO,GAAwB3E,GAD3B,OACwCue,KAExC,cAAC5E,GAAcjB,SAAf,CAAwB9F,MAAO5S,EAA/B,SAAwCke,IACxC,eAACjR,EAAA,EAAD,CAAKC,UAAU,MAAMiG,OAAQ,CAAEgB,IAAK,UAAYoD,QAAQ,UAAUpK,IAAI,QAAtE,UACE,cAAC2E,EAAA,EAAD,CAAQ9V,MAAM,kBAAkB+J,MAAM,SAASgM,QAASqM,IACvDR,GACC,cAAC9L,EAAA,EAAD,CACE9V,MAAM,YACN+J,MAAK,iBAAYpB,GAAwB3E,IACzC+R,QAASoM,aC9DjBM,GAAe,CACnB,CACEziB,MAAO,YACP0iB,MAAO,CACLpjB,EAAoBuI,IACpBvI,EAAoBiF,gBACpBjF,EAAoBmI,cAGxB,CACEzH,MAAO,YACP0iB,MAAO,CACLpjB,EAAoB8E,OACpB9E,EAAoB6E,OACpB7E,EAAoB4E,OACpB5E,EAAoB2E,UAGxB,CACEjE,MAAO,YACP0iB,MAAO,CAACpjB,EAAoB+E,KAAM/E,EAAoBgI,iBAsD3Cqb,GAlDO,WACpB,IAAMnN,EAAW/E,KAEXtF,EAAUwF,GAAe7C,IAHL,EAKkCwI,qBALlC,mBAKnBsM,EALmB,KAKKC,EALL,KAOpBC,EAA8BpN,uBAAY,WAC1CkN,GACFpN,GAAS,SAACA,EAAUuN,GAClBvN,EACER,GAAYT,gBAAgB6I,GAAyB2F,IAAYH,QAIvEC,OAA0B1T,KACzB,CAACqG,EAAUoN,EAAwBC,IAEhCG,EAAqBtN,uBAAY,WACrCmN,OAA0B1T,KACzB,CAAC0T,IAEJ,OACE,eAAC5R,EAAA,EAAD,CAAKgS,SAAS,WAAW7R,MAAM,SAASmK,QAAQ,SAAhD,UACGkH,GAAa3Y,KAAI,gBAAG9J,EAAH,EAAGA,MAAO0iB,EAAV,EAAUA,MAAV,OAChB,cAACzR,EAAA,EAAD,CAAKC,UAAU,MAAME,MAAM,SAASmK,QAAQ,SAAS2H,aAAa,SAASC,MAAI,EAA/E,SACGT,EACEhgB,QAAO,SAAAsB,GAAM,OAAImH,EAAQpI,SAASiB,MAClC8F,KAAI,SAAA9F,GAAM,OACT,cAAC8R,EAAA,EAAD,CAEE9V,MAAOA,EACP+J,MAAOpB,GAAwB3E,GAC/B+R,QAAS,kBAAM8M,EAA0B7e,IACzCmT,OAAO,SAJFnT,WASd4e,GACC,cAAC,GAAD,CACE5e,OAAQ4e,EACRT,SAAUW,EACVV,SAAUY,QChFpB,SAASI,KAA2Q,OAA9PA,GAAWniB,OAAOoiB,QAAU,SAAU3M,GAAU,IAAK,IAAI5Q,EAAI,EAAGA,EAAIwd,UAAUlhB,OAAQ0D,IAAK,CAAE,IAAIyd,EAASD,UAAUxd,GAAI,IAAK,IAAI0d,KAAOD,EAActiB,OAAOwiB,UAAUC,eAAeC,KAAKJ,EAAQC,KAAQ9M,EAAO8M,GAAOD,EAAOC,IAAY,OAAO9M,IAA2BkN,MAAMC,KAAMP,WAEhT,SAASQ,GAAyBP,EAAQQ,GAAY,GAAc,MAAVR,EAAgB,MAAO,GAAI,IAAkEC,EAAK1d,EAAnE4Q,EAEzF,SAAuC6M,EAAQQ,GAAY,GAAc,MAAVR,EAAgB,MAAO,GAAI,IAA2DC,EAAK1d,EAA5D4Q,EAAS,GAAQsN,EAAa/iB,OAAOqB,KAAKihB,GAAqB,IAAKzd,EAAI,EAAGA,EAAIke,EAAW5hB,OAAQ0D,IAAO0d,EAAMQ,EAAWle,GAAQie,EAASE,QAAQT,IAAQ,IAAa9M,EAAO8M,GAAOD,EAAOC,IAAQ,OAAO9M,EAFxMwN,CAA8BX,EAAQQ,GAAuB,GAAI9iB,OAAOkjB,sBAAuB,CAAE,IAAIC,EAAmBnjB,OAAOkjB,sBAAsBZ,GAAS,IAAKzd,EAAI,EAAGA,EAAIse,EAAiBhiB,OAAQ0D,IAAO0d,EAAMY,EAAiBte,GAAQie,EAASE,QAAQT,IAAQ,GAAkBviB,OAAOwiB,UAAUY,qBAAqBV,KAAKJ,EAAQC,KAAgB9M,EAAO8M,GAAOD,EAAOC,IAAU,OAAO9M,EAMne,IAAI,GAAqB,gBAAoB,OAAQ,KAAmB,gBAAoB,OAAQ,CAClGsC,EAAG,+CACH7W,GAAI,eACW,gBAAoB,WAAY,CAC/CA,GAAI,kBACU,gBAAoB,MAAO,CACzC8W,UAAW,cACXC,QAAS,MAGP,GAAqB,gBAAoB,IAAK,KAAmB,gBAAoB,IAAK,KAAmB,gBAAoB,IAAK,KAAmB,gBAAoB,MAAO,CACtLD,UAAW,cACXC,QAAS,EACTC,KAAM,UACNC,YAAa,IACE,gBAAoB,IAAK,CACxCC,SAAU,wBACI,gBAAoB,MAAO,CACzCJ,UAAW,cACXC,QAAS,EACTE,YAAa,EACbE,OAAQ,UACRC,YAAa,EACbC,cAAe,QAGjB,SAAS8K,GAAQC,EAAMC,GACrB,IAAIC,EAAQF,EAAKE,MACbC,EAAUH,EAAKG,QACfhlB,EAAQokB,GAAyBS,EAAM,CAAC,QAAS,YAErD,OAAoB,gBAAoB,MAAOnB,GAAS,CACtDvK,oBAAqB,gBACrBC,QAAS,YACTlD,MAAO,GACPmD,OAAQ,GACR4B,IAAK6J,EACL,kBAAmBE,GAClBhlB,GAAQ+kB,EAAqB,gBAAoB,QAAS,CAC3DtiB,GAAIuiB,GACHD,GAAS,KAAM,GAAO,IAG3B,IAAIE,GAA0B,aAAiBL,IAChC,ICpDf,SAAS,KAA2Q,OAA9P,GAAWrjB,OAAOoiB,QAAU,SAAU3M,GAAU,IAAK,IAAI5Q,EAAI,EAAGA,EAAIwd,UAAUlhB,OAAQ0D,IAAK,CAAE,IAAIyd,EAASD,UAAUxd,GAAI,IAAK,IAAI0d,KAAOD,EAActiB,OAAOwiB,UAAUC,eAAeC,KAAKJ,EAAQC,KAAQ9M,EAAO8M,GAAOD,EAAOC,IAAY,OAAO9M,IAA2BkN,MAAMC,KAAMP,WAEhT,SAAS,GAAyBC,EAAQQ,GAAY,GAAc,MAAVR,EAAgB,MAAO,GAAI,IAAkEC,EAAK1d,EAAnE4Q,EAEzF,SAAuC6M,EAAQQ,GAAY,GAAc,MAAVR,EAAgB,MAAO,GAAI,IAA2DC,EAAK1d,EAA5D4Q,EAAS,GAAQsN,EAAa/iB,OAAOqB,KAAKihB,GAAqB,IAAKzd,EAAI,EAAGA,EAAIke,EAAW5hB,OAAQ0D,IAAO0d,EAAMQ,EAAWle,GAAQie,EAASE,QAAQT,IAAQ,IAAa9M,EAAO8M,GAAOD,EAAOC,IAAQ,OAAO9M,EAFxM,CAA8B6M,EAAQQ,GAAuB,GAAI9iB,OAAOkjB,sBAAuB,CAAE,IAAIC,EAAmBnjB,OAAOkjB,sBAAsBZ,GAAS,IAAKzd,EAAI,EAAGA,EAAIse,EAAiBhiB,OAAQ0D,IAAO0d,EAAMY,EAAiBte,GAAQie,EAASE,QAAQT,IAAQ,GAAkBviB,OAAOwiB,UAAUY,qBAAqBV,KAAKJ,EAAQC,KAAgB9M,EAAO8M,GAAOD,EAAOC,IAAU,OAAO9M,EAMne,IAAI,GAAqB,gBAAoB,OAAQ,KAAmB,gBAAoB,OAAQ,CAClGsC,EAAG,mCACH7W,GAAI,eACW,gBAAoB,WAAY,CAC/CA,GAAI,kBACU,gBAAoB,MAAO,CACzC8W,UAAW,cACXC,QAAS,MAGP,GAAqB,gBAAoB,IAAK,KAAmB,gBAAoB,IAAK,KAAmB,gBAAoB,IAAK,KAAmB,gBAAoB,IAAK,CACpLG,SAAU,wBACI,gBAAoB,MAAO,CACzCJ,UAAW,cACXC,QAAS,EACTE,YAAa,EACbE,OAAQ,UACRC,YAAa,EACbC,cAAe,QAGjB,SAASoL,GAAQL,EAAMC,GACrB,IAAIC,EAAQF,EAAKE,MACbC,EAAUH,EAAKG,QACfhlB,EAAQ,GAAyB6kB,EAAM,CAAC,QAAS,YAErD,OAAoB,gBAAoB,MAAO,GAAS,CACtD1L,oBAAqB,gBACrBC,QAAS,YACTlD,MAAO,GACPmD,OAAQ,GACR4B,IAAK6J,EACL,kBAAmBE,GAClBhlB,GAAQ+kB,EAAqB,gBAAoB,QAAS,CAC3DtiB,GAAIuiB,GACHD,GAAS,KAAM,GAAO,IAG3B,IAAI,GAA0B,aAAiBG,ICtBzCC,IDuBS,ICvBF,SAAC,GAAD,IAAGC,EAAH,EAAGA,SAAH,OACX,cAACrM,GAAA,EAAD,CAAOrR,KAAK,QAAQpH,MAAO8kB,EAAW,aAAU3V,EAAWiK,YAAa0L,EAAW,OAAI3V,EAAvF,SACE,cAAC,GAAD,QAGE4V,GAAY,kBAChB,cAACtM,GAAA,EAAD,CAAOrR,KAAK,QAAZ,SACE,cAAC,GAAD,OAwFW4d,GApFD,WACZ,IAAMxP,EAAW/E,KAEXmJ,EAAiBjJ,GAAejD,IAHpB,EAQdiD,GAAelE,IAHCwY,EALF,EAKf7lB,EAASoF,OACS0gB,EANH,EAMf9lB,EAAS0E,QACQqhB,EAPF,EAOf/lB,EAASyE,OAEN0e,EAAS5R,GAAehE,IACxByY,EAASzU,GAAetC,IACxBgX,EAAY1U,GAAerC,IAC3BgX,EAAe3U,GAAeL,IAC9BiV,EAAe5U,GAAeH,IAE9BgV,EAAO9P,uBAAY,WACvBF,EAASiQ,kBAAeD,UACvB,CAAChQ,IAEEkQ,EAAOhQ,uBAAY,WACvBF,EAASiQ,kBAAeC,UACvB,CAAClQ,IAEJ,OAAKoE,EAKH,eAAC3I,EAAA,EAAD,CAAKkI,MAAI,EAAT,UACE,cAAClI,EAAA,EAAD,CAAK2N,MAAI,EAAT,SACE,eAAC+G,GAAA,EAAD,CACExM,MAAI,EACJyM,KAAM,CAAC,SAAU,OAAQ,UACzBC,QAAS,CAAC,QAAS,OAAQ,SAC3BC,MAAO,CACL,CAAC,YAAa,cAAe,KAC7B,CAAC,aAAc,WAAY,cAC3B,CAAC,IAAK,aAAc,MAPxB,UAUE,uBAAOC,QAAM,EAAb,0GAKA,eAAC9U,EAAA,EAAD,CAAKgS,SAAS,YAAY/R,UAAU,MAAMiG,OAAO,SAAShG,IAAI,QAA9D,UACE,cAAC2E,EAAA,EAAD,CAAQuB,KAAM,cAAC2O,GAAA,EAAD,IAAUzO,UAAW+N,EAAcvP,QAASyP,IAC1D,cAAC1P,EAAA,EAAD,CAAQuB,KAAM,cAAC4O,GAAA,EAAD,IAAU1O,UAAWgO,EAAcxP,QAAS2P,OAE5D,eAACzU,EAAA,EAAD,CAAKgS,SAAS,aAAa/R,UAAU,MAAMqK,QAAQ,MAAMnK,MAAM,SAA/D,UACE,cAACC,EAAA,EAAD,CAAMwE,UAAU,SAAhB,SAA0BoP,IAC1B,cAAC,GAAD,CAAMH,WAAYG,OAEpB,eAAChU,EAAA,EAAD,CAAKgS,SAAS,cAAc7R,MAAM,SAAlC,UACE,cAAC,GAAD,CAAM0T,WAAYI,IAClB,cAAC7T,EAAA,EAAD,UAAO6T,OAET,eAACjU,EAAA,EAAD,CAAKgS,SAAS,aAAa/R,UAAU,MAAME,MAAM,SAAjD,UACE,cAAC,GAAD,CAAM0T,WAAYK,IAClB,cAAC9T,EAAA,EAAD,CAAMwE,UAAU,SAAhB,SAA0BsP,OAE5B,eAAClU,EAAA,EAAD,CAAKgS,SAAS,aAAa1H,QAAQ,MAAMnK,MAAM,SAA/C,UACE,cAACC,EAAA,EAAD,CAAMoK,OAAO,OAAOrU,KAAK,SAAzB,SACGmb,IAEH,cAAC,GAAD,OAEF,cAAC,GAAD,SAGJ,eAACtR,EAAA,EAAD,CAAK8M,OAAQ,CAAEe,KAAM,OAAS5N,UAAU,MAAMqK,QAAQ,SAAS5F,IAAI,SAAnE,UACE,eAAC1E,EAAA,EAAD,CAAKC,UAAU,MAAMC,IAAI,QAAzB,UACE,cAACE,EAAA,EAAD,sBACA,cAACA,EAAA,EAAD,CAAMoK,OAAO,OAAb,SAAqB2J,OAEvB,eAACnU,EAAA,EAAD,CAAKC,UAAU,MAAMC,IAAI,QAAzB,UACE,cAACE,EAAA,EAAD,0BACA,cAACA,EAAA,EAAD,CAAMoK,OAAO,OAAb,SAAqB4J,aArDpB,cAAC,IAAD,CAAUvlB,GAAG,Y,iDCuBTomB,GA/DiB,SAAC,GAA+B,IAA7BvlB,EAA4B,EAA5BA,SAAU6d,EAAkB,EAAlBA,MAAO/b,EAAW,EAAXA,KAC5C+S,EAAW/E,KAEXuB,EAAOrB,IAAe,SAAAjQ,GAAK,OAAIG,EAAmBH,EAAOC,MACzDgC,EAAWgO,IAAe,SAAAjQ,GAAK,OAAIkM,GAAkBlM,EAAOC,MAE5DwlB,EAAqBxV,IAAe,SAAAjQ,GAAK,O5BaZ,SAACA,EAAiB+B,GAAlB,OACnCD,EAA6BwJ,GAAStL,GAAO+B,I4BdM2jB,CAAsB1lB,EAAO+B,MAC1E4jB,EAAkBtG,mBACtB,kBACEoG,EAAmBrc,KAAI,SAAAnH,GAAQ,MAAK,CAClCA,WACAoH,MAAO7B,GAAwBvF,SAEnC,CAACwjB,IAGGG,EAAe5Q,uBAAY,WAC/BF,EAASR,GAAYb,qBAAqBxT,MACzC,CAACA,EAAU6U,IAER+Q,EAAuB7Q,uBAC3B,YAA6C,IAA1CkB,EAAyC,EAAzCA,MACDpB,EAASR,GAAYZ,qBAAqB,CAAEzT,WAAUgC,SAAUiU,OAElE,CAACpB,EAAU7U,IAGb,OACE,cAAC,KAAD,CAAW6lB,YAAa7lB,EAAU6d,MAAOA,EAAzC,SACG,gBAAGiI,EAAH,EAAGA,SAAUC,EAAb,EAAaA,eAAgBC,EAA7B,EAA6BA,gBAA7B,OACC,eAAC1V,EAAA,EAAD,qCACE0J,IAAK8L,GACDC,GACAC,GAHN,IAIEzV,UAAU,MACV6H,OAAO,UACP3H,MAAM,SACNmK,QAAQ,UAPV,UASE,cAAClK,EAAA,EAAD,CAAM8F,OAAQ,CAAEoD,MAAO,QAAvB,SAAkCvI,IAClC,cAAC4U,GAAA,EAAaC,OAAd,CAAqBjQ,MAAO,CAAEkQ,OAAQ,CAAE1f,KAAM,CAAE2f,OAAQ,WAAxD,SACE,cAAC9V,EAAA,EAAD,CAAK2E,MAAM,SAASuB,OAAQ,CAAEoD,MAAO,SAArC,SACE,cAACyM,GAAA,EAAD,CACEpQ,MAAOjU,EACPwI,QAASkb,EACTY,SAAS,QACTC,SAAU,CAAE1D,IAAK,WAAY2D,QAAQ,GACrCxP,SAAU4O,QAIhB,cAACzQ,EAAA,EAAD,CACE0E,OAAO,EACPnD,KAAM,cAAC+P,GAAA,EAAD,CAAOhgB,KAAK,QAAQpH,MAAM,oBAChCA,MAAM,kBACN+V,QAASuQ,YCKNe,GAlEA,SAAC,GAAkC,IAAhC5kB,EAA+B,EAA/BA,KACV+S,EAAW/E,KAEX7P,EAAU+P,IAAe,SAAAjQ,GAAK,O7ByDb,SAACA,EAAiB4mB,GAAlB,OAAyCtb,GAAStL,GAAO4mB,GAAU1lB,O6BzDlD2lB,CAAU7mB,EAAO+B,MACnD+kB,EAAmB7W,GAAe5D,IAJO,EAMTuJ,mBAAS,IANA,mBAMxCmR,EANwC,KAM3BC,EAN2B,KAQzCC,EAAc5H,mBAAQ,WAC1B,OAAK0H,EAAYrlB,OAEVolB,EACJ9kB,QAAO,qBAAGnC,UAA0BqnB,cAAcC,WAAWJ,EAAYG,kBACzE9d,KAAI,SAAAhJ,GAAM,MAAK,CAAE8V,MAAO9V,EAAOH,SAAUoJ,MAAOzJ,EAAgBQ,OAJnC,KAK/B,CAAC0mB,EAAkBC,IAEhBK,EAAqBpS,uBACzB,gBAAGqS,EAAH,EAAGA,cAAH,OAAsDL,EAAeK,EAAcnR,SACnF,CAAC8Q,IAGGM,EAAkEtS,uBACtE,YAAqB,IAAlBuS,EAAiB,EAAjBA,WACGA,IACFzS,EAASR,GAAYpC,gBAAgB,CAAEnQ,OAAM9B,SAAUsnB,EAAWrR,SAClE8Q,EAAe,OAGnB,CAACjlB,EAAM+S,EAAUkS,IAGnB,OACE,eAACzW,EAAA,EAAD,CAAK2N,MAAI,EAAT,UACE,cAAC3H,GAAA,EAAD,CAASC,MAAO,EAAGrB,UAAU,SAASsB,OAAQ,CAAEgB,IAAK,QAArD,SACG1V,IAAStD,EAASqC,KAAO,YAAc,cAE1C,cAAC0mB,GAAA,EAAD,CACEC,YAAY,aACZR,YAAaA,EACb/Q,MAAO6Q,EACP9P,SAAUmQ,EACVM,SAAUJ,IAEZ,eAAC/W,EAAA,EAAD,CAAKC,UAAU,MAAMiG,OAAQ,CAAEgB,IAAK,SAApC,UACE,cAAClH,EAAA,EAAD,CAAK2E,MAAM,UAAX,SACG3T,IAAE6M,MAAM,EAAG,IAAIhF,KAAI,SAAAue,GAAU,OAC5B,cAACpX,EAAA,EAAD,CAAsB8H,OAAO,UAAUwC,QAAQ,SAA/C,SACE,cAAClK,EAAA,EAAD,UAAOgX,KADCA,QAKd,cAAC,KAAD,CAAWC,YAAa7lB,IAAStD,EAASqC,KAAO,OAAS,OAA1D,SACG,gBAAGilB,EAAH,EAAGA,SAAU8B,EAAb,EAAaA,eAAgBJ,EAA7B,EAA6BA,YAA7B,OACC,eAAClX,EAAA,EAAD,yBAAK0J,IAAK8L,GAAc8B,GAAxB,IAAwC3J,MAAI,EAA5C,UACGhe,EAAQkJ,KAAI,SAACnJ,EAAU6d,GAAX,OACX,cAAC,GAAD,CAA6B7d,SAAUA,EAAU6d,MAAOA,EAAO/b,KAAMA,GAAlD9B,MAEpBwnB,gBCzBAK,GAnCD,WACZ,IAAMhT,EAAW/E,KAEXgY,EAAmD/S,uBACvD,YAA8B,IAA3B6N,EAA0B,EAA1BA,OAAQmF,EAAkB,EAAlBA,YACJA,GACLlT,EACER,GAAYlC,WAAW,CACrBC,SAAU5T,EAASokB,EAAO+E,aAC1BtV,OAAQ7T,EAASupB,EAAYJ,aAC7BpV,WAAYqQ,EAAO/E,MACnBrL,SAAUuV,EAAYlK,WAI5B,CAAChJ,IAGH,OACE,cAAC,KAAD,CAAiBmT,UAAWF,EAA5B,SACE,eAACxX,EAAA,EAAD,CACEC,UAAU,MACVqK,QAAQ,SACR5F,IAAI,SACJxE,IAAI,SACJyN,KAAM,CAAEgK,OAAQ,GAChBC,MAAM,OANR,UAQE,cAAC,GAAD,CAAQpmB,KAAMtD,EAASqC,OACvB,cAAC,GAAD,CAAQiB,KAAMtD,EAASoC,a,oBClClBunB,GAA4B,CACvCC,OAAQ,EACRC,KAAM,EACNC,QAAS,EACTC,QAAS,EACTC,SAAU,EACVC,MAAO,EACPC,YAAa,EACbC,eAAgB,EAChBC,aAAc,EACdC,WAAY,EACZC,WAAY,EACZC,eAAgB,EAChBC,sBAAuB,EACvBC,WAAY,GCXDC,GAAc7oB,YAAe2O,GAAgB3D,IAAU,SAAC0N,EAAShY,GAC5E,IAAMooB,EDasB,SAACC,GAC7B,IAAMD,EAAwC,GACxCE,EAAe,SAACrpB,EAAkB2E,GAChC3E,KAAYmpB,IAChBA,EAASnpB,GAAT,eAA0BmoB,KAE5BxjB,EAASwkB,EAASnpB,KA4DpB,OA1DAopB,EAAMriB,SAAQ,YAA2D,IAAxDjB,EAAuD,EAAvDA,UAAWJ,EAA4C,EAA5CA,MAAOX,EAAqC,EAArCA,cAAegB,EAAsB,EAAtBA,gBAChDhB,EAAcgC,SAAQ,SAAAxE,GACpB8mB,EAAa9mB,GAAU,SAAA+mB,GAAcA,EAAMT,mBAE1B,sBAAfnjB,EAAMU,KACRijB,EAAa3jB,EAAMnD,UAAU,SAAA+mB,GACvB5jB,EAAMa,QACR+iB,EAAMZ,cAENY,EAAMX,oBAIVU,EAAavjB,EAAU3E,OAAQ,SAAAmoB,GAG7B,GAFAA,EAAMV,cAAgB7iB,EAAgBtE,OAElCiE,EAAMc,OAAS7H,EAAoB+E,KACrC4lB,EAAMb,aACD,GAAI/iB,EAAMc,OAAS7H,EAAoBgI,cAC5C2iB,EAAMP,sBAGN,OADAO,EAAMlB,SACE1iB,EAAMc,MACZ,KAAK7H,EAAoB8E,OACvB6lB,EAAMjB,OACN,MACF,KAAK1pB,EAAoB6E,OACvB8lB,EAAMjB,OACNiB,EAAMhB,UACN,MACF,KAAK3pB,EAAoB4E,OACvB+lB,EAAMjB,OACNiB,EAAMf,UACN,MACF,KAAK5pB,EAAoB2E,QACvBgmB,EAAMjB,OACNiB,EAAMd,WACN,MACF,KAAK7pB,EAAoBuI,IACnBxB,EAAMsB,cAAgBpI,EAAY0J,MACpCghB,EAAMR,aAERQ,EAAML,YAAc3nB,IAAEmF,KAAKX,EAAUxD,SACrC,MACF,KAAK3D,EAAoBmI,YACnBpB,EAAMsB,cAAgBpI,EAAYqI,UACpCqiB,EAAMN,wBAERM,EAAML,YAAc3nB,IAAEmF,KAAKX,EAAUxD,SAAW,EAChD,MACF,KAAK3D,EAAoBiF,gBACvB0lB,EAAML,YAAc3nB,IAAEmF,KAAKX,EAAUxD,gBAO1C6mB,EC/EUI,CAAexQ,GAChC,OAAOhY,EAAMoI,KAAI,qBAAGlI,OACXkI,KAAI,SAACnJ,EAAU6d,GAAW,IAAD,EACxB2L,EAAW,UAAGL,EAASnpB,UAAZ,QAAyBmoB,GAC1C,OAAO,yBACLnoB,WACA0nB,WAAY7J,EAAQ,GACjB2L,GACAloB,IAAEyK,UD0Ee,SAC1Bud,GAWA,IAAMG,EAAiBH,EAAMjB,KAAOiB,EAAMlB,OACpCsB,GACHJ,EAAMjB,KAAOiB,EAAMb,QAAUa,EAAMlB,OAASkB,EAAMb,MAAQa,EAAMP,gBAC7DY,GACHL,EAAMjB,KAAOiB,EAAMhB,QAAU,EAAIgB,EAAMf,QAAU,EAAIe,EAAMd,UAAYc,EAAMlB,OAChF,MAAO,CACLqB,iBACAC,mBACAC,qBACAC,mBAAoBF,EAAmBC,EACvCE,cAAeF,EAAqBF,GChGjBK,CAAaN,IAAc,SAAAjM,GAAG,OAC3Cjc,IAAEyoB,MAAMxM,GAAO,MDmGI,SAACA,GAC5B,IAAMyM,EAAYzM,EAAI0M,QAAQ,GAC9B,OAAO1M,GAAO,EAAIyM,EAAYA,EAAUtO,MAAM,GCrGfwO,CAAc3M,gBCAzC4M,GAA8B,SAAC,GAA8B,IAA5BnqB,EAA2B,EAA3BA,SAAU0nB,EAAiB,EAAjBA,WACzCrW,EAAOrB,IAAe,SAAAjQ,GAAK,OAAIG,EAAmBH,EAAOC,MACzDgC,EAAWgO,IAAe,SAAAjQ,GAAK,OAAIkM,GAAkBlM,EAAOC,MAElE,OACE,eAACsQ,EAAA,EAAD,CAAKC,UAAU,MAAME,MAAM,SAASD,IAAI,SAAxC,UACE,cAACE,EAAA,EAAD,CAAMjK,KAAK,QAAQpH,MAAM,SAAzB,SACGqoB,IAEH,cAAChX,EAAA,EAAD,CAAMoK,OAAO,OAAO7J,MAAO,CAAE6O,WAAY,UAAzC,SACGzO,IAEH,cAACX,EAAA,EAAD,CAAMO,MAAO,CAAEmZ,UAAW,UAA1B,SAAuC7iB,GAAwBvF,SAU/DqoB,GAAsC,SAAC,GAAoB,IAAlBpF,EAAiB,EAAjBA,KAAMnjB,EAAW,EAAXA,KACnD,OACE,cAACwoB,GAAA,EAAD,CAAMtV,IAAI,QAAQ0E,WAAW,UAAUlD,OAAO,QAA9C,SACE,cAAC+T,GAAA,EAAD,CACE/T,OAAO,QACP0O,QAAS,CACP,CACEsF,SAAU,WACV7P,OAAQ,eAACjK,EAAA,EAAD,WAAO5O,IAAStD,EAASqC,KAAO,OAAS,OAAzC,cACR4pB,SAAS,EACTC,OAAQ,gBAAG1qB,EAAH,EAAGA,SAAU0nB,EAAb,EAAaA,WAAb,OACN,cAAC,GAAD,CAAU1nB,SAAUA,EAAU0nB,WAAYA,MAG9C,CAAE8C,SAAU,SAAU7P,OAAQ,MAC9B,CAAE6P,SAAU,aAAc7P,OAAQ,KAClC,CAAE6P,SAAU,OAAQ7P,OAAQ,KAC5B,CAAE6P,SAAU,eAAgB7P,OAAQ,OACpC,CAAE6P,SAAU,QAAS7P,OAAQ,MAC7B,CAAE6P,SAAU,aAAc7P,OAAQ,OAClC,CAAE6P,SAAU,iBAAkB7P,OAAQ,OACtC,CAAE6P,SAAU,qBAAsB7P,OAAQ,QAE5CgQ,KAAM1F,OAsBC2F,GAhBE,WACf,IAAM3R,EAAiBjJ,GAAejD,IADjB,EAEUiD,GAAekZ,IAFzB,mBAEd2B,EAFc,KAEHC,EAFG,KAIrB,OAAK7R,EAKH,eAAC3I,EAAA,EAAD,CAAK2N,MAAI,EAAC1N,UAAU,MAAMiS,MAAI,EAAC5H,QAAQ,SAASnK,MAAM,SAAtD,UACE,cAAC,GAAD,CAAcwU,KAAM4F,EAAW/oB,KAAMtD,EAASqC,OAC9C,cAAC,GAAD,CAAcokB,KAAM6F,EAAWhpB,KAAMtD,EAASoC,UANzC,cAAC,IAAD,CAAUzB,GAAG,Y,oBClElB4rB,GAAiD,SAAC,GAAc,IAAZvkB,EAAW,EAAXA,KACpDkT,EAAa,GACjB,OAAQlT,GACN,KAAK7H,EAAoB+E,KACvBgW,EAAa,YACb,MACF,KAAK/a,EAAoBuI,IACzB,KAAKvI,EAAoBiF,gBACzB,KAAKjF,EAAoBmI,YACvB4S,EAAa,YACb,MACF,QACEA,EAAa,YAGjB,OACE,cAACpJ,EAAA,EAAD,CACEuK,MAAO,CAAEpU,KAAM,OACfiT,WAAYA,EACZjD,UAAU,SACVzB,IAAK,CAAEoB,SAAU,UAAWC,WAAY,UACxC4H,MAAM,EALR,SAOE,cAACvN,EAAA,EAAD,CAAMjK,KAAK,SAAX,SAAqBuB,GAAwBxB,GAAMwkB,mBAKnDC,GAA4C,SAAC,GAAD,oBAAGzlB,MAAH,GAAW0lB,EAAX,KAAiBC,EAAjB,YAChD,cAAC7a,EAAA,EAAD,CACEuK,MAAO,CAAEpU,KAAM,OACf2W,QAAM,EACN3G,UAAU,QACVzB,IAAK,CAAEoB,SAAU,UAAWC,WAAY,UACxC4H,MAAM,EACNzH,OAAQ,CAAEgB,IAAK,UANjB,SAQE,eAAC9G,EAAA,EAAD,CAAMjK,KAAK,SAAX,kBACQykB,EADR,WACsBC,QAsBXC,GAjBmB,SAAC,GAAD,IAAGC,EAAH,EAAGA,YAAazlB,EAAhB,EAAgBA,KAAMJ,EAAtB,EAAsBA,MAAOgB,EAA7B,EAA6BA,KAA7B,OAChC,eAAC8J,EAAA,EAAD,CAAK0E,IAAK,CAAEoB,SAAU,SAAW7F,UAAU,MAAMqK,QAAQ,UAAUpK,IAAI,SAAvE,UACE,eAACF,EAAA,EAAD,WACE,eAACI,EAAA,EAAD,WACE,cAACA,EAAA,EAAD,UAAO2a,IACNzlB,GACC,eAAC8K,EAAA,EAAD,CAAMoK,OAAO,OAAOtE,OAAQ,CAAEsD,KAAM,UAApC,UACGlU,EADH,IACUA,EAAO,EAAI,OAAS,MAAO,UAIxCJ,GAAS,cAAC,GAAD,CAAUA,MAAOA,OAE5BgB,GAAQ,cAAC,GAAD,CAAaA,KAAMA,QCvCjB8kB,GAfmC,SAAC,GAAD,IAAG3lB,EAAH,EAAGA,OAAQlF,EAAX,EAAWA,WAAY2oB,EAAvB,EAAuBA,MAAvB,OAChD,eAACkB,GAAA,EAAD,CAAM5Q,WAAW,UAAjB,UACE,cAAC6R,GAAA,EAAD,CAAY7R,WAAW,UAAU1E,IAAI,SAArC,SACE,eAACtE,EAAA,EAAD,WACGjQ,IAAelC,EAAWoS,IAAM,MAAQ,SAD3C,IACsD9H,GAAiBlD,QAGzE,cAAC6lB,GAAA,EAAD,CAAUxW,IAAK,CAAEqB,WAAY,SAAUD,SAAU,SAAW5F,IAAI,QAAQ4M,OAAO,UAA/E,SACGgM,EAAMjgB,KAAI,SAACsiB,EAAMtmB,GAAP,OACT,cAAC,GAAD,eAAkBsmB,GAAPtmB,YCHbumB,GAAmB,SAAC1pB,GAAD,aACtB,mBACEtD,EAAiB8I,QAAU,WAD7B,cAEE9I,EAAiB+I,QAAU,WAF7B,cAGE/I,EAAiBgJ,WAAa,iBAHhC,cAIEhJ,EAAiBiJ,YAAc,kBAJjC,cAKEjJ,EAAiBkJ,WAAa,iBALhC,cAMElJ,EAAiBmJ,UAAY,aAN/B,cAOEnJ,EAAiBoJ,WAAa,gBAPhC,cAQEpJ,EAAiBuD,aAAe,kBARlC,cASEvD,EAAiByD,YAAc,uBATjC,cAUEzD,EAAiBwD,aAAe,wBAVlC,cAWExD,EAAiBqJ,YAAc,iBAXjC,GAYC/F,IAEE2pB,GAAiB,SAAC3kB,GAAD,aACpB,mBACEpI,EAAY0J,KAAO,WADrB,cAEE1J,EAAYqI,SAAW,WAFzB,cAGErI,EAAYsJ,SAAW,SAHzB,cAIEtJ,EAAYuJ,WAAa,SAJ3B,cAKEvJ,EAAYwJ,SAAW,SALzB,cAMExJ,EAAYyJ,MAAQ,QANtB,GAOCrB,IAUE4kB,GAAiB,SAAC7nB,GAA2B,IAAD,EAChD,OAAa,OAATA,EAAsB,QACnB,mBACJtF,EAASoF,MAAQ,YADb,cAEJpF,EAAS0E,OAAS,YAFd,cAGJ1E,EAASyE,MAAQ,YAHb,GAILa,IAGE8nB,GAAgB,SAACtpB,EAAkBwB,GAAnB,iBAChBxB,EADgB,oBACI+E,GAAoBvD,GADxB,MAGT+nB,GAAqB,SAAC,GAMM,IAGnC9pB,EACA+pB,EACAC,EAVJlmB,EAKsC,EALtCA,UACAJ,EAIsC,EAJtCA,MACAX,EAGsC,EAHtCA,cACAiB,EAEsC,EAFtCA,aACAC,EACsC,EADtCA,WAEMgmB,EAAsB,GACtBpL,EAAsB,GAKtBqL,EAAiB,SAACC,GACtBF,EAAU7mB,KAAK,sBAAI+mB,GAAJ,CAAW,MAAKC,KAAK,MAGtC,GAAmB,sBAAf1mB,EAAMU,KAA8B,CACtC,IAAMxD,EAAUE,GAAWT,EAAiByD,EAAUxD,QAASoD,EAAMnD,WACjEmD,EAAMa,QACR0lB,EAAU7mB,KAAV,WAAmBM,EAAMnD,SAAzB,oBAA6CqpB,GAAehpB,GAA5D,OAEAqpB,EAAU7mB,KAAV,WAAmBM,EAAMnD,SAAzB,gCAAyDqpB,GAAehpB,GAAxE,MACAmpB,EAAajmB,EAAUF,KAAO,GAEhCib,EAAUzb,KAAKM,EAAMnD,cAChB,CAAC,IACEpB,EAAyB2E,EAAzB3E,MAAOmB,EAAkBwD,EAAlBxD,QAASsD,EAASE,EAATF,KAChB8W,EAA0EhX,EAA1EgX,UAAW1V,EAA+DtB,EAA/DsB,YAAaH,EAAkDnB,EAAlDmB,iBAAkBO,EAAgC1B,EAAhC0B,WAAYD,EAAoBzB,EAApByB,gBAC9D0Z,EAAUzb,KAAKjE,GACf,IAAMkrB,EAAe3P,GAAS,UAAOgP,GAAiBhP,GAAxB,aAAuCA,EAAvC,KAE9B,OAAQhX,EAAMc,MACZ,KAAK7H,EAAoB+E,KACvBuoB,EAAU7mB,KAAV,WAAmBjE,EAAnB,aACA,MACF,KAAKxC,EAAoBiF,gBACvB,IAAMuoB,EAAQ,CAAC,IAAD,OAAKhrB,EAAL,mCACVkrB,IACFF,EAAM/mB,KAAN,uBAA2BinB,IAC3BrqB,EAAW0D,EAAMgX,WAEnBwP,EAAeC,GACfF,EAAU7mB,KACRymB,GACEhlB,EAAiB,GACjB/D,GAAWT,EAAiBC,EAASuE,EAAiB,OAG1Dga,EAAUzb,KAAKyB,EAAiB,IAChCklB,EAAanmB,EAAO,EACpB,MAEF,KAAKjH,EAAoBgI,cACvB,IAAMwlB,EAAQ,CAAC,IAAD,OAAKhrB,EAAL,6BACVkrB,IACFF,EAAM/mB,KAAN,cAAkBinB,IAClBrqB,EAAW0a,GAEbwP,EAAeC,GACfJ,EAAanmB,EAAO,EACpB,MAEF,KAAKjH,EAAoBmI,YACvBmlB,EAAU7mB,KAAV,WAAmBjE,EAAnB,aAA6BwqB,GAAe3kB,GAA5C,yBACAH,EAAiBE,SAAQ,SAAAxE,GACvB,IAAI+pB,EACJ,GAAI/pB,IAAapB,EACfmrB,EAAU7tB,EAASoF,UACd,CACL,IAAMlB,EAAYN,EAAiBC,EAASC,GAC5C+pB,EAAUtlB,IAAgBpI,EAAYqI,SAAWnE,GAAWH,GAAaA,EAEvEqE,IAAgBpI,EAAYqI,UAAY1E,IAAapB,IACvD8qB,EAAU7mB,KAAKymB,GAActpB,EAAU+pB,IACvCzL,EAAUzb,KAAK7C,OAGnBwpB,EAAanmB,EAAO,EACpB,MACF,KAAKjH,EAAoBuI,IACvB,IAAMilB,EAAQ,CAAC,IAAD,OAAKhrB,EAAL,aAAewqB,GAAe3kB,GAA9B,SACVA,IAAgBpI,EAAY0J,MAAQ+jB,IACtCF,EAAM/mB,KAAN,cAAkBinB,IAClBrqB,EAAW0a,GAEbwP,EAAeC,GACfJ,EAAanmB,EAAO,EACpB,MAEF,KAAKjH,EAAoB2E,QACzB,KAAK3E,EAAoB4E,OACzB,KAAK5E,EAAoB6E,OACzB,KAAK7E,EAAoB8E,OACvB,IAAM0oB,EAAkB,GAWxB,GAVIzmB,EAAMc,OAAS7H,EAAoB2E,SAA+B,IAApBhC,IAAEmF,KAAKnE,GACvD6pB,EAAM/mB,KAAN,WAAejE,EAAf,wBAEAgrB,EAAM/mB,KAAN,WAAejE,EAAf,aAtHS,SAACorB,GAAD,aAChB,mBACE5tB,EAAoB8E,OAAS,WAD/B,cAEE9E,EAAoB6E,OAAS,WAF/B,cAGE7E,EAAoB4E,OAAS,WAH/B,cAIE5E,EAAoB2E,QAAU,UAJhC,GAKCipB,GAgH+BC,CAAW9mB,EAAMc,QAExCQ,GACFmlB,EAAM/mB,KAAN,gBACWmD,GAAuBvB,GAA+BigB,gBAG/DvK,EAAW,CACb,IAAM+P,EACJ/mB,EAAMc,OAAS7H,EAAoB2E,QAC/BooB,GAAiBhP,GAAWhB,MAAM,GAAI,GACtC2Q,EACNF,EAAM/mB,KAAN,cAAkBqnB,IAClBzqB,EAAW0a,EAEbwP,EAAeC,GAIfpnB,EAActD,SAChBsD,EAAcgC,SAAQ,SAAAxE,GAChBA,IAAapB,IACf8qB,EAAU7mB,KAAV,WAAmB7C,EAAnB,cACAse,EAAUzb,KAAK7C,OAGnBypB,EAAW/lB,GAEbvB,GAAcsB,GAAc,SAACzD,EAAUwB,GACjCzB,EAAQyB,KAAUxB,GAAYA,IAAapB,IAC7C8qB,EAAU7mB,KAAV,WAAmB7C,EAAnB,gBAAmC+E,GAAoBvD,GAAvD,MACA8c,EAAUzb,KAAK7C,OAGnBjB,IAAEyF,QAAQI,GAAiB,SAACpD,EAAMxB,GAAc,IAAD,EAC7C0pB,EAAU7mB,KAAV,WAAmB7C,EAAnB,2BAA8C+E,GAAoBvD,GAAlE,MACA8c,EAAUzb,KAAK7C,GACfwpB,GAAa,UAACA,SAAD,QAAenmB,GAAQ,KAElCzE,KAASiG,GACX6kB,EAAU7mB,KAAV,WAAmBjE,EAAnB,gBAAgCmG,GAAoBF,EAAWjG,IAA/D,mBAIJ,MAAO,CACLkqB,YAAaY,EAAUG,KAAK,KAC5BvL,YACA7e,WACA+pB,aACAC,aCrMEU,GAAkC,SAAC3sB,EAAiB0rB,GAAyC,IAAD,EAC7BK,GAAmBL,GAA9EJ,EADwF,EACxFA,YAAaxK,EAD2E,EAC3EA,UAAW7e,EADgE,EAChEA,SAAU+pB,EADsD,EACtDA,WAAYC,EAD0C,EAC1CA,SAClDW,EAA0BtB,EAc9B,OAbIrpB,IACF2qB,EAA0BtB,EAAYuB,QACpC,IAAIC,OAAJ,WAAe7qB,EAAf,MACA9B,EAAmBH,ErC4CU,SAACA,EAAiB+B,EAAgBE,GAAlC,OACjCV,IAAEkB,QAAQzC,EAAMuL,KAAKC,QAAQxK,MAAMe,GAAM6H,WAAW,SAAAmjB,GAAC,OAAIA,IAAM9qB,KqC7CjC+qB,CAAoBhtB,EAAO,EAAI0rB,EAAK3lB,UAAUrF,WAAYuB,MAGxF6e,EAAU9Z,SAAQ,SAAA/G,GAChB2sB,EAA0BA,EAAwBC,QAChD,IAAIC,OAAJ,WAAe7sB,EAAf,KAA4B,KAC5BE,EAAmBH,EAAOC,OAIvB,CACLqrB,YAAasB,EACb/mB,KAAMmmB,EACNvmB,MAAOwmB,EACPxlB,KAA0B,oBAApBilB,EAAK/lB,MAAMU,KAA6BqlB,EAAK/lB,MAAMc,UAAOgI,IAIvDwe,GAAc3sB,YACzB2O,IACA,SAAAjP,GAAK,OAAIA,KACT,SAACgZ,EAAShZ,GAgBR,OAf6BgZ,EAAQyN,QAAO,SAACyG,EAAcxB,GAAU,IAAD,EACnCA,EAAK3lB,UAA5BH,EAD0D,EAC1DA,OAAQlF,EADkD,EAClDA,WAChB,GAAKwsB,EAAaxrB,OAEX,CACL,IAAMyrB,EAAY5rB,IAAEmD,KAAKwoB,GACrBC,EAAUvnB,SAAWA,GAAUunB,EAAUzsB,aAAeA,EAC1DwsB,EAAa7nB,KAAK,CAAEO,SAAQlF,aAAY2oB,MAAO,CAACqC,KAEhDyB,EAAU9D,MAAMhkB,KAAKqmB,QANvBwB,EAAa7nB,KAAK,CAAEO,SAAQlF,aAAY2oB,MAAO,CAACqC,KASlD,OAAOwB,IACN,IAEyB9jB,KAAI,kBAAoC,CAClExD,OAD8B,EAAGA,OAEjClF,WAF8B,EAAWA,WAGzC2oB,MAH8B,EAAuBA,MAGxCjgB,KAAI,SAAAsiB,GAAI,OAAIiB,GAAgC3sB,EAAO0rB,aAKzD0B,GAAkB9sB,YAAe2sB,IAAa,SAAAI,GAAM,OAC/DA,EACGjkB,KAAI,kBAAoC,CACvCxD,OADG,EAAGA,OAENlF,WAFG,EAAWA,WAGd2oB,MAHG,EAAuBA,MAGbrnB,QAAO,SAAA0pB,GAAI,QAAMA,EAAKjmB,aAEpCzD,QAAO,SAAAsrB,GAAK,OAAIA,EAAMjE,MAAM3nB,aCalB6rB,IDVYjtB,YACzB2O,IACA,SAAAjP,GAAK,OAAIA,KACT,SAACgZ,EAAShZ,GACR,IAAMwtB,EAAWjsB,IAAEmD,KAAKsU,GACxB,OAAOwU,GAAYb,GAAgC3sB,EAAOwtB,MAInCltB,YACzBoP,IACA,SAAA1P,GAAK,OAAIA,KACT,SAAC2P,EAAQ3P,GAAW,IAAD,EACXytB,EAAWlsB,IAAEmD,KAAF,UAAOnD,IAAEqW,MAAMjI,UAAf,aAAO,EAAiBrI,aACzC,OAAOmmB,GAAYd,GAAgC3sB,EAAOytB,MC3EhD,WACZ,IAAMC,EAAczd,GAAejD,IAC7B2gB,EAAe1d,GAAemd,IAC9BQ,EAAW3d,GAAegd,IAC1BY,EAAgB5d,GAAerE,IAJnB,EAM0BgK,mBAASiY,GANnC,mBAMXC,EANW,KAMKC,EANL,KAQZC,EAAoB3O,mBACxB,kBAAMuO,EAAS5rB,QAAO,qBAAG4D,SAAwBkoB,OACjD,CAACF,EAAUE,IAGPG,EAAejZ,uBACnB,SAACpP,GAAD,OAAoB,WAClBmoB,EAAkBnoB,MAEpB,CAACmoB,IAGH,OAAKL,EAKH,eAACnd,EAAA,EAAD,CAAK0E,IAAI,SAASiJ,KAAM,CAAEgK,OAAQ,GAAKC,MAAM,OAAO1X,IAAI,QAAxD,UACE,eAACF,EAAA,EAAD,CAAKC,UAAU,MAAMqK,QAAQ,UAA7B,UACE,cAACtE,GAAA,EAAD,CAASC,MAAO,EAAGC,OAAO,OAA1B,qBAGA,cAACF,GAAA,EAAD,CAASC,MAAO,EAAGE,UAAU,MAAMD,OAAO,OAA1C,0BAIF,eAAClG,EAAA,EAAD,CAAKC,UAAU,MAAMC,IAAI,QAAzB,UACE,cAACF,EAAA,EAAD,CAAKE,IAAI,QAAQ0X,MAAM,IAAIjK,MAAI,EAA/B,SACGyP,EAAavkB,KAAI,SAAAkkB,GAAK,OACrB,cAAC,GAAD,eAAiEA,GAAjE,UAAyBA,EAAM1nB,OAA/B,YAAyC0nB,EAAM5sB,kBAGnD,eAAC6P,EAAA,EAAD,CAAKE,IAAI,QAAQ0X,MAAM,IAAIjK,MAAI,EAACzH,OAAQ,CAAEsD,KAAM,SAAhD,WACIiU,EAAkBtsB,QAAU,cAACiP,EAAA,EAAD,CAAM+F,UAAU,SAAhB,uCAC7BsX,EAAkB5kB,KAAI,SAAAkkB,GAAK,OAC1B,cAAC,GAAD,eAAiEA,GAAjE,UAAyBA,EAAM1nB,OAA/B,YAAyC0nB,EAAM5sB,mBAGnD,cAACwlB,GAAA,EAAaC,OAAd,CAAqBjQ,MAAO,CAAEkQ,OAAQ,CAAE1f,KAAM,CAAEwnB,QAAS,UAAzD,SACE,cAAC3d,EAAA,EAAD,CAAKE,IAAI,SAASyN,MAAM,EAAxB,SACG3c,IAAE6M,MAAM,EAAGyf,EAAgB,GAAGzkB,KAAI,SAAAxD,GAAM,OACvC,cAAC2K,EAAA,EAAD,CAEEuK,MAAO,CAAEpU,KAAM,OACf2W,OAAQ,CAAE3W,KAAM,SAChBwO,MAAM,UACNmD,OAAO,UACPwC,QAAQ,SACRnK,MAAM,SACNyN,iBAAkBvY,IAAWkoB,GAC7BnU,WAAY/T,IAAWkoB,EAAiB,aAAUrf,EAClD4G,QAAS4Y,EAAaroB,GAVxB,SAYE,cAAC+K,EAAA,EAAD,UAAO/K,KAXFA,gBA7BV,cAAC,IAAD,CAAUxG,GAAG,aCJT+uB,GA1BU,CACvB/H,OAAQ,CACNgI,OAAQ,CACNC,MAAO,UACP,WAAY,UACZ,wBAAyB,WAE3BC,MAAO,CACLC,QAAS,CACPjvB,MAAO,iBAIbkvB,WAAY,CACVC,MAAO,CACLpW,OAAQ,MACRqW,OAAQ,CACNC,aAAc,SAIpBC,UAAW,CACTvR,YAAQ5O,I,UClBN2Z,GAA4B,CAChCC,OAAQ,EACRC,KAAM,EACNC,QAAS,EACTC,QAAS,EACTC,SAAU,EACVC,MAAO,EACPC,YAAa,EACbC,eAAgB,EAChBC,aAAc,EACdC,WAAY,EACZC,WAAY,EACZC,eAAgB,EAChBC,sBAAuB,EACvBC,WAAY,G,GASelX,aAAY,CACvCV,KAAM,UACNC,aAAc,GACdU,SAAU,CACR4c,UAAW,CACTra,QADS,SACDxU,EADC,GACoD,IAX1C8uB,EAAsB5uB,EAWxBiS,EAA2C,EAA3CA,QAXE2c,EAYI3c,EAZkBjS,EAYTF,EAXpCuB,IAAEqQ,KACA1R,GACA,SAAAE,GAAM,OAAIA,EAAOP,YAAcivB,EAAUjvB,WAAaO,EAAON,WAAagvB,EAAUhvB,cAU9EE,EAAMmS,EAAQlS,UAAd,2BAA+BkS,GAA/B,IAAwC4c,MAAO,EAAGxF,MAAOnB,OAG7D4G,QAAS,SAAC5uB,GAAD,MAAwB,CAAE+R,QAAQ,2BAAM/R,GAAP,IAAeH,SAAUgvB,uBAVjE1a,G,GAAAA,QAASC,G,GAAAA,QAeFqa,GAActa,GAAdsa,UACAra,MC7CFtU,GAAU,CACrB,YACA,cACA,gBACA,gBACA,kBACA,iBACA,gBACA,aACA,eACA,cACA,cACA,cACA,gBACA,gBACA,iBACA,cACA,WACA,gBACA,cC0DagvB,GA/DE,WACf,IAAMpa,EAAW/E,KAEXof,EAAalf,GAAenD,IAHb,EAIUmD,GAAevE,IAJzB,mBAId2D,EAJc,KAIHC,EAJG,KAKfH,EAAac,GAAef,IAC5BkgB,EAAgBnf,GAAeT,IAE/B6f,EAAoBra,uBAAY,WACpCF,EAASR,GAAYH,gBACpB,CAACW,IAEEwa,EAAmBta,uBAAY,WACnCF,EAASR,GAAYF,eACpB,CAACU,IAEEya,EAAuBva,uBAAY,WACvCF,EAASR,GAAYD,mBACpB,CAACS,IAEJ,OAAIqa,IAAerwB,EAAWmO,YACrB,cAAC,IAAD,CAAU7N,GAAG,WAElB+vB,IAAerwB,EAAW0S,YACrB,cAAC,IAAD,CAAUpS,GAAG,WAIpB,eAACowB,EAAA,EAAD,CAAMtR,MAAI,EAACvE,WAAW,QAAQkB,QAAQ,SAASnK,MAAM,SAArD,UACE,eAACH,EAAA,EAAD,CAAKG,MAAM,SAAX,UACE,eAAC6F,GAAA,EAAD,CAASC,MAAO,EAAGC,OAAQ,CAAEgJ,OAAQ,SAArC,UACGpQ,EAAYC,EAAY,OAAS,OADpC,iBAGA,eAACiH,GAAA,EAAD,CAASE,OAAQ,CAAEgJ,OAAQ,SAA3B,UACGpQ,EADH,MACiBC,QAGnB,eAACiB,EAAA,EAAD,CAAKE,IAAI,QAAT,UACGtB,EAAaigB,GACZ,cAACha,EAAA,EAAD,CACE9V,MAAM,UACNwa,OAAO,EACPzQ,MAAM,sBACNgM,QAASga,IAGb,cAACja,EAAA,EAAD,CACE9V,MAAM,YACNwa,OAAO,EACPzQ,MAAM,wBACNgM,QAASia,IAEX,cAACla,EAAA,EAAD,CACE9V,MAAM,YACNwa,OAAO,EACPzQ,MAAM,yBACNgM,QAASka,WCDJE,GApDH,WACV,I1CZuBC,E0CYjB5a,EAAW/E,KAET4f,EAAaC,cAAbD,SACF3W,EAAUC,cAEV4W,EAAW5f,GAAe/C,IAehC,O1ChCuBwiB,E0CmBd,WACPxvB,GAAQ8G,SAAQ,SAAA5G,GAAW,IAAD,EACMA,EAAO0vB,MAAM,KADnB,mBACjBjwB,EADiB,KACNC,EADM,KAExBgV,EAAS+Z,GAAU,CAAEhvB,YAAWC,kB1CtBcof,oBAAUwQ,EAAQ,I0C0BpExQ,qBAAU,WACJ2Q,GAAyB,eAAbF,GACd3W,EAAQ6T,QAAQ,gBAEjB,CAAC8C,EAAUE,EAAU7W,IAGtB,cAAC+W,EAAA,EAAD,CAASC,MAAI,EAAC7B,MAAOA,GAArB,SACE,eAAC5d,EAAA,EAAD,CAAK8H,OAAO,OAAZ,WACIwX,GAAY,cAAC,GAAD,IACd,cAACL,EAAA,EAAD,CAAMtR,MAAI,EAACL,SAAU,CAAExH,SAAU,QAAjC,SACE,eAAC,IAAD,WACE,cAAC,IAAD,CAAOlX,KAAK,aAAZ,SACE,cAAC,GAAD,MAEF,cAAC,IAAD,CAAOA,KAAK,SAAZ,SACE,cAAC,GAAD,MAEF,cAAC,IAAD,CAAOA,KAAK,SAAZ,SACE,cAAC,GAAD,MAEF,cAAC,IAAD,CAAOA,KAAK,aAAZ,SACE,cAAC,GAAD,MAEF,cAAC,IAAD,CAAOA,KAAK,SAAZ,SACE,cAAC,GAAD,MAEF,cAAC,IAAD,CAAOA,KAAK,IAAZ,SACE,cAAC,IAAD,CAAUC,GAAG,wB,6BCpDrBoV,GAAUyb,aACd,CAAEnN,IAAK,OAAQoN,cACf,CACE3kB,QACArL,WACAgc,aAISiU,GAAQC,aAAe,CAClC5b,WACA6b,WAAYC,aAAqB,CAAEC,mBAAmB,EAAOC,gBAAgB,MAElEC,GAAYC,aAAaP,ICPvBQ,GAZS,SAACC,GACnBA,GAAeA,aAAuBC,UACxC,8BAAqBC,MAAK,YAAkD,IAA/CC,EAA8C,EAA9CA,OAAQC,EAAsC,EAAtCA,OAAQC,EAA8B,EAA9BA,OAAQC,EAAsB,EAAtBA,OAAQC,EAAc,EAAdA,QAC3DJ,EAAOH,GACPI,EAAOJ,GACPK,EAAOL,GACPM,EAAON,GACPO,EAAQP,OCGRQ,GAAcC,QACW,cAA7BC,OAAOC,SAASC,UAEe,UAA7BF,OAAOC,SAASC,UAEhBF,OAAOC,SAASC,SAASvyB,MAAM,2DA0CnC,SAASwyB,GAAgBC,EAAeC,GACtCC,UAAUC,cACPC,SAASJ,GACTZ,MAAK,SAACiB,GACLA,EAAaC,cAAgB,WAC3B,IAAMC,EAAmBF,EAAaG,WACd,MAApBD,IAGJA,EAAiBE,cAAgB,WACA,cAA3BF,EAAiBjyB,QACf4xB,UAAUC,cAAcO,YAI1BC,QAAQC,IACN,+GAKEX,GAAUA,EAAOY,UACnBZ,EAAOY,SAASR,KAMlBM,QAAQC,IAAI,sCAGRX,GAAUA,EAAOa,WACnBb,EAAOa,UAAUT,WAO5BU,OAAM,SAACC,GACNL,QAAQK,MAAM,4CAA6CA,M,OCrFjEC,IAAShI,OACP,cAAC,IAAD,CAAUwF,MAAOA,GAAjB,SACE,cAAC,IAAD,CAAayC,QAAS,KAAMnC,UAAWA,GAAvC,SACE,cAAC,IAAD,UACE,cAAC,IAAMoC,WAAP,UACE,cAAC,GAAD,YAKRC,SAASC,eAAe,SDCnB,SAAkBpB,GACvB,GAA6C,kBAAmBC,UAAW,CAGzE,GADkB,IAAIoB,IAAIC,GAAwB3B,OAAOC,SAAS2B,MACpDC,SAAW7B,OAAOC,SAAS4B,OAIvC,OAGF7B,OAAO8B,iBAAiB,QAAQ,WAC9B,IAAM1B,EAAK,UAAMuB,GAAN,sBAEP7B,KAgEV,SAAiCM,EAAeC,GAE9C0B,MAAM3B,EAAO,CACX4B,QAAS,CAAE,iBAAkB,YAE5BxC,MAAK,SAACyC,GAEL,IAAMC,EAAcD,EAASD,QAAQG,IAAI,gBAEnB,MAApBF,EAASxmB,QACO,MAAfymB,IAA8D,IAAvCA,EAAYjQ,QAAQ,cAG5CqO,UAAUC,cAAc6B,MAAM5C,MAAK,SAACiB,GAClCA,EAAa4B,aAAa7C,MAAK,WAC7BQ,OAAOC,SAASqC,eAKpBnC,GAAgBC,EAAOC,MAG1Bc,OAAM,WACLJ,QAAQC,IAAI,oEAtFVuB,CAAwBnC,EAAOC,GAI/BC,UAAUC,cAAc6B,MAAM5C,MAAK,WACjCuB,QAAQC,IACN,+GAMJb,GAAgBC,EAAOC,OCvB/BmC,GAKAnD,O","file":"static/js/main.0643b62e.chunk.js","sourcesContent":["export enum HalfInning {\n  TOP,\n  BOTTOM,\n}\nexport enum TeamRole {\n  AWAY,\n  HOME,\n}\nexport enum BaseType {\n  FIRST = 'FIRST',\n  SECOND = 'SECOND',\n  THIRD = 'THIRD',\n}\nexport enum FieldingPosition {\n  PITCHER = 'PITCHER',\n  CATCHER = 'CATCHER',\n  FIRST_BASE = 'FIRST_BASE',\n  SECOND_BASE = 'SECOND_BASE',\n  THIRD_BASE = 'THIRD_BASE',\n  SHORTSTOP = 'SHORTSTOP',\n  LEFT_FIELD = 'LEFT_FIELD',\n  CENTER_FIELD = 'CENTER_FIELD',\n  LEFT_CENTER = 'LEFT_CENTER',\n  RIGHT_CENTER = 'RIGHT_CENTER',\n  RIGHT_FIELD = 'RIGHT_FIELD',\n}\nexport enum PlateAppearanceType {\n  OUT = 'OUT',\n  WALK = 'WALK',\n  SINGLE = 'SINGLE',\n  DOUBLE = 'DOUBLE',\n  TRIPLE = 'TRIPLE',\n  HOMERUN = 'HOMERUN',\n  SACRIFICE_FLY = 'SACRIFICE_FLY',\n  FIELDERS_CHOICE = 'FIELDERS_CHOICE',\n  DOUBLE_PLAY = 'DOUBLE_PLAY',\n}\nexport enum ContactType {\n  NONE = 'NONE',\n  GROUNDER = 'GROUNDER',\n  LINE_DRIVE = 'LINE_DRIVE',\n  POPUP = 'POPUP',\n  LAZY_FLY = 'LAZY_FLY',\n  LONG_FLY = 'LONG_FLY',\n}\nexport type HitType = Exclude<\n  PlateAppearanceType,\n  | PlateAppearanceType.DOUBLE_PLAY\n  | PlateAppearanceType.FIELDERS_CHOICE\n  | PlateAppearanceType.OUT\n  | PlateAppearanceType.SACRIFICE_FLY\n  | PlateAppearanceType.WALK\n>;\nexport type HitContactType = Exclude<ContactType, ContactType.NONE>;\n\nexport interface Team {\n  name: string;\n  lineup: string[];\n  positions: {\n    [playerId: string]: FieldingPosition;\n  };\n}\n\nexport type BaseRunners = Partial<Record<BaseType, string>>;\n\nexport interface PlateAppearanceResult {\n  kind: 'plateAppearance';\n  type: PlateAppearanceType;\n  contactType?: ContactType;\n  fieldedBy?: FieldingPosition;\n  runnersOutOnPlay: string[];\n  basesTaken: {\n    [runnerId: string]: BaseType | null;\n  };\n  outsOnBasepaths: {\n    [runnerId: string]: BaseType | null;\n  };\n  runsScoredOnSacFly?: number;\n}\n\nexport interface StolenBaseAttempt {\n  kind: 'stolenBaseAttempt';\n  runnerId: string;\n  success: boolean;\n}\n\nexport type GameEvent = PlateAppearanceResult | StolenBaseAttempt;\n\nexport enum GameStatus {\n  NOT_STARTED = 'NOT_STARTED',\n  IN_PROGRESS = 'IN_PROGRESS',\n  FINISHED = 'FINISHED',\n}\n\nexport interface GameState {\n  status: GameStatus;\n  teams: [Team, Team];\n  inning: number;\n  halfInning: HalfInning;\n  atBat?: string;\n  upNextHalfInning?: string;\n  runners: BaseRunners;\n  outs: number;\n  gameHistory: RecordedPlay[];\n  score: [number, number];\n  gameLength: number;\n}\n\nexport interface RecordedPlay {\n  gameState: Required<\n    Pick<GameState, 'atBat' | 'inning' | 'halfInning' | 'runners' | 'outs' | 'score'>\n  >;\n  event: GameEvent;\n  runnersScored: string[];\n  runnersBattedIn: string[];\n  runnersAfter: BaseRunners;\n  scoreAfter: [number, number];\n}\n\nexport interface AddPlayerPayload {\n  playerId: string;\n  team: TeamRole;\n}\n\nexport interface MovePlayerPayload {\n  startIndex: number;\n  endIndex: number;\n  fromTeam: TeamRole;\n  toTeam: TeamRole;\n}\nexport interface ChangePlayerPositionPayload {\n  playerId: string;\n  position: FieldingPosition;\n}\n","import React from 'react';\nimport { Anchor, AnchorProps } from 'grommet';\nimport { Link, LinkProps, useRouteMatch } from 'react-router-dom';\n\nexport type AnchorLinkProps = LinkProps & AnchorProps & Omit<JSX.IntrinsicElements['a'], 'color'>;\n\nconst AnchorLink: React.FC<AnchorLinkProps> = props => {\n  const match = useRouteMatch({ path: props.to as string });\n  return (\n    <Anchor\n      color={!!match ? 'accent-4' : 'accent-3'}\n      as={({ colorProp, hasIcon, hasLabel, ...rest }) => <Link {...rest} />}\n      {...props}\n    />\n  );\n};\nexport default AnchorLink;\n","import { Player } from './types';\n\nexport const formatShortName = ({ firstName, lastName }: Player) => `${firstName} ${lastName[0]}`;\n","import { createSelector } from '@reduxjs/toolkit';\n\nimport { formatShortName } from './utils';\n\nimport { AppState } from 'state/store';\nimport { Player } from './types';\n\nconst getPlayer = (state: AppState, playerId: string): Player | undefined =>\n  state.players[playerId];\n\nexport const getPlayerName = (state: AppState, playerId: string) => {\n  const player = getPlayer(state, playerId);\n  return player ? `${player.firstName} ${player.lastName}` : '';\n};\n\nexport const getShortPlayerName = (state: AppState, playerId: string) => {\n  const player = getPlayer(state, playerId);\n  return player ? formatShortName(player) : '';\n};\n\nexport const getAllPlayers = (state: AppState) => state.players;\nexport const getAllPlayersList = createSelector(getAllPlayers, players => Object.values(players));\n\nexport const getPlayerOptionsForSelector = (state: AppState, playerIds: string[]) =>\n  playerIds.map(id => ({ label: getShortPlayerName(state, id), value: id }));\n","import { createSelector } from '@reduxjs/toolkit';\nimport _ from 'lodash';\n\nimport { GameState, HalfInning, TeamRole } from './types';\nimport { getBaseForRunner } from './utils';\n\nexport const getTeams = (state: GameState) => state.teams;\nexport const getRunners = (state: GameState) => state.runners;\nexport const getCurrentBatter = (state: GameState) => state.atBat;\n\nexport const getCurrentBaseForRunner = (state: GameState, playerId: string) =>\n  getBaseForRunner(getRunners(state), playerId);\n\nexport const getHalfInning = (state: GameState) => state.halfInning;\n\nexport const getBattingTeam = createSelector(getHalfInning, half =>\n  half === HalfInning.BOTTOM ? TeamRole.HOME : TeamRole.AWAY\n);\nexport const getBattingLineup = createSelector(\n  getTeams,\n  getBattingTeam,\n  (teams, battingTeam) => teams[battingTeam].lineup\n);\n\nexport const getOnDeckBatter = createSelector(\n  getCurrentBatter,\n  getBattingLineup,\n  (batterId, lineup) => {\n    const lineupIndex = _.findIndex(lineup, id => id === batterId);\n    if (lineupIndex === lineup.length - 1) {\n      return lineup[0];\n    }\n    return lineup[lineupIndex + 1];\n  }\n);\n","import _ from 'lodash';\n\nimport { getBattingTeam, getCurrentBaseForRunner } from './partialSelectors';\n\nimport {\n  BaseType,\n  PlateAppearanceType,\n  BaseRunners,\n  FieldingPosition,\n  Team,\n  GameEvent,\n  GameState,\n  RecordedPlay,\n  ContactType,\n} from './types';\n\nexport const allPositions = _.keys(FieldingPosition) as FieldingPosition[];\n\nexport const shouldTeamUseFourOutfielders = ({ lineup }: Team) => lineup.length > 9;\nexport const getAvailablePositionsForTeam = (team: Team) => {\n  if (shouldTeamUseFourOutfielders(team)) {\n    return allPositions.filter(position => position !== FieldingPosition.CENTER_FIELD);\n  }\n  return allPositions.filter(\n    position => ![FieldingPosition.RIGHT_CENTER, FieldingPosition.LEFT_CENTER].includes(position)\n  );\n};\n\nexport const getBaseForRunner = (runners: BaseRunners, runnerId: string) =>\n  _.findKey(runners, runner => runner === runnerId) as BaseType;\n\nexport const moveRunner = (runners: BaseRunners, startBase: BaseType, endBase: BaseType | null) => {\n  if (endBase) {\n    runners[endBase] = runners[startBase];\n    delete runners[startBase];\n    return false;\n  } else {\n    delete runners[startBase];\n    return true;\n  }\n};\n\nexport const removeRunner = (runners: BaseRunners, runnerId: string) => {\n  delete runners[getBaseForRunner(runners, runnerId)];\n};\n\n// Find the base a runner should occupy if advanced by some number of bases.\n// Return null if the runner has scored.\nexport const getNewBase = (currentBase: BaseType, numAdvanced: number = 1) => {\n  if (numAdvanced === -1) return getPreviousBase(currentBase)!;\n  if (numAdvanced === 0) return currentBase;\n  if (currentBase === BaseType.THIRD) return null;\n  if (currentBase === BaseType.SECOND) {\n    if (numAdvanced > 1) return null;\n    return BaseType.THIRD;\n  }\n  if (numAdvanced > 2) return null;\n  if (numAdvanced === 2) return BaseType.THIRD;\n  return BaseType.SECOND;\n};\n\nexport const getNumBasesForPlateAppearance = (paType: PlateAppearanceType) => {\n  switch (paType) {\n    case PlateAppearanceType.HOMERUN:\n      return 4;\n    case PlateAppearanceType.TRIPLE:\n      return 3;\n    case PlateAppearanceType.DOUBLE:\n      return 2;\n    case PlateAppearanceType.SINGLE:\n    case PlateAppearanceType.WALK:\n      return 1;\n    default:\n      return 0;\n  }\n};\n\nexport const getEndBaseForBatterRunner = (paType: PlateAppearanceType) => {\n  switch (paType) {\n    case PlateAppearanceType.TRIPLE:\n      return BaseType.THIRD;\n    case PlateAppearanceType.DOUBLE:\n      return BaseType.SECOND;\n    case PlateAppearanceType.SINGLE:\n    case PlateAppearanceType.WALK:\n    case PlateAppearanceType.FIELDERS_CHOICE:\n      return BaseType.FIRST;\n    default:\n      return null;\n  }\n};\n\nexport const getBaseNumber = (base: BaseType | null) =>\n  base === null\n    ? 4\n    : {\n        [BaseType.FIRST]: 1,\n        [BaseType.SECOND]: 2,\n        [BaseType.THIRD]: 3,\n      }[base];\nexport const getPreviousBase = (base: BaseType | null) => {\n  switch (base) {\n    case null:\n      return BaseType.THIRD;\n    case BaseType.THIRD:\n      return BaseType.SECOND;\n    case BaseType.SECOND:\n      return BaseType.FIRST;\n    case BaseType.FIRST:\n      return;\n  }\n};\n\nexport const mustRunnerAdvance = (\n  base: BaseType,\n  runners: BaseRunners,\n  batterEndBase = BaseType.FIRST\n): boolean => {\n  const prevBase = getPreviousBase(base);\n\n  if (getBaseNumber(base) - getBaseNumber(batterEndBase) <= 0) return true;\n  if (!prevBase) return true;\n  if (!runners[prevBase]) return false;\n\n  return mustRunnerAdvance(prevBase, runners, batterEndBase);\n};\n\nexport const getSortedRunners = (runners: BaseRunners) =>\n  (_.toPairs(runners) as [BaseType, string][]).sort(\n    ([baseA], [baseB]) => getBaseNumber(baseA) - getBaseNumber(baseB)\n  );\n\nexport const getLeadRunner = (runners: BaseRunners) => _.last(getSortedRunners(runners));\n\nexport const forEachRunner = (\n  runners: BaseRunners,\n  callback: (runnerId: string, base: BaseType) => void | boolean\n) => {\n  const sortedPairs = getSortedRunners(runners);\n  _.forEachRight(sortedPairs, ([base, runnerId]) => callback(runnerId, base));\n};\n\nexport const getDefaultRunnersAfterPlateAppearance = (\n  runners: BaseRunners,\n  paType: PlateAppearanceType,\n  batterId: string\n): [BaseRunners, string[]] => {\n  let runnersScored: string[] = [];\n  const newRunners = { ...runners };\n  const numBasesAdvanced = getNumBasesForPlateAppearance(paType);\n\n  _.times(numBasesAdvanced, i => {\n    forEachRunner(newRunners, (runnerId, base) => {\n      if (mustRunnerAdvance(base, newRunners, getEndBaseForBatterRunner(paType)!)) {\n        if (moveRunner(newRunners, base, getNewBase(base))) {\n          runnersScored.push(runnerId);\n        }\n      }\n    });\n    if (i === 0 && getEndBaseForBatterRunner(paType)) {\n      newRunners[BaseType.FIRST] = batterId;\n    }\n  });\n\n  return [newRunners, runnersScored];\n};\n\nexport const moveRunnersOnGroundBall = (runners: BaseRunners) => {\n  let runnersScored: string[] = [];\n  forEachRunner(runners, (runnerId, base) => {\n    if (mustRunnerAdvance(base, runners)) {\n      if (moveRunner(runners, base, getNewBase(base))) {\n        runnersScored.push(runnerId);\n      }\n    }\n  });\n  return runnersScored;\n};\n\nexport const mustAllRunnersAdvance = (runners: BaseRunners) =>\n  _.every(runners, (_runnerId, base) => mustRunnerAdvance(base as BaseType, runners));\n\nconst updateScore = (state: GameState, runs: number = 1) => {\n  state.score[getBattingTeam(state)] += runs;\n};\n\nexport const applyGameEvent = (state: GameState, event: GameEvent) => {\n  const { atBat, inning, halfInning, outs, runners, score } = state;\n  const recordedPlay: RecordedPlay = {\n    event: event,\n    gameState: {\n      atBat: atBat!,\n      inning,\n      halfInning,\n      outs,\n      runners: { ...runners },\n      score: [...score],\n    },\n    runnersBattedIn: [],\n    runnersScored: [],\n    runnersAfter: runners,\n    scoreAfter: score,\n  };\n\n  const recordRunnersScored = (runners: string[], battedIn = true) => {\n    if (battedIn) {\n      recordedPlay.runnersBattedIn.push(...runners);\n    }\n    recordedPlay.runnersScored.push(...runners);\n  };\n\n  if (event.kind === 'stolenBaseAttempt') {\n    const startBase = getCurrentBaseForRunner(state, event.runnerId);\n    if (event.success) {\n      const endBase = getNewBase(startBase);\n      delete state.runners[startBase];\n      if (endBase) {\n        state.runners[endBase] = event.runnerId;\n      } else {\n        // runner scored\n        updateScore(state);\n        recordRunnersScored([event.runnerId], false);\n      }\n    } else {\n      delete state.runners[startBase];\n      state.outs++;\n    }\n  } else if (event.kind === 'plateAppearance') {\n    switch (event.type) {\n      case PlateAppearanceType.HOMERUN:\n        updateScore(state, _.size(state.runners) + 1);\n        recordRunnersScored([...(_.values(state.runners) as string[]), atBat!]);\n        state.runners = {};\n        break;\n      case PlateAppearanceType.TRIPLE:\n        updateScore(state, _.size(state.runners));\n        recordRunnersScored(_.values(state.runners) as string[]);\n        state.runners = { [BaseType.THIRD]: atBat };\n        break;\n      case PlateAppearanceType.DOUBLE:\n      case PlateAppearanceType.SINGLE:\n      case PlateAppearanceType.WALK:\n        const [newBaseRunners, runnersScored] = getDefaultRunnersAfterPlateAppearance(\n          state.runners,\n          event.type,\n          atBat!\n        );\n        state.runners = newBaseRunners;\n        updateScore(state, runnersScored.length);\n        recordRunnersScored(runnersScored);\n        break;\n      case PlateAppearanceType.SACRIFICE_FLY:\n        _.times(event.runsScoredOnSacFly!, () => {\n          const [base, runnerId] = getLeadRunner(runners)!;\n          moveRunner(runners, base, null);\n          updateScore(state);\n          recordRunnersScored([runnerId]);\n        });\n        state.outs++;\n        break;\n      case PlateAppearanceType.FIELDERS_CHOICE: {\n        removeRunner(state.runners, event.runnersOutOnPlay[0]);\n        const runnersScored = moveRunnersOnGroundBall(state.runners);\n        state.runners[BaseType.FIRST] = atBat;\n        if (runnersScored.length && outs < 2) {\n          updateScore(state);\n          recordRunnersScored(runnersScored);\n        }\n        state.outs++;\n        break;\n      }\n      case PlateAppearanceType.DOUBLE_PLAY:\n        state.outs += 2;\n        event.runnersOutOnPlay.forEach(runnerId => {\n          removeRunner(state.runners, runnerId);\n        });\n        if (event.contactType === ContactType.GROUNDER) {\n          const runnersScored = moveRunnersOnGroundBall(state.runners);\n          if (runnersScored.length && outs === 0) {\n            updateScore(state, runnersScored.length);\n            recordRunnersScored(runnersScored, false);\n          }\n\n          if (!event.runnersOutOnPlay.includes(atBat!)) {\n            state.runners[BaseType.FIRST] = atBat;\n          }\n        }\n        break;\n      case PlateAppearanceType.OUT:\n        if (event.contactType === ContactType.GROUNDER) {\n          const runnersScored = moveRunnersOnGroundBall(state.runners);\n          if (runnersScored.length && outs < 2) {\n            updateScore(state, runnersScored.length);\n            recordRunnersScored(runnersScored);\n          }\n        }\n        state.outs++;\n        break;\n    }\n\n    forEachRunner(state.runners, (runnerId, base) => {\n      if (runnerId in event.outsOnBasepaths) {\n        delete state.runners[base];\n        state.outs++;\n      } else if (runnerId in event.basesTaken) {\n        if (moveRunner(state.runners, base, event.basesTaken[runnerId])) {\n          updateScore(state);\n          recordRunnersScored([runnerId], event.type !== PlateAppearanceType.DOUBLE_PLAY);\n        }\n      }\n    });\n\n    recordedPlay.runnersAfter = state.runners;\n    recordedPlay.scoreAfter = state.score;\n    state.gameHistory.push(recordedPlay);\n  }\n};\n","import {\n  PlateAppearanceType,\n  FieldingPosition,\n  ContactType,\n  HitContactType,\n  BaseType,\n} from 'state/game/types';\nimport { BasepathOutcome } from 'state/prompts/types';\n\nexport const formatShortBaseName = (base: BaseType | null) => {\n  if (base === null) return 'home';\n  return {\n    [BaseType.FIRST]: '1st',\n    [BaseType.SECOND]: '2nd',\n    [BaseType.THIRD]: '3rd',\n  }[base];\n};\n\nexport const getPositionAbbreviation = (position: FieldingPosition) =>\n  ({\n    [FieldingPosition.PITCHER]: 'P',\n    [FieldingPosition.CATCHER]: 'C',\n    [FieldingPosition.FIRST_BASE]: '1B',\n    [FieldingPosition.SECOND_BASE]: '2B',\n    [FieldingPosition.THIRD_BASE]: '3B',\n    [FieldingPosition.SHORTSTOP]: 'SS',\n    [FieldingPosition.LEFT_FIELD]: 'LF',\n    [FieldingPosition.CENTER_FIELD]: 'CF',\n    [FieldingPosition.LEFT_CENTER]: 'LCF',\n    [FieldingPosition.RIGHT_CENTER]: 'RCF',\n    [FieldingPosition.RIGHT_FIELD]: 'RF',\n  }[position]);\n\nexport const getPlateAppearanceLabel = (paType: PlateAppearanceType) =>\n  ({\n    [PlateAppearanceType.OUT]: 'Out',\n    [PlateAppearanceType.SINGLE]: 'Single',\n    [PlateAppearanceType.DOUBLE]: 'Double',\n    [PlateAppearanceType.TRIPLE]: 'Triple',\n    [PlateAppearanceType.HOMERUN]: 'Home Run',\n    [PlateAppearanceType.WALK]: 'Walk',\n    [PlateAppearanceType.SACRIFICE_FLY]: 'Sacrifice Fly',\n    [PlateAppearanceType.FIELDERS_CHOICE]: \"Fielder's Choice\",\n    [PlateAppearanceType.DOUBLE_PLAY]: 'Double Play',\n  }[paType]);\n\nexport const getOutLabelFromContact = (contactType: ContactType) =>\n  ({\n    [ContactType.GROUNDER]: 'Groundout',\n    [ContactType.LAZY_FLY]: 'Lazy flyout',\n    [ContactType.LINE_DRIVE]: 'Lineout',\n    [ContactType.LONG_FLY]: 'Long flyout',\n    [ContactType.POPUP]: 'Popout',\n    [ContactType.NONE]: 'Strikeout',\n  }[contactType]);\n\nexport const getHitLabelFromContact = (contactType: HitContactType) =>\n  ({\n    [ContactType.GROUNDER]: 'Ground ball',\n    [ContactType.LAZY_FLY]: 'Lazy fly ball',\n    [ContactType.LINE_DRIVE]: 'Line drive',\n    [ContactType.LONG_FLY]: 'Long fly ball',\n    [ContactType.POPUP]: 'Pop fly',\n  }[contactType]);\n\nexport const getRunnerOptionLabel = (option: BasepathOutcome) => {\n  if (!option.attemptedAdvance) {\n    return `Held at ${formatShortBaseName(option.endBase)}`;\n  }\n  if (option.endBase === null) {\n    if (option.successfulAdvance) {\n      return 'Scored';\n    }\n    return 'Out at home';\n  }\n  const baseName = formatShortBaseName(option.endBase);\n  if (option.successfulAdvance) {\n    return `Took ${baseName}`;\n  }\n  return `Out at ${baseName}`;\n};\n\nexport const getOrdinalInning = (inning: number) => {\n  let suffix;\n  switch (inning) {\n    case 1:\n      suffix = 'st';\n      break;\n    case 2:\n      suffix = 'nd';\n      break;\n    case 3:\n      suffix = 'rd';\n      break;\n    default:\n      suffix = 'th';\n      break;\n  }\n  return `${inning}${suffix}`;\n};\n","import _ from 'lodash';\n\nimport {\n  ContactType,\n  HitContactType,\n  FieldingPosition,\n  PlateAppearanceType,\n  BaseRunners,\n  BaseType,\n} from 'state/game/types';\nimport {\n  getDefaultRunnersAfterPlateAppearance,\n  getSortedRunners,\n  getBaseNumber,\n  forEachRunner,\n  moveRunner,\n  moveRunnersOnGroundBall,\n  removeRunner,\n  getPreviousBase,\n  getNewBase,\n  getNumBasesForPlateAppearance,\n  getLeadRunner,\n} from 'state/game/utils';\nimport {\n  getHitLabelFromContact,\n  getOutLabelFromContact,\n  getPositionAbbreviation,\n} from 'utils/labels';\n\nimport { PlateAppearanceDetailOptions, RunnerOptions, BasepathOutcome } from './types';\n\nconst getTrailingRunner = (runners: BaseRunners, leadBase: BaseType | null) => {\n  if (leadBase === null) {\n    return getLeadRunner(runners);\n  }\n\n  let trailingRunner: [BaseType, string] | undefined;\n  forEachRunner(runners, (runnerId, base) => {\n    if (getBaseNumber(base) < getBaseNumber(leadBase)) {\n      trailingRunner = [base, runnerId];\n      return false;\n    }\n  });\n\n  return trailingRunner;\n};\n\nexport const getAvailableBases = (currentBase: BaseType, nextRunner: BaseType | null) => {\n  const possibleBases = [..._.values(BaseType), null];\n  if (nextRunner === null) {\n    return possibleBases.filter(base => getBaseNumber(base) > getBaseNumber(currentBase));\n  }\n  return possibleBases.filter(base =>\n    _.inRange(getBaseNumber(base), getBaseNumber(currentBase) + 1, getBaseNumber(nextRunner))\n  );\n};\n\nconst inPlayContactOptions = _.values(ContactType).filter(\n  ct => ct !== ContactType.NONE\n) as HitContactType[];\nconst getContactOptionsForHit = (contactTypes: HitContactType[] = inPlayContactOptions) =>\n  contactTypes.map((contactType, id) => ({\n    id,\n    contactType,\n    label: getHitLabelFromContact(contactType),\n  }));\nconst getContactOptionsForOut = (contactTypes: ContactType[] = _.values(ContactType)) =>\n  contactTypes.map((contactType, id) => ({\n    id,\n    contactType,\n    label: getOutLabelFromContact(contactType),\n  }));\n\nconst infieldPositions = [\n  FieldingPosition.PITCHER,\n  FieldingPosition.CATCHER,\n  FieldingPosition.FIRST_BASE,\n  FieldingPosition.SECOND_BASE,\n  FieldingPosition.THIRD_BASE,\n  FieldingPosition.SHORTSTOP,\n];\nconst getOutfieldPositions = (fourOutfielders: boolean) => [\n  FieldingPosition.LEFT_FIELD,\n  ...(fourOutfielders\n    ? [FieldingPosition.LEFT_CENTER, FieldingPosition.RIGHT_CENTER]\n    : [FieldingPosition.CENTER_FIELD]),\n  FieldingPosition.RIGHT_FIELD,\n];\nconst getAllPositions = (fourOutfielders: boolean) => [\n  ...infieldPositions,\n  ...getOutfieldPositions(fourOutfielders),\n];\nconst makeFielderOptions = (positions: FieldingPosition[]) =>\n  positions.map((position, id) => ({ id, position, label: getPositionAbbreviation(position) }));\n\nconst getFielderOptionsForContactType = (\n  contactType: ContactType,\n  hit: boolean,\n  fourOutfielders: boolean\n) => {\n  let positions: FieldingPosition[];\n  switch (contactType) {\n    case ContactType.GROUNDER:\n      positions = hit ? getAllPositions(fourOutfielders) : infieldPositions;\n      break;\n    case ContactType.POPUP:\n      positions = infieldPositions;\n      break;\n    case ContactType.LAZY_FLY:\n    case ContactType.LONG_FLY:\n      positions = getOutfieldPositions(fourOutfielders);\n      break;\n    case ContactType.LINE_DRIVE:\n      positions = getAllPositions(fourOutfielders).filter(\n        position => position !== FieldingPosition.CATCHER\n      );\n      break;\n    case ContactType.NONE:\n      positions = [];\n      break;\n  }\n  return makeFielderOptions(positions);\n};\n\nconst getBasepathOutcomesForBases = (bases: (BaseType | null)[]): BasepathOutcome[] => {\n  if (!bases.length) return [];\n\n  const advancedOptions = _.flatten(\n    _.map(bases, endBase =>\n      [true, false].map(successfulAdvance => ({\n        attemptedAdvance: true as true,\n        successfulAdvance,\n        endBase,\n      }))\n    )\n  );\n\n  const options = [\n    { attemptedAdvance: false as false, endBase: getPreviousBase(advancedOptions[0].endBase)! },\n    ...advancedOptions,\n  ];\n\n  return options.map(({ ...option }, id) => ({ id, ...option }));\n};\n\nexport const getRunnerOptions = (\n  runners: BaseRunners,\n  outs: number,\n  expectedBases: Record<string, BaseType | null> = {},\n  allowScoring = true\n): RunnerOptions | undefined => {\n  const leadRunner = getLeadRunner(runners);\n  if (!leadRunner) return;\n  const [currentBase] = leadRunner;\n\n  return getRunnerOptionsRecursive(runners, outs, currentBase, null, expectedBases, allowScoring);\n};\nconst getRunnerOptionsRecursive = (\n  runners: BaseRunners,\n  outs: number,\n  currentBase: BaseType,\n  runnerAhead: BaseType | null,\n  expectedBases: Record<string, BaseType | null>,\n  allowScoring: boolean\n): RunnerOptions | undefined => {\n  const runnerId = runners[currentBase]!;\n  const nextRunner = getTrailingRunner(runners, currentBase);\n  const options = getBasepathOutcomesForBases(getAvailableBases(currentBase, runnerAhead)).filter(\n    option => option.endBase || allowScoring\n  );\n  const defaultOption =\n    runnerId in expectedBases\n      ? _.findIndex(options, ({ endBase }) => endBase === expectedBases[runnerId])\n      : 0;\n\n  if (options.length < 2) return;\n  if (!nextRunner) return { runnerId, options, defaultOption };\n\n  const [nextBase] = nextRunner;\n  const newRunners = { ...runners };\n\n  return {\n    runnerId,\n    options,\n    defaultOption,\n    getTrailingRunnerOptions: outcome => {\n      let currentOuts = outs;\n      let endBase: BaseType | null = currentBase;\n      if (outcome.attemptedAdvance) {\n        endBase = outcome.endBase;\n        if (!outcome.successfulAdvance) {\n          delete newRunners[currentBase];\n          currentOuts++;\n          if (currentOuts === 3) return;\n          endBase = runnerAhead;\n        } else if (!endBase) {\n          delete newRunners[currentBase];\n        } else {\n          moveRunner(newRunners, currentBase, endBase);\n        }\n      }\n\n      return getRunnerOptionsRecursive(\n        newRunners,\n        currentOuts,\n        nextBase,\n        endBase,\n        expectedBases,\n        allowScoring\n      );\n    },\n  };\n};\n\nexport const getPlateAppearanceDetailPrompt = (\n  paType: PlateAppearanceType,\n  batterId: string,\n  outs: number,\n  runners: BaseRunners,\n  fourOutfielders: boolean\n): PlateAppearanceDetailOptions | void => {\n  switch (paType) {\n    case PlateAppearanceType.WALK:\n      return;\n\n    case PlateAppearanceType.HOMERUN:\n      return {\n        kind: 'hit',\n        contactOptions: {\n          options: getContactOptionsForHit([ContactType.LINE_DRIVE, ContactType.LONG_FLY]),\n        },\n        getNextOptions: () => ({\n          options: makeFielderOptions(getOutfieldPositions(fourOutfielders)),\n        }),\n      };\n\n    case PlateAppearanceType.OUT:\n      return {\n        kind: 'out',\n        contactOptions: {\n          required: true,\n          options: getContactOptionsForOut(),\n        },\n        getNextOptions: (contactType: ContactType) => {\n          const newRunners = { ...runners };\n          if (contactType === ContactType.NONE) return;\n          const fielderOptions = {\n            options: getFielderOptionsForContactType(contactType, false, fourOutfielders),\n          };\n          if (outs === 2) {\n            return { fielderOptions };\n          }\n          if (contactType === ContactType.GROUNDER) {\n            moveRunnersOnGroundBall(newRunners);\n          }\n          return {\n            fielderOptions,\n            runnerOptions: getRunnerOptions(\n              newRunners,\n              outs + 1,\n              {},\n              contactType === ContactType.GROUNDER\n            ),\n          };\n        },\n      };\n\n    case PlateAppearanceType.SACRIFICE_FLY:\n      const fielderOptions = { options: makeFielderOptions(getOutfieldPositions(fourOutfielders)) };\n      if (_.size(runners) === 1) {\n        return { kind: 'sacrificeFly', fielderOptions };\n      }\n\n      return {\n        kind: 'sacrificeFly',\n        fielderOptions,\n        runnersScoredOptions: _.range(1, _.size(runners) + 1),\n        getNextOptions: numScored => {\n          const newRunners = { ...runners };\n          _.times(numScored, () => {\n            moveRunner(newRunners, getLeadRunner(newRunners)![0], null);\n          });\n\n          return getRunnerOptions(newRunners, outs + 1, {}, false);\n        },\n      };\n\n    case PlateAppearanceType.FIELDERS_CHOICE:\n      return {\n        kind: 'fieldersChoice',\n        outOnPlayOptions: { runnerIds: _.values(runners) as string[] },\n        fielderOptions: {\n          options: getFielderOptionsForContactType(ContactType.GROUNDER, false, fourOutfielders),\n        },\n        getNextOptions:\n          outs < 2\n            ? runnerOut => {\n                const newRunners = { ...runners };\n                removeRunner(newRunners, runnerOut);\n                moveRunnersOnGroundBall(newRunners);\n                newRunners[BaseType.FIRST] = batterId;\n                return getRunnerOptions(newRunners, outs + 1);\n              }\n            : undefined,\n      };\n\n    case PlateAppearanceType.DOUBLE_PLAY:\n      const runnerIds = _.map(_.reverse(getSortedRunners(runners)), 1);\n      return {\n        kind: 'doublePlay',\n        contactOptions: {\n          options: getContactOptionsForOut(inPlayContactOptions),\n          required: true,\n        },\n        getNextOptions: contactType => {\n          const fielderOptions = {\n            options: getFielderOptionsForContactType(contactType, false, fourOutfielders),\n          };\n          if (_.size(runners) === 1) {\n            return {\n              fielderOptions,\n              outOnPlayOptions: {\n                runnerIds: [...runnerIds, batterId],\n                multiple: true,\n              },\n            };\n          }\n\n          if (contactType === ContactType.GROUNDER) {\n            return {\n              fielderOptions,\n              outOnPlayOptions: {\n                runnerIds: [...runnerIds, batterId],\n                multiple: true,\n              },\n              getNextOptions:\n                outs === 0\n                  ? runnersOut => {\n                      const newRunners = { ...runners };\n                      runnersOut.forEach(runnerId => removeRunner(newRunners, runnerId));\n                      moveRunnersOnGroundBall(newRunners);\n                      if (!runnersOut.includes(batterId)) {\n                        // the rare fielder's choice double play\n                        newRunners[BaseType.FIRST] = batterId;\n                      }\n                      return getRunnerOptions(newRunners, outs + 2);\n                    }\n                  : undefined,\n            };\n          }\n\n          return {\n            outOnPlayOptions: { runnerIds },\n            fielderOptions,\n            getNextOptions:\n              outs === 0\n                ? runnersOut => {\n                    const newRunners = { ...runners };\n                    removeRunner(newRunners, runnersOut[0]);\n                    return getRunnerOptions(newRunners, outs + 2);\n                  }\n                : undefined,\n          };\n        },\n      };\n\n    default:\n      const [defaultRunnerPositions] = getDefaultRunnersAfterPlateAppearance(\n        runners,\n        paType,\n        batterId\n      );\n\n      const runnersToBases = _.invert(runners) as Record<string, BaseType>;\n      const expectedBases = _.mapValues(runnersToBases, (base: BaseType) =>\n        getNewBase(base, getNumBasesForPlateAppearance(paType))\n      );\n\n      return {\n        kind: 'hit',\n        contactOptions: { options: getContactOptionsForHit() },\n        runnerOptions: getRunnerOptions(defaultRunnerPositions, outs, expectedBases),\n        getNextOptions: contactType => ({\n          options: getFielderOptionsForContactType(contactType, true, fourOutfielders),\n        }),\n      };\n  }\n};\n\nexport const getExtraRunnerMovementForPlateAppearance = (\n  allRunnerChoices: Record<string, BasepathOutcome>\n) => {\n  const basesTaken: Record<string, BaseType | null> = {};\n  const outsOnBasepaths: Record<string, BaseType | null> = {};\n\n  _.forEach(allRunnerChoices, (outcome, runnerId) => {\n    if (outcome.attemptedAdvance) {\n      if (outcome.successfulAdvance) {\n        basesTaken[runnerId] = outcome.endBase;\n      } else {\n        outsOnBasepaths[runnerId] = outcome.endBase;\n      }\n    }\n  });\n\n  return { basesTaken, outsOnBasepaths };\n};\n","import { createSelector } from '@reduxjs/toolkit';\nimport _ from 'lodash';\n\nimport { getShortPlayerName, getAllPlayersList } from 'state/players/selectors';\nimport { getPlateAppearanceDetailPrompt } from 'state/prompts/prompts';\nimport { getAvailablePositionsForTeam, shouldTeamUseFourOutfielders } from './utils';\n\nimport { AppState } from 'state/store';\nimport {\n  BaseRunners,\n  TeamRole,\n  PlateAppearanceType,\n  HalfInning,\n  FieldingPosition,\n  GameStatus,\n} from './types';\n\nconst MIN_PLAYERS_TO_PLAY = 8;\n\nexport const getTeams = (state: AppState) => state.game.present.teams;\n\nexport const getRunners = (state: AppState) => state.game.present.runners;\nexport const getNumOuts = (state: AppState) => state.game.present.outs;\nexport const getScore = (state: AppState) => state.game.present.score;\nexport const getHalfInning = (state: AppState) => state.game.present.halfInning;\nexport const getInning = (state: AppState) => state.game.present.inning;\nexport const getCurrentBatter = (state: AppState) => state.game.present.atBat;\n\nexport const getBattingTeam = createSelector(getHalfInning, half =>\n  half === HalfInning.BOTTOM ? TeamRole.HOME : TeamRole.AWAY\n);\n\nexport const getBattingLineup = createSelector(\n  getTeams,\n  getBattingTeam,\n  (teams, battingTeam) => teams[battingTeam].lineup\n);\n\nexport const getAvailablePositions = (state: AppState, team: TeamRole) =>\n  getAvailablePositionsForTeam(getTeams(state)[team]);\n\nexport const doesFieldingTeamHaveFourOutfielders = createSelector(\n  getTeams,\n  getHalfInning,\n  (teams, halfInning) => shouldTeamUseFourOutfielders(teams[1 - halfInning])\n);\n\nexport const getRunnerNames = createSelector(\n  state => state,\n  getRunners,\n  (state, runners): BaseRunners =>\n    _.mapValues<BaseRunners>(runners, (id: string) => getShortPlayerName(state, id))\n);\n\nconst getBatter = (state: AppState) => state.game.present.atBat;\nexport const getBatterName = createSelector(\n  state => state,\n  getBatter,\n  (state, batterId) => (batterId ? getShortPlayerName(state, batterId) : '')\n);\n\nexport const getPlayerAtPosition = (state: AppState, team: TeamRole, position: FieldingPosition) =>\n  _.findKey(state.game.present.teams[team].positions, p => p === position)!;\n\nexport const getPlayerPosition = (state: AppState, playerId: string) => {\n  const { positions } = _.find(getTeams(state), ({ lineup }) => lineup.includes(playerId))!;\n  return positions[playerId];\n};\n\nexport const getLineups = createSelector(\n  getTeams,\n  teams => teams.map(team => team.lineup) as [string[], string[]]\n);\nexport const getLineup = (state: AppState, teamRole: TeamRole) => getTeams(state)[teamRole].lineup;\n\nexport const getPlayersNotInGame = createSelector(\n  getAllPlayersList,\n  getLineups,\n  (allPlayers, lineups) => {\n    const allPlayersInGame = _.flatten(lineups);\n    return allPlayers.filter(({ playerId }) => !allPlayersInGame.includes(playerId));\n  }\n);\n\nexport const canStartGame = createSelector(\n  getLineups,\n  ([{ length: numAwayPlayers }, { length: numHomePlayers }]) =>\n    Math.abs(numAwayPlayers - numHomePlayers) <= 1 &&\n    numAwayPlayers >= MIN_PLAYERS_TO_PLAY &&\n    numHomePlayers >= MIN_PLAYERS_TO_PLAY\n);\n\nexport const getGameStatus = (state: AppState) => state.game.present.status;\nexport const isGameInProgress = createSelector(\n  getGameStatus,\n  status => status === GameStatus.IN_PROGRESS\n);\nexport const isGameOver = createSelector(getGameStatus, status => status === GameStatus.FINISHED);\n\nexport const getPlateAppearanceOptions = createSelector(getRunners, getNumOuts, (runners, outs) => {\n  const notPossible: Set<PlateAppearanceType> = new Set();\n\n  if (!_.size(runners)) {\n    notPossible.add(PlateAppearanceType.FIELDERS_CHOICE);\n  }\n\n  if (outs === 2 || !_.size(runners)) {\n    notPossible.add(PlateAppearanceType.DOUBLE_PLAY);\n    notPossible.add(PlateAppearanceType.SACRIFICE_FLY);\n  }\n\n  return _.values(PlateAppearanceType).filter(paType => !notPossible.has(paType));\n});\n\nconst getNextBatter = (batterId: string | undefined, lineup: string[]) => {\n  const lineupIndex = _.findIndex(lineup, id => id === batterId);\n  if (lineupIndex === lineup.length - 1) {\n    return lineup[0];\n  }\n  return lineup[lineupIndex + 1];\n};\nexport const getOnDeckBatter = createSelector(getCurrentBatter, getBattingLineup, getNextBatter);\nexport const getInTheHoleBatter = createSelector(getOnDeckBatter, getBattingLineup, getNextBatter);\nexport const getOnDeckBatterName = createSelector(\n  state => state,\n  getOnDeckBatter,\n  getShortPlayerName\n);\nexport const getInTheHoleBatterName = createSelector(\n  state => state,\n  getInTheHoleBatter,\n  getShortPlayerName\n);\n\nexport const createPlateAppearancePromptSelector = (paType: PlateAppearanceType) =>\n  createSelector(\n    getCurrentBatter,\n    getNumOuts,\n    getRunners,\n    doesFieldingTeamHaveFourOutfielders,\n    (batterId, outs, runners, fourOutfielders) =>\n      getPlateAppearanceDetailPrompt(paType, batterId!, outs, runners, fourOutfielders)\n  );\n\nexport const getGameHistory = (state: AppState) => state.game.present.gameHistory;\n\nexport const getCurrentGameLength = (state: AppState) => state.game.present.gameLength;\nexport const getMinGameLength = createSelector(\n  getInning,\n  getHalfInning,\n  getScore,\n  (inning, halfInning, [awayScore, homeScore]) => {\n    if (halfInning === HalfInning.BOTTOM && homeScore > awayScore) {\n      return Math.max(7, inning + 1);\n    }\n    return Math.max(7, inning);\n  }\n);\nexport const getMaxGameLength = () => 12;\n\nexport const isGameInExtraInnings = createSelector(\n  getInning,\n  getCurrentGameLength,\n  (inning, gameLength) => inning > gameLength\n);\n\nexport const getPresent = (state: AppState) => state.game.present;\nexport const getPast = (state: AppState) => state.game.past;\nexport const getFuture = (state: AppState) => state.game.future;\n\nexport const isUndoPossible = createSelector(getPast, past => past.length > 0);\nexport const isRedoPossible = createSelector(getFuture, future => future.length > 0);\n","import { useEffect, EffectCallback } from 'react';\nimport { useDispatch, useSelector, TypedUseSelectorHook } from 'react-redux';\n\nimport { AppState, AppDispatch } from 'state/store';\n\n// eslint-disable-next-line\nexport const useMount = (effect: EffectCallback) => useEffect(effect, []);\n\nexport const useAppDispatch = () => useDispatch<AppDispatch>();\nexport const useAppSelector: TypedUseSelectorHook<AppState> = useSelector;\n","import React, { CSSProperties } from 'react';\nimport { Table, TableBody, TableRow, TableCell, Box, Text } from 'grommet';\n\nimport {\n  getScore,\n  getBattingTeam,\n  getNumOuts,\n  getHalfInning,\n  getInning,\n} from 'state/game/selectors';\nimport { TeamRole, HalfInning } from 'state/game/types';\nimport { useAppSelector } from 'utils/hooks';\nimport { CaretUpFill, CaretDownFill } from 'grommet-icons';\n\nconst boldStyle: CSSProperties = { fontWeight: 'bold' };\n\nconst ScoreBug = () => {\n  const [awayScore, homeScore] = useAppSelector(getScore);\n  const battingTeam = useAppSelector(getBattingTeam);\n  const halfInning = useAppSelector(getHalfInning);\n  const inning = useAppSelector(getInning);\n  const numOuts = useAppSelector(getNumOuts);\n\n  return (\n    <Box direction=\"row\" gap=\"medium\" align=\"center\">\n      <Text>\n        {numOuts} {numOuts === 1 ? 'out' : 'outs'}\n      </Text>\n      <Box direction=\"row\" align=\"center\">\n        {halfInning === HalfInning.TOP ? <CaretUpFill /> : <CaretDownFill />}\n        <Text>{inning}</Text>\n      </Box>\n      <Table>\n        <TableBody>\n          <TableRow style={battingTeam === TeamRole.AWAY ? boldStyle : undefined}>\n            <TableCell scope=\"row\">Away</TableCell>\n            <TableCell>{awayScore}</TableCell>\n          </TableRow>\n          <TableRow style={battingTeam === TeamRole.HOME ? boldStyle : undefined}>\n            <TableCell scope=\"row\">Home</TableCell>\n            <TableCell>{homeScore}</TableCell>\n          </TableRow>\n        </TableBody>\n      </Table>\n    </Box>\n  );\n};\n\nexport default ScoreBug;\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport _ from 'lodash';\nimport undoable, { includeAction } from 'redux-undo';\n\nimport { reorderItemInList, moveItemBetweenLists } from 'utils/common';\nimport { getOnDeckBatter } from './partialSelectors';\nimport {\n  getAvailablePositionsForTeam,\n  shouldTeamUseFourOutfielders,\n  applyGameEvent,\n} from './utils';\n\nimport {\n  GameState,\n  Team,\n  AddPlayerPayload,\n  HalfInning,\n  GameEvent,\n  MovePlayerPayload,\n  ChangePlayerPositionPayload,\n  FieldingPosition,\n  GameStatus,\n} from './types';\n\nconst initialTeamState: Team = {\n  name: '',\n  lineup: [],\n  positions: {},\n};\n\nconst initialState: GameState = {\n  status: GameStatus.NOT_STARTED,\n  teams: [initialTeamState, initialTeamState],\n  inning: 1,\n  halfInning: HalfInning.TOP,\n  runners: {},\n  outs: 0,\n  gameHistory: [],\n  score: [0, 0],\n  gameLength: 9,\n};\n\nconst getNextAvailablePosition = (team: Team) => {\n  const takenPositions = _.values(team.positions);\n  const allPositions = getAvailablePositionsForTeam(team);\n  return allPositions.find(position => !takenPositions.includes(position))!;\n};\n\nconst updatePositions = (team: Team) => {\n  const fourOutfielders = shouldTeamUseFourOutfielders(team);\n  _.forEach(team.positions, (position, playerId) => {\n    if (fourOutfielders && position === FieldingPosition.CENTER_FIELD) {\n      if (!_.some(team.positions, position => position === FieldingPosition.LEFT_CENTER)) {\n        team.positions[playerId] = FieldingPosition.LEFT_CENTER;\n      } else if (!_.some(team.positions, position => position === FieldingPosition.RIGHT_CENTER)) {\n        team.positions[playerId] = FieldingPosition.RIGHT_CENTER;\n      } else {\n        team.positions[playerId] = getNextAvailablePosition(team);\n      }\n    } else if (\n      !fourOutfielders &&\n      [FieldingPosition.RIGHT_CENTER, FieldingPosition.LEFT_CENTER].includes(position)\n    ) {\n      if (!_.some(team.positions, position => position === FieldingPosition.CENTER_FIELD)) {\n        team.positions[playerId] = FieldingPosition.CENTER_FIELD;\n      } else {\n        team.positions[playerId] = getNextAvailablePosition(team);\n      }\n    }\n  });\n};\n\nconst cleanUpAfterPlateAppearance = (state: GameState) => {\n  const nextBatter = getOnDeckBatter(state);\n  if (state.outs === 3) {\n    state.atBat = state.upNextHalfInning;\n    state.upNextHalfInning = nextBatter;\n    state.runners = {};\n    state.outs = 0;\n    if (state.halfInning === HalfInning.BOTTOM) {\n      state.inning++;\n    }\n    state.halfInning = 1 - state.halfInning;\n  } else {\n    state.atBat = nextBatter;\n  }\n};\n\nconst { actions: gameActions, reducer } = createSlice({\n  name: 'game',\n  initialState,\n  reducers: {\n    addPlayerToGame(state, { payload }: PayloadAction<AddPlayerPayload>) {\n      const team = state.teams[payload.team];\n      if (!team.lineup.includes(payload.playerId)) {\n        team.lineup.push(payload.playerId);\n        team.positions[payload.playerId] = getNextAvailablePosition(team);\n        updatePositions(team);\n      }\n    },\n    movePlayer(state, { payload }: PayloadAction<MovePlayerPayload>) {\n      if (payload.fromTeam === payload.toTeam) {\n        const team = state.teams[payload.fromTeam];\n        team.lineup = reorderItemInList(team.lineup, payload.startIndex, payload.endIndex);\n      } else {\n        const sourceTeam = state.teams[payload.fromTeam];\n        const destTeam = state.teams[payload.toTeam];\n        const [newSourceLineup, newDestLineup] = moveItemBetweenLists(\n          sourceTeam.lineup,\n          destTeam.lineup,\n          payload.startIndex,\n          payload.endIndex\n        );\n        const playerId = sourceTeam.lineup[payload.startIndex];\n        sourceTeam.lineup = newSourceLineup;\n        destTeam.lineup = newDestLineup;\n        const currentPlayerWithPosition = _.findKey(\n          destTeam.positions,\n          position => position === sourceTeam.positions[playerId]\n        );\n        if (\n          currentPlayerWithPosition ||\n          !getAvailablePositionsForTeam(destTeam).includes(sourceTeam.positions[playerId])\n        ) {\n          destTeam.positions[playerId] = getNextAvailablePosition(destTeam);\n        } else {\n          destTeam.positions[playerId] = sourceTeam.positions[playerId];\n        }\n        delete sourceTeam.positions[playerId];\n        updatePositions(sourceTeam);\n        updatePositions(destTeam);\n      }\n    },\n    removePlayerFromGame(state, { payload }: PayloadAction<string>) {\n      state.teams.forEach(team => {\n        team.lineup = team.lineup.filter(playerId => playerId !== payload);\n        delete team.positions[payload];\n        updatePositions(team);\n      });\n    },\n    changePlayerPosition(state, { payload }: PayloadAction<ChangePlayerPositionPayload>) {\n      const { positions } = state.teams.find(({ lineup }) => lineup.includes(payload.playerId))!;\n      const currentPlayerWithPosition = _.findKey(\n        positions,\n        position => position === payload.position\n      );\n      if (currentPlayerWithPosition) {\n        positions[currentPlayerWithPosition] = positions[payload.playerId];\n      }\n      positions[payload.playerId] = payload.position;\n    },\n    startGame(state) {\n      state.atBat = state.teams[0].lineup[0];\n      state.upNextHalfInning = state.teams[1].lineup[0];\n      state.status = GameStatus.IN_PROGRESS;\n    },\n    recordGameEvent(state, { payload }: PayloadAction<GameEvent>) {\n      applyGameEvent(state, payload);\n\n      const [awayScore, homeScore] = state.score;\n      const homeLeadingAfterTop =\n        state.outs === 3 && state.halfInning === HalfInning.TOP && awayScore < homeScore;\n      const awayLeadingAfterBottom =\n        state.outs === 3 && state.halfInning === HalfInning.BOTTOM && awayScore > homeScore;\n\n      if (\n        state.inning >= state.gameLength &&\n        (homeLeadingAfterTop ||\n          awayLeadingAfterBottom ||\n          (state.halfInning === HalfInning.BOTTOM && awayScore < homeScore))\n      ) {\n        state.status = GameStatus.FINISHED;\n      } else {\n        cleanUpAfterPlateAppearance(state);\n      }\n    },\n    changeGameLength(state, { payload }: PayloadAction<number>) {\n      state.gameLength = payload;\n    },\n    incrementGameLength(state) {\n      state.gameLength += 1;\n    },\n    decrementGameLength(state) {\n      state.gameLength -= 1;\n    },\n    extendGame(state) {\n      state.gameLength = Math.max(state.inning, state.gameLength) + 1;\n      state.status = GameStatus.IN_PROGRESS;\n      cleanUpAfterPlateAppearance(state);\n    },\n    resetGame(state) {\n      return {\n        ...initialState,\n        teams: state.teams,\n      };\n    },\n    fullResetGame() {\n      return { ...initialState };\n    },\n  },\n});\n\nexport { gameActions };\nexport default undoable(reducer, {\n  filter: includeAction(gameActions.recordGameEvent.type),\n  limit: 10,\n  syncFilter: true,\n});\n","export const reorderItemInList = <T>(list: T[], startIndex: number, endIndex: number) => {\n  const result = Array.from(list);\n  const [removed] = result.splice(startIndex, 1);\n  result.splice(endIndex, 0, removed);\n\n  return result;\n};\n\nexport const moveItemBetweenLists = <T>(\n  sourceList: T[],\n  destList: T[],\n  startIndex: number,\n  endIndex: number\n) => {\n  const sourceClone = Array.from(sourceList);\n  const destClone = Array.from(destList);\n  const [removed] = sourceClone.splice(startIndex, 1);\n\n  destClone.splice(endIndex, 0, removed);\n  return [sourceClone, destClone];\n};\n","import React, { useCallback, ChangeEvent, useState } from 'react';\nimport { Box, Button, DropButton, Heading, RangeInput, Text } from 'grommet';\nimport { Add, PowerReset, Subtract } from 'grommet-icons';\n\nimport {\n  getCurrentGameLength,\n  getMaxGameLength,\n  getMinGameLength,\n  isGameInExtraInnings,\n  isGameInProgress,\n} from 'state/game/selectors';\nimport { gameActions } from 'state/game/slice';\nimport { useAppDispatch, useAppSelector } from 'utils/hooks';\n\nconst ResetConfirm = () => {\n  const dispatch = useAppDispatch();\n\n  const onConfirm = useCallback(() => {\n    dispatch(gameActions.resetGame());\n  }, [dispatch]);\n\n  return (\n    <Box pad=\"small\" width=\"small\" gap=\"small\">\n      <Text textAlign=\"center\" size=\"small\">\n        Are you sure you want to reset the game?\n      </Text>\n      <Button size=\"small\" color=\"status-critical\" label=\"Reset\" onClick={onConfirm} />\n    </Box>\n  );\n};\n\nconst SettingsMenu = () => {\n  const dispatch = useAppDispatch();\n\n  const minInnings = useAppSelector(getMinGameLength);\n  const maxInnings = useAppSelector(getMaxGameLength);\n  const currentGameLength = useAppSelector(getCurrentGameLength);\n  const inProgress = useAppSelector(isGameInProgress);\n  const inExtraInnings = useAppSelector(isGameInExtraInnings);\n\n  const [resetConfirmOpen, setResetConfirmOpen] = useState(false);\n\n  const handleChangeGameLength = useCallback(\n    ({ target }: ChangeEvent<HTMLInputElement>) => {\n      dispatch(gameActions.changeGameLength(parseInt(target.value)));\n    },\n    [dispatch]\n  );\n\n  const handleClickSubtractGameLength = useCallback(\n    () => dispatch(gameActions.decrementGameLength()),\n    [dispatch]\n  );\n  const handleClickAddGameLength = useCallback(() => dispatch(gameActions.incrementGameLength()), [\n    dispatch,\n  ]);\n\n  return (\n    <Box pad={{ vertical: 'medium', horizontal: 'small' }} gap=\"medium\">\n      <Box>\n        <Heading level={5} margin=\"none\" alignSelf=\"center\">\n          Game Length\n        </Heading>\n        <Box direction=\"row\" align=\"center\" gap=\"xsmall\">\n          <Button\n            icon={<Subtract />}\n            onClick={handleClickSubtractGameLength}\n            disabled={currentGameLength === minInnings || inExtraInnings}\n          />\n          <RangeInput\n            step={1}\n            min={minInnings}\n            max={maxInnings}\n            value={currentGameLength}\n            onChange={handleChangeGameLength}\n            disabled={inExtraInnings}\n          />\n          <Button\n            icon={<Add />}\n            onClick={handleClickAddGameLength}\n            disabled={currentGameLength === maxInnings || inExtraInnings}\n          />\n        </Box>\n        <Text\n          size=\"small\"\n          alignSelf=\"center\"\n          color={inExtraInnings ? 'status-critical' : undefined}\n        >\n          {inExtraInnings ? 'In extra' : currentGameLength} innings\n        </Text>\n      </Box>\n      {inProgress && (\n        <DropButton\n          label=\"Reset game\"\n          icon={<PowerReset color=\"status-critical\" />}\n          color=\"status-critical\"\n          alignSelf=\"center\"\n          open={resetConfirmOpen}\n          onOpen={() => setResetConfirmOpen(true)}\n          dropContent={<ResetConfirm />}\n          dropProps={{ align: { top: 'bottom' } }}\n          onClose={() => setResetConfirmOpen(false)}\n        />\n      )}\n    </Box>\n  );\n};\n\nexport default SettingsMenu;\n","import React, { FC } from 'react';\nimport { Blank, IconProps } from 'grommet-icons';\nimport { BaseRunners, BaseType } from 'state/game/types';\n\ninterface Props {\n  bases: BaseRunners;\n}\n\nconst BasesPreview: FC<IconProps & Props> = ({ bases, ...props }) => {\n  const { [BaseType.FIRST]: first, [BaseType.SECOND]: second, [BaseType.THIRD]: third } = bases;\n  return (\n    <Blank size=\"large\" {...props}>\n      <svg\n        version=\"1.1\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        xmlnsXlink=\"http://www.w3.org/1999/xlink\"\n        preserveAspectRatio=\"xMidYMid meet\"\n        viewBox=\"0 0 48 48\"\n        width=\"24\"\n        height=\"24\"\n      >\n        <defs>\n          <path d=\"M24 25.73L13.11 14.84L24 3.95L34.89 14.84L24 25.73Z\" id=\"a1RZhYfL4q\" />\n          <clipPath id=\"clipg3BqRYPvvE\">\n            <use xlinkHref=\"#a1RZhYfL4q\" opacity=\"1\" />\n          </clipPath>\n          <path d=\"M36.31 38.05L25.42 27.16L36.31 16.27L47.2 27.16L36.31 38.05Z\" id=\"aqb5ZIsm9\" />\n          <clipPath id=\"clipa6tqurtbA\">\n            <use xlinkHref=\"#aqb5ZIsm9\" opacity=\"1\" />\n          </clipPath>\n          <path d=\"M11.69 38.05L0.8 27.16L11.69 16.27L22.58 27.16L11.69 38.05Z\" id=\"bosriBPNJ\" />\n          <clipPath id=\"cliph2h312r3G7\">\n            <use xlinkHref=\"#bosriBPNJ\" opacity=\"1\" />\n          </clipPath>\n        </defs>\n        <g>\n          <g>\n            <g>\n              <use\n                xlinkHref=\"#aqb5ZIsm9\"\n                opacity=\"1\"\n                fill=\"#000000\"\n                fillOpacity={first ? '1' : '0'}\n              />\n              <g clipPath=\"url(#clipa6tqurtbA)\">\n                <use\n                  xlinkHref=\"#aqb5ZIsm9\"\n                  opacity=\"1\"\n                  fillOpacity=\"0\"\n                  stroke=\"#000000\"\n                  strokeWidth=\"2\"\n                  strokeOpacity=\"1\"\n                />\n              </g>\n            </g>\n            <g>\n              <use\n                xlinkHref=\"#a1RZhYfL4q\"\n                opacity=\"1\"\n                fill=\"#000000\"\n                fillOpacity={second ? '1' : '0'}\n              />\n              <g clipPath=\"url(#clipg3BqRYPvvE)\">\n                <use\n                  xlinkHref=\"#a1RZhYfL4q\"\n                  opacity=\"1\"\n                  fillOpacity=\"0\"\n                  stroke=\"#000000\"\n                  strokeWidth=\"2\"\n                  strokeOpacity=\"1\"\n                />\n              </g>\n            </g>\n            <g>\n              <use\n                xlinkHref=\"#bosriBPNJ\"\n                opacity=\"1\"\n                fill=\"#000000\"\n                fillOpacity={third ? '1' : '0'}\n              />\n              <g clipPath=\"url(#cliph2h312r3G7)\">\n                <use\n                  xlinkHref=\"#bosriBPNJ\"\n                  opacity=\"1\"\n                  fillOpacity=\"0\"\n                  stroke=\"#000000\"\n                  strokeWidth=\"2\"\n                  strokeOpacity=\"1\"\n                />\n              </g>\n            </g>\n          </g>\n        </g>\n      </svg>\n    </Blank>\n  );\n};\n\nexport default BasesPreview;\n","import React, { useCallback, useRef, useState } from 'react';\nimport { Header, Nav, Button, Box, Drop } from 'grommet';\nimport { SettingsOption } from 'grommet-icons';\nimport { Route, useHistory } from 'react-router-dom';\n\nimport AnchorLink from './AnchorLink';\nimport ScoreBug from './ScoreBug';\nimport SettingsMenu from './SettingsMenu';\n\nimport { canStartGame, getRunnerNames, isGameInProgress } from 'state/game/selectors';\nimport { gameActions } from 'state/game/slice';\nimport { useAppDispatch, useAppSelector } from 'utils/hooks';\nimport BasesPreview from './BasesPreview';\n\nconst TopBar = () => {\n  const dispatch = useAppDispatch();\n  const history = useHistory();\n\n  const gameInProgress = useAppSelector(isGameInProgress);\n  const gameCanStart = useAppSelector(canStartGame);\n  const runners = useAppSelector(getRunnerNames);\n\n  const startGame = useCallback(() => {\n    dispatch(gameActions.startGame());\n    history.push('/field');\n  }, [dispatch, history]);\n\n  const settingsButtonRef = useRef<HTMLButtonElement | null>(null);\n  const [showSettings, setShowSettings] = useState(false);\n\n  const toggleSettings = useCallback(() => setShowSettings(show => !show), [setShowSettings]);\n\n  return (\n    <Header background=\"brand\">\n      <Nav direction=\"row\" pad=\"medium\">\n        <AnchorLink to=\"/teams\">Teams</AnchorLink>\n        {gameInProgress && <AnchorLink to=\"/field\">Field</AnchorLink>}\n        {gameInProgress && <AnchorLink to=\"/box-score\">Box Score</AnchorLink>}\n        {gameInProgress && <AnchorLink to=\"/plays\">Plays</AnchorLink>}\n      </Nav>\n      <Box direction=\"row\" margin={{ right: 'small' }}>\n        {gameInProgress && (\n          <Box alignSelf=\"center\" margin={{ right: 'medium' }}>\n            <BasesPreview bases={runners} color=\"light-1\" />\n          </Box>\n        )}\n        {gameInProgress ? (\n          <ScoreBug />\n        ) : (\n          <Route path=\"/teams\">\n            <Button\n              plain={false}\n              disabled={!gameCanStart}\n              onClick={startGame}\n              margin={{ right: 'small' }}\n            >\n              Start Game\n            </Button>\n          </Route>\n        )}\n        <Button\n          margin={{ left: 'small' }}\n          icon={<SettingsOption />}\n          plain={false}\n          alignSelf=\"center\"\n          color=\"light-1\"\n          ref={settingsButtonRef}\n          onClick={toggleSettings}\n        />\n        {showSettings && settingsButtonRef.current && (\n          <Drop target={settingsButtonRef.current} align={{ top: 'bottom', right: 'right' }}>\n            <SettingsMenu />\n          </Drop>\n        )}\n      </Box>\n    </Header>\n  );\n};\n\nexport default TopBar;\n","import React, {\n  Children,\n  createContext,\n  FC,\n  ReactNode,\n  useCallback,\n  useContext,\n  useState,\n} from 'react';\nimport { Accordion, AccordionPanel, Box, Text } from 'grommet';\nimport { Edit } from 'grommet-icons';\nimport _ from 'lodash';\n\nconst promptAccordionContext = createContext(false);\n\nconst PromptAccordion: FC = ({ children }) => {\n  const numPanels = Children.count(children);\n\n  const [activeIndices, setActiveIndices] = useState(_.range(numPanels));\n\n  const handleActiveIndicesChange = useCallback(\n    (indices: number[]) => {\n      setActiveIndices(currentIndices => {\n        if (indices.length > currentIndices.length) {\n          return _.sortBy(indices).slice(1);\n        }\n        return currentIndices;\n      });\n    },\n    [setActiveIndices]\n  );\n\n  return (\n    <Accordion\n      multiple\n      activeIndex={activeIndices}\n      onActive={handleActiveIndicesChange}\n      gap=\"small\"\n    >\n      {Children.map(children, (child, i) => (\n        <promptAccordionContext.Provider key={i} value={activeIndices.includes(i)}>\n          {child}\n        </promptAccordionContext.Provider>\n      ))}\n    </Accordion>\n  );\n};\n\ninterface PromptAccordionPanelProps {\n  label: string;\n  preview: ReactNode;\n}\n\nexport const PromptAccordionPanel: FC<PromptAccordionPanelProps> = ({\n  label,\n  preview,\n  children,\n}) => {\n  const active = useContext(promptAccordionContext);\n\n  return (\n    <AccordionPanel\n      header={\n        <Box\n          direction=\"row\"\n          justify=\"between\"\n          pad=\"small\"\n          round=\"4px\"\n          background={active ? undefined : 'brand'}\n        >\n          <Text weight=\"bold\">{label}</Text>\n          {!active && (\n            <>\n              {preview}\n              <Edit />\n            </>\n          )}\n        </Box>\n      }\n    >\n      {children}\n    </AccordionPanel>\n  );\n};\n\nexport default PromptAccordion;\n","import { createNextState } from '@reduxjs/toolkit';\nimport _ from 'lodash';\n\nimport { getExtraRunnerMovementForPlateAppearance } from './prompts';\n\nimport { AppState } from 'state/store';\nimport { PlateAppearanceType, PlateAppearanceResult } from 'state/game/types';\nimport { applyGameEvent } from 'state/game/utils';\nimport { getPresent } from 'state/game/selectors';\n\nexport const getSelectedRunnerOption = (state: AppState, runnerId: string) =>\n  state.prompts.runnerChoices[runnerId];\n\nexport const getSelectedContactOption = (state: AppState) => state.prompts.contactChoice;\nexport const getSelectedFielderOption = (state: AppState) => state.prompts.fielderChoice;\nexport const getSelectedOutOnPlayOptions = (state: AppState) => state.prompts.outOnPlayChoices;\n\nexport const getSelectedSacFlyRunsScored = (state: AppState) =>\n  state.prompts.sacFlyRunsScoredChoice;\n\nexport const getAllRunnerChoices = (state: AppState) => state.prompts.runnerChoices;\n\nexport const getPlateAppearanceResult = (\n  state: AppState,\n  type: PlateAppearanceType\n): PlateAppearanceResult => ({\n  kind: 'plateAppearance',\n  type,\n  contactType: getSelectedContactOption(state)?.contactType,\n  fieldedBy: getSelectedFielderOption(state)?.position,\n  runnersOutOnPlay: getSelectedOutOnPlayOptions(state),\n  runsScoredOnSacFly: getSelectedSacFlyRunsScored(state),\n  ...getExtraRunnerMovementForPlateAppearance(getAllRunnerChoices(state)),\n});\n\nexport const getPlateAppearancePreview = (state: AppState, type: PlateAppearanceType) => {\n  const event = getPlateAppearanceResult(state, type);\n  const { gameHistory, runners, outs } = createNextState(getPresent(state), state =>\n    applyGameEvent(state, event)\n  );\n  const { runnersScored } = _.last(gameHistory)!;\n  return { runners, runnersScored, outs };\n};\n","import React, { FC, useContext } from 'react';\nimport { Box, Text } from 'grommet';\n\nimport BasesPreview from 'components/BasesPreview';\n\nimport { getPlateAppearancePreview } from 'state/prompts/selectors';\nimport { useAppSelector } from 'utils/hooks';\nimport { promptContext } from './EventDetailPrompt';\n\nconst PlateAppearancePreview: FC = () => {\n  const paType = useContext(promptContext);\n\n  const {\n    runners,\n    runnersScored: { length: runs },\n    outs,\n  } = useAppSelector(state => getPlateAppearancePreview(state, paType));\n\n  return (\n    <Box direction=\"row\" align=\"center\" alignSelf=\"center\" gap=\"medium\">\n      <Text weight=\"bold\">Preview</Text>\n      <Box\n        round\n        direction=\"row\"\n        align=\"center\"\n        gap=\"small\"\n        border={!!runs}\n        pad={runs ? 'xsmall' : undefined}\n      >\n        <Box round direction=\"row\" align=\"center\" gap=\"small\" background=\"brand\" pad=\"small\">\n          <BasesPreview bases={runners} />\n          <Text>{outs === 3 ? 'Inning over' : `${outs} out${outs !== 1 ? 's' : ''}`}</Text>\n        </Box>\n        {!!runs && (\n          <Text>\n            {runs} {runs > 1 ? 'runs score' : 'run scores'}.\n          </Text>\n        )}\n      </Box>\n    </Box>\n  );\n};\n\nexport default PlateAppearancePreview;\n","import React, { ReactNode, useCallback } from 'react';\nimport { Box, BoxProps, Text } from 'grommet';\nimport _ from 'lodash';\n\ninterface BaseProps<T> {\n  options: (T | { value: T; label: ReactNode; negative?: boolean })[];\n}\n\ninterface SingleChoiceProps<T> extends BaseProps<T> {\n  multiple?: false;\n  value?: T;\n  onChange: (value: T) => void;\n}\n\ninterface MultipleChoiceProps<T> extends BaseProps<T> {\n  multiple: true;\n  value: T[];\n  onChange: (value: T[]) => void;\n}\n\ntype Props<T> = SingleChoiceProps<T> | MultipleChoiceProps<T>;\n\nconst OptionSelector = <T extends any>({\n  options,\n  multiple,\n  value,\n  onChange,\n  ...props\n}: Props<T> & BoxProps) => {\n  const isSelected = useCallback(\n    (val: T) => (multiple ? (value as T[]).includes(val) : val === value),\n    [multiple, value]\n  );\n\n  const handleClickOption = useCallback(\n    (clickedVal: T) => () => {\n      if (multiple && _.isArray(value)) {\n        (onChange as MultipleChoiceProps<T>['onChange'])(\n          value.includes(clickedVal)\n            ? value.filter(val => val !== clickedVal)\n            : value.concat(clickedVal)\n        );\n      } else {\n        (onChange as SingleChoiceProps<T>['onChange'])(clickedVal);\n      }\n    },\n    [multiple, value, onChange]\n  );\n\n  return (\n    <Box direction=\"row\" round border overflow=\"hidden\" {...props}>\n      {options.map((option, index) => {\n        let label, value, negative;\n        if (_.isObject(option) && 'label' in option) {\n          label = option.label;\n          value = option.value;\n          negative = option.negative;\n        } else {\n          label = value = option;\n          negative = false;\n        }\n        const selected = isSelected(value);\n\n        return (\n          <Box\n            key={`${index}_of_${options.length}`}\n            flex\n            width={typeof label === 'string' && label.length < 4 ? 'xxsmall' : 'xsmall'}\n            onClick={handleClickOption(value)}\n            background={selected ? 'brand' : negative ? 'status-critical-light' : undefined}\n            hoverIndicator={!selected}\n            pad=\"small\"\n            align=\"center\"\n            justify=\"center\"\n            border={index > 0 ? { side: 'left', size: '1px' } : undefined}\n          >\n            <Text textAlign=\"center\">{label as ReactNode}</Text>\n          </Box>\n        );\n      })}\n    </Box>\n  );\n};\n\nexport default OptionSelector;\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\n\nimport { BasepathOutcome, FielderOption, ContactOption } from './types';\n\ninterface PromptState {\n  runnerChoices: Record<string, BasepathOutcome>;\n  contactChoice?: ContactOption;\n  fielderChoice?: FielderOption;\n  outOnPlayChoices: string[];\n  sacFlyRunsScoredChoice: number;\n}\n\nconst initialState: PromptState = {\n  runnerChoices: {},\n  outOnPlayChoices: [],\n  sacFlyRunsScoredChoice: 1,\n};\n\nconst { reducer, actions: promptActions } = createSlice({\n  name: 'prompt',\n  initialState,\n  reducers: {\n    setRunnerChoice(\n      state,\n      { payload }: PayloadAction<{ runnerId: string; option: BasepathOutcome }>\n    ) {\n      state.runnerChoices[payload.runnerId] = payload.option;\n    },\n    clearRunnerChoice(state, { payload }: PayloadAction<string>) {\n      delete state.runnerChoices[payload];\n    },\n    setContactChoice(state, { payload }: PayloadAction<ContactOption>) {\n      state.contactChoice = payload;\n    },\n    clearContactChoice(state) {\n      delete state.contactChoice;\n    },\n    setFielderChoice(state, { payload }: PayloadAction<FielderOption>) {\n      state.fielderChoice = payload;\n    },\n    clearFielderChoice(state) {\n      delete state.fielderChoice;\n    },\n    setOutOnPlayChoices(state, { payload }: PayloadAction<string[]>) {\n      state.outOnPlayChoices = payload;\n    },\n    clearOutOnPlayChoices(state) {\n      state.outOnPlayChoices = [];\n    },\n    setSacFlyRunsScoredChoice(state, { payload }: PayloadAction<number>) {\n      state.sacFlyRunsScoredChoice = payload;\n    },\n    resetSacFlyRunsScoredChoice(state) {\n      state.sacFlyRunsScoredChoice = 1;\n    },\n    clearPrompt: () => initialState,\n  },\n});\n\nexport default reducer;\nexport { promptActions };\n","import React, { FC, useMemo, useCallback, useEffect } from 'react';\n\nimport OptionSelector from '../OptionSelector';\n\nimport { getSelectedContactOption } from 'state/prompts/selectors';\nimport { promptActions } from 'state/prompts/slice';\nimport { useAppSelector, useAppDispatch } from 'utils/hooks';\n\nimport { ContactOptions } from 'state/prompts/types';\n\nconst ContactPrompt: FC<ContactOptions> = ({ options, required }) => {\n  const dispatch = useAppDispatch();\n\n  useEffect(\n    () => () => {\n      dispatch(promptActions.clearContactChoice());\n    },\n    [dispatch]\n  );\n\n  const selectedOption = useAppSelector(getSelectedContactOption);\n\n  const formattedOptions = useMemo(() => options.map(({ label, id }) => ({ label, value: id })), [\n    options,\n  ]);\n\n  const handleChange = useCallback(\n    (value: number) => {\n      dispatch(promptActions.setContactChoice(options[value]));\n    },\n    [dispatch, options]\n  );\n\n  return (\n    <OptionSelector options={formattedOptions} value={selectedOption?.id} onChange={handleChange} />\n  );\n};\n\nexport default ContactPrompt;\n","import React, { FC, useMemo, useCallback, useEffect } from 'react';\nimport { Box, Heading } from 'grommet';\n\nimport OptionSelector from '../OptionSelector';\n\nimport { FielderOptions } from 'state/prompts/types';\nimport { getSelectedFielderOption } from 'state/prompts/selectors';\nimport { promptActions } from 'state/prompts/slice';\nimport { useAppSelector, useAppDispatch } from 'utils/hooks';\n\nconst FielderPrompt: FC<FielderOptions & { showTitle?: boolean }> = ({\n  options,\n  showTitle = true,\n}) => {\n  const dispatch = useAppDispatch();\n\n  useEffect(\n    () => () => {\n      dispatch(promptActions.clearFielderChoice());\n    },\n    [dispatch]\n  );\n\n  const selectedOption = useAppSelector(getSelectedFielderOption);\n\n  const formattedOptions = useMemo(() => options.map(({ label, id }) => ({ label, value: id })), [\n    options,\n  ]);\n\n  const handleChange = useCallback(\n    (value: number) => dispatch(promptActions.setFielderChoice(options[value])),\n    [dispatch, options]\n  );\n\n  return (\n    <Box flex>\n      {showTitle && (\n        <Heading level={4} margin={{ top: 'none', bottom: 'xsmall' }} alignSelf=\"center\">\n          Hit to\n        </Heading>\n      )}\n      <OptionSelector\n        options={formattedOptions}\n        value={selectedOption?.id}\n        onChange={handleChange}\n      />\n    </Box>\n  );\n};\n\nexport default FielderPrompt;\n","import React, { FC } from 'react';\nimport { Box } from 'grommet';\n\nimport ContactPrompt from '../subprompts/ContactPrompt';\nimport FielderPrompt from '../subprompts/FielderPrompt';\nimport { PromptAccordionPanel } from '../PromptAccordion';\n\nimport { ContactOptions, FielderOptions } from 'state/prompts/types';\n\ninterface Props {\n  contactOptions: ContactOptions;\n  fielderOptions?: FielderOptions;\n}\n\nconst ContactPanel: FC<Props> = ({ contactOptions, fielderOptions }) => (\n  <PromptAccordionPanel label=\"Contact\" preview=\"\">\n    <Box gap=\"small\">\n      <ContactPrompt {...contactOptions} />\n      {fielderOptions && <FielderPrompt {...fielderOptions} showTitle={false} />}\n    </Box>\n  </PromptAccordionPanel>\n);\n\nexport default ContactPanel;\n","import React, { FC, useMemo, useCallback, useEffect } from 'react';\nimport { Box, Text } from 'grommet';\nimport { useDispatch } from 'react-redux';\n\nimport OptionSelector from '../OptionSelector';\n\nimport { getShortPlayerName } from 'state/players/selectors';\nimport { getSelectedRunnerOption } from 'state/prompts/selectors';\nimport { promptActions } from 'state/prompts/slice';\nimport { useAppSelector } from 'utils/hooks';\nimport { getRunnerOptionLabel } from 'utils/labels';\n\nimport { RunnerOptions } from 'state/prompts/types';\n\nconst RunnerPrompt: FC<RunnerOptions> = ({\n  runnerId,\n  options,\n  defaultOption,\n  getTrailingRunnerOptions,\n}) => {\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    dispatch(promptActions.setRunnerChoice({ runnerId, option: options[defaultOption] }));\n    return () => {\n      dispatch(promptActions.clearRunnerChoice(runnerId));\n    };\n  }, [dispatch, runnerId, options, defaultOption]);\n\n  const selectedOption = useAppSelector(state => getSelectedRunnerOption(state, runnerId));\n  const runnerName = useAppSelector(state => getShortPlayerName(state, runnerId));\n\n  const formattedOptions = useMemo(\n    () =>\n      options.map(option => ({\n        label: getRunnerOptionLabel(option),\n        value: option.id,\n        negative: option.attemptedAdvance && !option.successfulAdvance,\n      })),\n    [options]\n  );\n\n  const trailingRunnerOptions = useMemo(\n    () => selectedOption && getTrailingRunnerOptions?.(selectedOption),\n    [selectedOption, getTrailingRunnerOptions]\n  );\n\n  const handleChange = useCallback(\n    (value: number) =>\n      dispatch(promptActions.setRunnerChoice({ runnerId, option: options[value] })),\n    [dispatch, runnerId, options]\n  );\n\n  return (\n    <Box gap=\"small\">\n      <Box direction=\"row\" gap=\"small\">\n        <Text alignSelf=\"center\" style={{ whiteSpace: 'nowrap' }}>\n          {runnerName}\n        </Text>\n        <OptionSelector\n          flex\n          options={formattedOptions}\n          value={selectedOption?.id}\n          onChange={handleChange}\n        />\n      </Box>\n      {trailingRunnerOptions && <RunnerPrompt {...trailingRunnerOptions} />}\n    </Box>\n  );\n};\n\nexport default RunnerPrompt;\n","import React, { FC, useMemo, useEffect } from 'react';\n\nimport PromptAccordion, { PromptAccordionPanel } from './PromptAccordion';\nimport PlateAppearancePreview from './PlateAppearancePreview';\nimport ContactPanel from './panels/ContactPanel';\nimport RunnerPrompt from './subprompts/RunnerPrompt';\n\nimport { getSelectedContactOption } from 'state/prompts/selectors';\nimport { useAppSelector } from 'utils/hooks';\n\nimport { HitOptions, BasePromptProps } from 'state/prompts/types';\nimport { Box } from 'grommet';\n\nconst HitPrompt: FC<HitOptions & BasePromptProps> = ({\n  contactOptions,\n  runnerOptions,\n  getNextOptions,\n  setCanSubmit,\n}) => {\n  useEffect(() => setCanSubmit(true), [setCanSubmit]);\n\n  const selectedContactType = useAppSelector(getSelectedContactOption);\n\n  const fielderOptions = useMemo(\n    () => selectedContactType && getNextOptions(selectedContactType.contactType),\n    [selectedContactType, getNextOptions]\n  );\n\n  return (\n    <Box gap=\"medium\">\n      <PromptAccordion>\n        <ContactPanel contactOptions={contactOptions} fielderOptions={fielderOptions} />\n        {runnerOptions && (\n          <PromptAccordionPanel label=\"Runners\" preview=\"\">\n            <RunnerPrompt {...runnerOptions} />\n          </PromptAccordionPanel>\n        )}\n      </PromptAccordion>\n      <PlateAppearancePreview />\n    </Box>\n  );\n};\n\nexport default HitPrompt;\n","import React, { FC, useMemo, useEffect } from 'react';\nimport { Box } from 'grommet';\n\nimport PromptAccordion, { PromptAccordionPanel } from './PromptAccordion';\nimport PlateAppearancePreview from './PlateAppearancePreview';\nimport RunnerPrompt from './subprompts/RunnerPrompt';\nimport ContactPanel from './panels/ContactPanel';\n\nimport { useAppSelector } from 'utils/hooks';\nimport { getSelectedContactOption } from 'state/prompts/selectors';\n\nimport { OutOptions, BasePromptProps } from 'state/prompts/types';\n\nconst OutPrompt: FC<OutOptions & BasePromptProps> = ({\n  contactOptions,\n  getNextOptions,\n  setCanSubmit,\n}) => {\n  const selectedContactType = useAppSelector(getSelectedContactOption);\n\n  useEffect(() => setCanSubmit(!!selectedContactType), [selectedContactType, setCanSubmit]);\n\n  const { fielderOptions, runnerOptions } = useMemo(\n    () => (selectedContactType && getNextOptions(selectedContactType.contactType)) ?? {},\n    [selectedContactType, getNextOptions]\n  );\n\n  return (\n    <Box gap=\"medium\">\n      <PromptAccordion>\n        <ContactPanel contactOptions={contactOptions} fielderOptions={fielderOptions} />\n        {runnerOptions && (\n          <PromptAccordionPanel label=\"Runners\" preview=\"\">\n            <RunnerPrompt {...runnerOptions} />\n          </PromptAccordionPanel>\n        )}\n      </PromptAccordion>\n      {!!selectedContactType && <PlateAppearancePreview />}\n    </Box>\n  );\n};\n\nexport default OutPrompt;\n","import React, { FC, useMemo, useCallback, useEffect } from 'react';\nimport { Box, Heading } from 'grommet';\n\nimport FielderPrompt from './subprompts/FielderPrompt';\nimport OptionSelector from './OptionSelector';\nimport RunnerPrompt from './subprompts/RunnerPrompt';\n\nimport { getSelectedSacFlyRunsScored } from 'state/prompts/selectors';\nimport { promptActions } from 'state/prompts/slice';\nimport { useAppSelector, useAppDispatch } from 'utils/hooks';\n\nimport { SacrificeFlyOptions, BasePromptProps } from 'state/prompts/types';\nimport PlateAppearancePreview from './PlateAppearancePreview';\n\nconst SacrificeFlyPrompt: FC<SacrificeFlyOptions & BasePromptProps> = ({\n  fielderOptions,\n  runnersScoredOptions,\n  getNextOptions,\n  setCanSubmit,\n}) => {\n  const dispatch = useAppDispatch();\n\n  const selectedRunsScored = useAppSelector(getSelectedSacFlyRunsScored);\n\n  useEffect(() => setCanSubmit(true), [setCanSubmit]);\n\n  const runnerOptions = useMemo(() => getNextOptions?.(selectedRunsScored), [\n    getNextOptions,\n    selectedRunsScored,\n  ]);\n\n  const handleChangeRunsScored = useCallback(\n    (value: number) => {\n      dispatch(promptActions.setSacFlyRunsScoredChoice(value));\n    },\n    [dispatch]\n  );\n\n  return (\n    <Box gap=\"medium\" margin={{ top: 'medium' }}>\n      <Box direction=\"row\" gap=\"small\">\n        {runnersScoredOptions && (\n          <Box gap=\"xsmall\" flex>\n            <Heading level={4} margin=\"none\" alignSelf=\"center\">\n              Runs batted in\n            </Heading>\n            <OptionSelector\n              options={runnersScoredOptions}\n              value={selectedRunsScored}\n              onChange={handleChangeRunsScored}\n            />\n          </Box>\n        )}\n        {fielderOptions && <FielderPrompt {...fielderOptions} />}\n      </Box>\n      {runnerOptions && <RunnerPrompt {...runnerOptions} />}\n      <PlateAppearancePreview />\n    </Box>\n  );\n};\n\nexport default SacrificeFlyPrompt;\n","import React, { FC, useCallback, useEffect } from 'react';\nimport { Box, Heading } from 'grommet';\nimport _ from 'lodash';\n\nimport OptionSelector from '../OptionSelector';\n\nimport { getSelectedOutOnPlayOptions } from 'state/prompts/selectors';\nimport { promptActions } from 'state/prompts/slice';\nimport { getPlayerOptionsForSelector } from 'state/players/selectors';\nimport { useAppSelector, useAppDispatch } from 'utils/hooks';\n\nimport { OutOnPlayOptions } from 'state/prompts/types';\n\nexport const shouldShowOOPPrompt = ({ multiple, runnerIds }: OutOnPlayOptions) =>\n  multiple ? runnerIds.length > 2 : runnerIds.length > 1;\n\nconst OutOnPlayPrompt: FC<OutOnPlayOptions & { showTitle?: boolean }> = ({\n  showTitle = true,\n  ...options\n}) => {\n  const { multiple, runnerIds } = options;\n\n  const dispatch = useAppDispatch();\n\n  const dontShow = !shouldShowOOPPrompt(options);\n\n  useEffect(() => {\n    if (dontShow) {\n      if (multiple) {\n        dispatch(promptActions.setOutOnPlayChoices(runnerIds));\n      } else {\n        dispatch(promptActions.setOutOnPlayChoices([runnerIds[0]]));\n      }\n    }\n  }, [multiple, dontShow, runnerIds, dispatch]);\n\n  const selectedOptions = useAppSelector(getSelectedOutOnPlayOptions);\n\n  const handleChangeSingle = useCallback(\n    (value: string) => {\n      dispatch(promptActions.setOutOnPlayChoices([value]));\n    },\n    [dispatch]\n  );\n\n  const handleChangeMultiple = useCallback(\n    (value: string[]) => {\n      dispatch(promptActions.setOutOnPlayChoices(value.length > 2 ? _.slice(value, 1) : value));\n    },\n    [dispatch]\n  );\n\n  const runnerOptions = useAppSelector(state => getPlayerOptionsForSelector(state, runnerIds));\n\n  if (dontShow) return null;\n\n  let selector;\n  if (multiple) {\n    selector = (\n      <OptionSelector<string>\n        multiple\n        options={runnerOptions}\n        value={selectedOptions}\n        onChange={handleChangeMultiple}\n      />\n    );\n  } else {\n    selector = (\n      <OptionSelector\n        options={runnerOptions}\n        value={selectedOptions[0]}\n        onChange={handleChangeSingle}\n      />\n    );\n  }\n  return (\n    <Box>\n      {showTitle && (\n        <Heading level={4} margin={{ top: 'none', bottom: 'xsmall' }} alignSelf=\"center\">\n          {multiple ? 'Runners' : 'Runner'} out on play\n        </Heading>\n      )}\n      {selector}\n    </Box>\n  );\n};\n\nexport default OutOnPlayPrompt;\n","import React, { FC, useMemo, useEffect } from 'react';\nimport { Box } from 'grommet';\n\nimport PlateAppearancePreview from './PlateAppearancePreview';\nimport FielderPrompt from './subprompts/FielderPrompt';\nimport RunnerPrompt from './subprompts/RunnerPrompt';\nimport OutOnPlayPrompt from './subprompts/OutOnPlayPrompt';\n\nimport { getSelectedOutOnPlayOptions } from 'state/prompts/selectors';\nimport { useAppSelector } from 'utils/hooks';\n\nimport { FieldersChoiceOptions, BasePromptProps } from 'state/prompts/types';\n\nconst FieldersChoicePrompt: FC<FieldersChoiceOptions & BasePromptProps> = ({\n  fielderOptions,\n  outOnPlayOptions,\n  getNextOptions,\n  setCanSubmit,\n}) => {\n  const [selectedOutOnPlay] = useAppSelector(getSelectedOutOnPlayOptions);\n\n  const canSubmit = outOnPlayOptions.runnerIds.length > 1 ? !!selectedOutOnPlay : true;\n\n  useEffect(() => setCanSubmit(canSubmit), [canSubmit, setCanSubmit]);\n\n  const runnerOptions = useMemo(() => selectedOutOnPlay && getNextOptions?.(selectedOutOnPlay), [\n    getNextOptions,\n    selectedOutOnPlay,\n  ]);\n\n  return (\n    <Box gap=\"medium\" margin={{ top: 'small' }}>\n      <Box direction=\"row\" gap=\"small\" align=\"center\">\n        <FielderPrompt {...fielderOptions} />\n        <OutOnPlayPrompt {...outOnPlayOptions} />\n      </Box>\n      {runnerOptions && <RunnerPrompt {...runnerOptions} />}\n      {canSubmit && <PlateAppearancePreview />}\n    </Box>\n  );\n};\n\nexport default FieldersChoicePrompt;\n","import React, { FC, useMemo, useEffect } from 'react';\nimport { Box } from 'grommet';\n\nimport PromptAccordion, { PromptAccordionPanel } from './PromptAccordion';\nimport PlateAppearancePreview from './PlateAppearancePreview';\nimport ContactPanel from './panels/ContactPanel';\nimport RunnerPrompt from './subprompts/RunnerPrompt';\nimport OutOnPlayPrompt, { shouldShowOOPPrompt } from './subprompts/OutOnPlayPrompt';\n\nimport { getSelectedOutOnPlayOptions, getSelectedContactOption } from 'state/prompts/selectors';\nimport { useAppSelector } from 'utils/hooks';\n\nimport { DoublePlayOptions, BasePromptProps } from 'state/prompts/types';\n\nconst DoublePlayPrompt: FC<DoublePlayOptions & BasePromptProps> = ({\n  contactOptions,\n  getNextOptions,\n  setCanSubmit,\n}) => {\n  const selectedContactType = useAppSelector(getSelectedContactOption);\n  const selectedOutsOnPlay = useAppSelector(getSelectedOutOnPlayOptions);\n\n  const nextOptions = useMemo(\n    () => selectedContactType && getNextOptions(selectedContactType.contactType),\n    [getNextOptions, selectedContactType]\n  );\n\n  const outsOnPlayFulfilled =\n    !!nextOptions &&\n    (!nextOptions.outOnPlayOptions ||\n      selectedOutsOnPlay.length === (nextOptions.outOnPlayOptions.multiple ? 2 : 1));\n  const canSubmit = !!selectedContactType && outsOnPlayFulfilled;\n\n  useEffect(() => setCanSubmit(canSubmit), [canSubmit, setCanSubmit]);\n\n  const runnerOptions = useMemo(\n    () =>\n      nextOptions &&\n      !!selectedOutsOnPlay.length &&\n      nextOptions.getNextOptions?.(selectedOutsOnPlay),\n    [nextOptions, selectedOutsOnPlay]\n  );\n\n  return (\n    <Box gap=\"medium\">\n      <PromptAccordion>\n        <ContactPanel\n          contactOptions={contactOptions}\n          fielderOptions={nextOptions?.fielderOptions}\n        />\n        {nextOptions?.outOnPlayOptions &&\n          (shouldShowOOPPrompt(nextOptions.outOnPlayOptions) ? (\n            <PromptAccordionPanel\n              label={`Runner${nextOptions.outOnPlayOptions.multiple ? 's' : ''} out on play`}\n              preview=\"\"\n            >\n              <OutOnPlayPrompt {...nextOptions.outOnPlayOptions} showTitle={false} />\n            </PromptAccordionPanel>\n          ) : (\n            <OutOnPlayPrompt {...nextOptions.outOnPlayOptions} />\n          ))}\n        {runnerOptions && (\n          <PromptAccordionPanel label=\"Runners\" preview=\"\">\n            <RunnerPrompt {...runnerOptions} />\n          </PromptAccordionPanel>\n        )}\n      </PromptAccordion>\n      {canSubmit && <PlateAppearancePreview />}\n    </Box>\n  );\n};\n\nexport default DoublePlayPrompt;\n","import React, { FC, useMemo, useEffect, ReactNode, useState, createContext } from 'react';\nimport { Layer, Box, Button, Heading } from 'grommet';\n\nimport HitPrompt from './HitPrompt';\nimport OutPrompt from './OutPrompt';\nimport SacrificeFlyPrompt from './SacrificeFlyPrompt';\nimport FieldersChoicePrompt from './FieldersChoicePrompt';\nimport DoublePlayPrompt from './DoublePlayPrompt';\n\nimport { createPlateAppearancePromptSelector, getBatterName } from 'state/game/selectors';\nimport { promptActions } from 'state/prompts/slice';\nimport { useAppSelector, useAppDispatch } from 'utils/hooks';\nimport { getPlateAppearanceLabel } from 'utils/labels';\n\nimport { PlateAppearanceType } from 'state/game/types';\n\ninterface Props {\n  paType: PlateAppearanceType;\n  onSubmit: () => void;\n  onCancel: () => void;\n}\n\nexport const promptContext = createContext(PlateAppearanceType.OUT);\n\nconst EventDetailPrompt: FC<Props> = ({ paType, onSubmit, onCancel }) => {\n  const dispatch = useAppDispatch();\n\n  const [canSubmit, setCanSubmit] = useState(false);\n\n  const promptSelector = useMemo(() => createPlateAppearancePromptSelector(paType), [paType]);\n  const prompt = useAppSelector(promptSelector);\n  const batter = useAppSelector(getBatterName);\n\n  useEffect(() => () => void dispatch(promptActions.clearPrompt()), [dispatch]);\n\n  useEffect(() => {\n    if (!prompt) {\n      onSubmit();\n    }\n  }, [prompt, onSubmit]);\n\n  if (!prompt) return null;\n\n  let promptView: ReactNode;\n  switch (prompt.kind) {\n    case 'hit':\n      promptView = <HitPrompt {...prompt} setCanSubmit={setCanSubmit} />;\n      break;\n    case 'out':\n      promptView = <OutPrompt {...prompt} setCanSubmit={setCanSubmit} />;\n      break;\n    case 'sacrificeFly':\n      promptView = <SacrificeFlyPrompt {...prompt} setCanSubmit={setCanSubmit} />;\n      break;\n    case 'fieldersChoice':\n      promptView = <FieldersChoicePrompt {...prompt} setCanSubmit={setCanSubmit} />;\n      break;\n    case 'doublePlay':\n      promptView = <DoublePlayPrompt {...prompt} setCanSubmit={setCanSubmit} />;\n      break;\n  }\n\n  return (\n    <Layer>\n      <Box pad=\"medium\">\n        <Heading level={3} margin=\"none\" alignSelf=\"center\">\n          {getPlateAppearanceLabel(paType)} by {batter}\n        </Heading>\n        <promptContext.Provider value={paType}>{promptView}</promptContext.Provider>\n        <Box direction=\"row\" margin={{ top: 'medium' }} justify=\"between\" gap=\"small\">\n          <Button color=\"status-critical\" label=\"Cancel\" onClick={onCancel} />\n          {canSubmit && (\n            <Button\n              color=\"status-ok\"\n              label={`Record ${getPlateAppearanceLabel(paType)}`}\n              onClick={onSubmit}\n            />\n          )}\n        </Box>\n      </Box>\n    </Layer>\n  );\n};\n\nexport default EventDetailPrompt;\n","import React, { useCallback, useState } from 'react';\nimport { Box, Button } from 'grommet';\n\nimport EventDetailPrompt from './prompts/EventDetailPrompt';\n\nimport { getPlateAppearanceOptions } from 'state/game/selectors';\nimport { gameActions } from 'state/game/slice';\nimport { getPlateAppearanceResult } from 'state/prompts/selectors';\nimport { useAppDispatch, useAppSelector } from 'utils/hooks';\nimport { getPlateAppearanceLabel } from 'utils/labels';\n\nimport { PlateAppearanceType } from 'state/game/types';\n\nconst buttonGroups = [\n  {\n    color: 'neutral-4',\n    types: [\n      PlateAppearanceType.OUT,\n      PlateAppearanceType.FIELDERS_CHOICE,\n      PlateAppearanceType.DOUBLE_PLAY,\n    ],\n  },\n  {\n    color: 'neutral-3',\n    types: [\n      PlateAppearanceType.SINGLE,\n      PlateAppearanceType.DOUBLE,\n      PlateAppearanceType.TRIPLE,\n      PlateAppearanceType.HOMERUN,\n    ],\n  },\n  {\n    color: 'neutral-1',\n    types: [PlateAppearanceType.WALK, PlateAppearanceType.SACRIFICE_FLY],\n  },\n];\n\nconst EventReporter = () => {\n  const dispatch = useAppDispatch();\n\n  const options = useAppSelector(getPlateAppearanceOptions);\n\n  const [pendingPlateAppearance, setPendingPlateAppearance] = useState<PlateAppearanceType>();\n\n  const handleSubmitPlateAppearance = useCallback(() => {\n    if (pendingPlateAppearance) {\n      dispatch((dispatch, getState) => {\n        dispatch(\n          gameActions.recordGameEvent(getPlateAppearanceResult(getState(), pendingPlateAppearance))\n        );\n      });\n    }\n    setPendingPlateAppearance(undefined);\n  }, [dispatch, pendingPlateAppearance, setPendingPlateAppearance]);\n\n  const handleCancelPrompt = useCallback(() => {\n    setPendingPlateAppearance(undefined);\n  }, [setPendingPlateAppearance]);\n\n  return (\n    <Box gridArea=\"reporter\" align=\"center\" justify=\"center\">\n      {buttonGroups.map(({ color, types }) => (\n        <Box direction=\"row\" align=\"center\" justify=\"center\" alignContent=\"center\" wrap>\n          {types\n            .filter(paType => options.includes(paType))\n            .map(paType => (\n              <Button\n                key={paType}\n                color={color}\n                label={getPlateAppearanceLabel(paType)}\n                onClick={() => setPendingPlateAppearance(paType)}\n                margin=\"small\"\n              />\n            ))}\n        </Box>\n      ))}\n      {pendingPlateAppearance && (\n        <EventDetailPrompt\n          paType={pendingPlateAppearance}\n          onSubmit={handleSubmitPlateAppearance}\n          onCancel={handleCancelPrompt}\n        />\n      )}\n    </Box>\n  );\n};\n\nexport default EventReporter;\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"defs\", null, /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M24 45.21L2.79 24L24 2.79L45.21 24L24 45.21Z\",\n  id: \"b1pwy3kSYG\"\n}), /*#__PURE__*/React.createElement(\"clipPath\", {\n  id: \"clipa1ontZhQmS\"\n}, /*#__PURE__*/React.createElement(\"use\", {\n  xlinkHref: \"#b1pwy3kSYG\",\n  opacity: 1\n})));\n\nvar _ref3 = /*#__PURE__*/React.createElement(\"g\", null, /*#__PURE__*/React.createElement(\"g\", null, /*#__PURE__*/React.createElement(\"g\", null, /*#__PURE__*/React.createElement(\"use\", {\n  xlinkHref: \"#b1pwy3kSYG\",\n  opacity: 1,\n  fill: \"#d4ee91\",\n  fillOpacity: 0\n}), /*#__PURE__*/React.createElement(\"g\", {\n  clipPath: \"url(#clipa1ontZhQmS)\"\n}, /*#__PURE__*/React.createElement(\"use\", {\n  xlinkHref: \"#b1pwy3kSYG\",\n  opacity: 1,\n  fillOpacity: 0,\n  stroke: \"#000000\",\n  strokeWidth: 2,\n  strokeOpacity: 1\n})))));\n\nfunction SvgBase(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, [\"title\", \"titleId\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    preserveAspectRatio: \"xMidYMid meet\",\n    viewBox: \"0 0 48 48\",\n    width: 24,\n    height: 24,\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _ref2, _ref3);\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgBase);\nexport default __webpack_public_path__ + \"static/media/base.354fa048.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"defs\", null, /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M7 24L24 41L41 24L41 7L7 7L7 24Z\",\n  id: \"a3jEO7oPWR\"\n}), /*#__PURE__*/React.createElement(\"clipPath\", {\n  id: \"clipb1aIxcMs8Z\"\n}, /*#__PURE__*/React.createElement(\"use\", {\n  xlinkHref: \"#a3jEO7oPWR\",\n  opacity: 1\n})));\n\nvar _ref3 = /*#__PURE__*/React.createElement(\"g\", null, /*#__PURE__*/React.createElement(\"g\", null, /*#__PURE__*/React.createElement(\"g\", null, /*#__PURE__*/React.createElement(\"g\", {\n  clipPath: \"url(#clipb1aIxcMs8Z)\"\n}, /*#__PURE__*/React.createElement(\"use\", {\n  xlinkHref: \"#a3jEO7oPWR\",\n  opacity: 1,\n  fillOpacity: 0,\n  stroke: \"#000000\",\n  strokeWidth: 2,\n  strokeOpacity: 1\n})))));\n\nfunction SvgHome(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, [\"title\", \"titleId\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    preserveAspectRatio: \"xMidYMid meet\",\n    viewBox: \"0 0 48 48\",\n    width: 24,\n    height: 24,\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _ref2, _ref3);\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgHome);\nexport default __webpack_public_path__ + \"static/media/home.ece0d570.svg\";\nexport { ForwardRef as ReactComponent };","import React, { useCallback } from 'react';\nimport { Grid, Box, Text, Button } from 'grommet';\nimport { Blank, Redo, Undo } from 'grommet-icons';\nimport { Redirect } from 'react-router-dom';\nimport { ActionCreators } from 'redux-undo';\n\nimport EventReporter from './EventReporter';\n\nimport {\n  getRunnerNames,\n  getBatterName,\n  getOnDeckBatterName,\n  getInTheHoleBatterName,\n  isGameInProgress,\n  isUndoPossible,\n  isRedoPossible,\n} from 'state/game/selectors';\nimport { useAppDispatch, useAppSelector } from 'utils/hooks';\n\nimport { BaseType } from 'state/game/types';\n\nimport { ReactComponent as BaseIcon } from 'icons/base.svg';\nimport { ReactComponent as HomeIcon } from 'icons/home.svg';\n\nconst Base = ({ occupied }: { occupied?: boolean }) => (\n  <Blank size=\"large\" color={occupied ? 'brand' : undefined} fillOpacity={occupied ? 1 : undefined}>\n    <BaseIcon />\n  </Blank>\n);\nconst HomePlate = () => (\n  <Blank size=\"large\">\n    <HomeIcon />\n  </Blank>\n);\n\nconst Bases = () => {\n  const dispatch = useAppDispatch();\n\n  const gameInProgress = useAppSelector(isGameInProgress);\n  const {\n    [BaseType.FIRST]: firstBaseRunner,\n    [BaseType.SECOND]: secondBaseRunner,\n    [BaseType.THIRD]: thirdBaseRunner,\n  } = useAppSelector(getRunnerNames);\n  const batter = useAppSelector(getBatterName);\n  const onDeck = useAppSelector(getOnDeckBatterName);\n  const inTheHole = useAppSelector(getInTheHoleBatterName);\n  const undoPossible = useAppSelector(isUndoPossible);\n  const redoPossible = useAppSelector(isRedoPossible);\n\n  const undo = useCallback(() => {\n    dispatch(ActionCreators.undo());\n  }, [dispatch]);\n\n  const redo = useCallback(() => {\n    dispatch(ActionCreators.redo());\n  }, [dispatch]);\n\n  if (!gameInProgress) {\n    return <Redirect to=\"/teams\" />;\n  }\n\n  return (\n    <Box fill>\n      <Box flex>\n        <Grid\n          fill\n          rows={['xsmall', 'auto', 'xsmall']}\n          columns={['small', 'auto', 'small']}\n          areas={[\n            ['undo-redo', 'second-base', '.'],\n            ['third-base', 'reporter', 'first-base'],\n            ['.', 'home-plate', '.'],\n          ]}\n        >\n          <style scoped>{`\n          svg[fill-opacity=\"1\"] use {\n            fill-opacity: 1;\n          }\n        `}</style>\n          <Box gridArea=\"undo-redo\" direction=\"row\" margin=\"medium\" gap=\"small\">\n            <Button icon={<Undo />} disabled={!undoPossible} onClick={undo} />\n            <Button icon={<Redo />} disabled={!redoPossible} onClick={redo} />\n          </Box>\n          <Box gridArea=\"first-base\" direction=\"row\" justify=\"end\" align=\"center\">\n            <Text textAlign=\"center\">{firstBaseRunner}</Text>\n            <Base occupied={!!firstBaseRunner} />\n          </Box>\n          <Box gridArea=\"second-base\" align=\"center\">\n            <Base occupied={!!secondBaseRunner} />\n            <Text>{secondBaseRunner}</Text>\n          </Box>\n          <Box gridArea=\"third-base\" direction=\"row\" align=\"center\">\n            <Base occupied={!!thirdBaseRunner} />\n            <Text textAlign=\"center\">{thirdBaseRunner}</Text>\n          </Box>\n          <Box gridArea=\"home-plate\" justify=\"end\" align=\"center\">\n            <Text weight=\"bold\" size=\"xlarge\">\n              {batter}\n            </Text>\n            <HomePlate />\n          </Box>\n          <EventReporter />\n        </Grid>\n      </Box>\n      <Box border={{ side: 'top' }} direction=\"row\" justify=\"around\" pad=\"medium\">\n        <Box direction=\"row\" gap=\"small\">\n          <Text>On Deck</Text>\n          <Text weight=\"bold\">{onDeck}</Text>\n        </Box>\n        <Box direction=\"row\" gap=\"small\">\n          <Text>In the Hole</Text>\n          <Text weight=\"bold\">{inTheHole}</Text>\n        </Box>\n      </Box>\n    </Box>\n  );\n};\n\nexport default Bases;\n","import React, { useCallback, FC, useMemo } from 'react';\nimport { Box, Text, Button, Select, ThemeContext } from 'grommet';\nimport { Close } from 'grommet-icons';\nimport { Draggable } from 'react-beautiful-dnd';\n\nimport { getAvailablePositions, getPlayerPosition } from 'state/game/selectors';\nimport { gameActions } from 'state/game/slice';\nimport { getShortPlayerName } from 'state/players/selectors';\nimport { useAppSelector, useAppDispatch } from 'utils/hooks';\nimport { getPositionAbbreviation } from 'utils/labels';\n\nimport { FieldingPosition, TeamRole } from 'state/game/types';\n\ninterface Props {\n  team: TeamRole;\n  playerId: string;\n  index: number;\n}\n\nconst LineupPlayer: FC<Props> = ({ playerId, index, team }) => {\n  const dispatch = useAppDispatch();\n\n  const name = useAppSelector(state => getShortPlayerName(state, playerId));\n  const position = useAppSelector(state => getPlayerPosition(state, playerId));\n\n  const availablePositions = useAppSelector(state => getAvailablePositions(state, team));\n  const positionOptions = useMemo(\n    () =>\n      availablePositions.map(position => ({\n        position,\n        label: getPositionAbbreviation(position),\n      })),\n    [availablePositions]\n  );\n\n  const handleRemove = useCallback(() => {\n    dispatch(gameActions.removePlayerFromGame(playerId));\n  }, [playerId, dispatch]);\n\n  const handleChangePosition = useCallback(\n    ({ value }: { value: FieldingPosition }) => {\n      dispatch(gameActions.changePlayerPosition({ playerId, position: value }));\n    },\n    [dispatch, playerId]\n  );\n\n  return (\n    <Draggable draggableId={playerId} index={index}>\n      {({ innerRef, draggableProps, dragHandleProps }) => (\n        <Box\n          ref={innerRef}\n          {...draggableProps}\n          {...dragHandleProps}\n          direction=\"row\"\n          height=\"xxsmall\"\n          align=\"center\"\n          justify=\"between\"\n        >\n          <Text margin={{ right: 'auto' }}>{name}</Text>\n          <ThemeContext.Extend value={{ global: { size: { xsmall: '108px' } } }}>\n            <Box width=\"xsmall\" margin={{ right: 'small' }}>\n              <Select\n                value={position}\n                options={positionOptions}\n                labelKey=\"label\"\n                valueKey={{ key: 'position', reduce: true }}\n                onChange={handleChangePosition}\n              />\n            </Box>\n          </ThemeContext.Extend>\n          <Button\n            plain={false}\n            icon={<Close size=\"small\" color=\"status-critical\" />}\n            color=\"status-critical\"\n            onClick={handleRemove}\n          />\n        </Box>\n      )}\n    </Draggable>\n  );\n};\n\nexport default LineupPlayer;\n","import React, { useState, useMemo, useCallback, ChangeEvent } from 'react';\nimport { Box, Text, TextInput, TextInputProps, Heading } from 'grommet';\nimport _ from 'lodash';\nimport { Droppable } from 'react-beautiful-dnd';\n\nimport LineupPlayer from './LineupPlayer';\n\nimport { getLineup, getPlayersNotInGame } from 'state/game/selectors';\nimport { gameActions } from 'state/game/slice';\nimport { TeamRole } from 'state/game/types';\nimport { formatShortName } from 'state/players/utils';\nimport { useAppSelector, useAppDispatch } from 'utils/hooks';\n\nconst Lineup = ({ team }: { team: TeamRole }) => {\n  const dispatch = useAppDispatch();\n\n  const players = useAppSelector(state => getLineup(state, team));\n  const availablePlayers = useAppSelector(getPlayersNotInGame);\n\n  const [searchValue, setSearchValue] = useState('');\n\n  const suggestions = useMemo(() => {\n    if (!searchValue.length) return [];\n\n    return availablePlayers\n      .filter(({ firstName }) => firstName.toLowerCase().startsWith(searchValue.toLowerCase()))\n      .map(player => ({ value: player.playerId, label: formatShortName(player) }));\n  }, [availablePlayers, searchValue]);\n\n  const handleSearchChange = useCallback(\n    ({ currentTarget }: ChangeEvent<HTMLInputElement>) => setSearchValue(currentTarget.value),\n    [setSearchValue]\n  );\n\n  const handleSuggestionSelect: NonNullable<TextInputProps['onSelect']> = useCallback(\n    ({ suggestion }) => {\n      if (suggestion) {\n        dispatch(gameActions.addPlayerToGame({ team, playerId: suggestion.value }));\n        setSearchValue('');\n      }\n    },\n    [team, dispatch, setSearchValue]\n  );\n\n  return (\n    <Box flex>\n      <Heading level={4} textAlign=\"center\" margin={{ top: 'none' }}>\n        {team === TeamRole.AWAY ? 'Away Team' : 'Home Team'}\n      </Heading>\n      <TextInput\n        placeholder=\"Add Player\"\n        suggestions={suggestions}\n        value={searchValue}\n        onChange={handleSearchChange}\n        onSelect={handleSuggestionSelect}\n      />\n      <Box direction=\"row\" margin={{ top: 'small' }}>\n        <Box width=\"xxsmall\">\n          {_.range(1, 11).map(lineupSpot => (\n            <Box key={lineupSpot} height=\"xxsmall\" justify=\"center\">\n              <Text>{lineupSpot}</Text>\n            </Box>\n          ))}\n        </Box>\n        <Droppable droppableId={team === TeamRole.AWAY ? 'AWAY' : 'HOME'}>\n          {({ innerRef, droppableProps, placeholder }) => (\n            <Box ref={innerRef} {...droppableProps} flex>\n              {players.map((playerId, index) => (\n                <LineupPlayer key={playerId} playerId={playerId} index={index} team={team} />\n              ))}\n              {placeholder}\n            </Box>\n          )}\n        </Droppable>\n      </Box>\n    </Box>\n  );\n};\n\nexport default Lineup;\n","import React, { useCallback } from 'react';\nimport { Box } from 'grommet';\nimport { DragDropContext, DragDropContextProps } from 'react-beautiful-dnd';\n\nimport Lineup from './Lineup';\n\nimport { gameActions } from 'state/game/slice';\nimport { TeamRole } from 'state/game/types';\nimport { useAppDispatch } from 'utils/hooks';\n\nconst Teams = () => {\n  const dispatch = useAppDispatch();\n\n  const handleDragEnd: DragDropContextProps['onDragEnd'] = useCallback(\n    ({ source, destination }) => {\n      if (!destination) return;\n      dispatch(\n        gameActions.movePlayer({\n          fromTeam: TeamRole[source.droppableId as keyof typeof TeamRole],\n          toTeam: TeamRole[destination.droppableId as keyof typeof TeamRole],\n          startIndex: source.index,\n          endIndex: destination.index,\n        })\n      );\n    },\n    [dispatch]\n  );\n\n  return (\n    <DragDropContext onDragEnd={handleDragEnd}>\n      <Box\n        direction=\"row\"\n        justify=\"around\"\n        pad=\"medium\"\n        gap=\"medium\"\n        flex={{ shrink: 0 }}\n        basis=\"auto\"\n      >\n        <Lineup team={TeamRole.AWAY} />\n        <Lineup team={TeamRole.HOME} />\n      </Box>\n    </DragDropContext>\n  );\n};\n\nexport default Teams;\n","import _ from 'lodash';\n\nimport { RecordedPlay, PlateAppearanceType, ContactType } from 'state/game/types';\nimport { PlayerStats } from 'state/players/types';\n\nexport const initialStats: PlayerStats = {\n  atBats: 0,\n  hits: 0,\n  doubles: 0,\n  triples: 0,\n  homeRuns: 0,\n  walks: 0,\n  stolenBases: 0,\n  caughtStealing: 0,\n  runsBattedIn: 0,\n  runsScored: 0,\n  strikeouts: 0,\n  sacrificeFlies: 0,\n  groundIntoDoublePlays: 0,\n  leftOnBase: 0,\n};\n\nexport const aggregateStats = (plays: RecordedPlay[]) => {\n  const allStats: Record<string, PlayerStats> = {};\n  const updatePlayer = (playerId: string, callback: (stats: PlayerStats) => void) => {\n    if (!(playerId in allStats)) {\n      allStats[playerId] = { ...initialStats };\n    }\n    callback(allStats[playerId]);\n  };\n  plays.forEach(({ gameState, event, runnersScored, runnersBattedIn }) => {\n    runnersScored.forEach(runnerId => {\n      updatePlayer(runnerId, stats => void stats.runsScored++);\n    });\n    if (event.kind === 'stolenBaseAttempt') {\n      updatePlayer(event.runnerId, stats => {\n        if (event.success) {\n          stats.stolenBases++;\n        } else {\n          stats.caughtStealing++;\n        }\n      });\n    } else {\n      updatePlayer(gameState.atBat!, stats => {\n        stats.runsBattedIn += runnersBattedIn.length;\n\n        if (event.type === PlateAppearanceType.WALK) {\n          stats.walks++;\n        } else if (event.type === PlateAppearanceType.SACRIFICE_FLY) {\n          stats.sacrificeFlies++;\n        } else {\n          stats.atBats++;\n          switch (event.type) {\n            case PlateAppearanceType.SINGLE:\n              stats.hits++;\n              break;\n            case PlateAppearanceType.DOUBLE:\n              stats.hits++;\n              stats.doubles++;\n              break;\n            case PlateAppearanceType.TRIPLE:\n              stats.hits++;\n              stats.triples++;\n              break;\n            case PlateAppearanceType.HOMERUN:\n              stats.hits++;\n              stats.homeRuns++;\n              break;\n            case PlateAppearanceType.OUT:\n              if (event.contactType === ContactType.NONE) {\n                stats.strikeouts++;\n              }\n              stats.leftOnBase += _.size(gameState.runners);\n              break;\n            case PlateAppearanceType.DOUBLE_PLAY:\n              if (event.contactType === ContactType.GROUNDER) {\n                stats.groundIntoDoublePlays++;\n              }\n              stats.leftOnBase += _.size(gameState.runners) - 1;\n              break;\n            case PlateAppearanceType.FIELDERS_CHOICE:\n              stats.leftOnBase += _.size(gameState.runners);\n              break;\n          }\n        }\n      });\n    }\n  });\n  return allStats;\n};\n\nexport const getRateStats = (\n  stats: PlayerStats\n): Required<\n  Pick<\n    PlayerStats,\n    | 'battingAverage'\n    | 'onBasePercentage'\n    | 'sluggingPercentage'\n    | 'isolatedPower'\n    | 'onBasePlusSlugging'\n  >\n> => {\n  const battingAverage = stats.hits / stats.atBats;\n  const onBasePercentage =\n    (stats.hits + stats.walks) / (stats.atBats + stats.walks + stats.sacrificeFlies);\n  const sluggingPercentage =\n    (stats.hits + stats.doubles + 2 * stats.triples + 3 * stats.homeRuns) / stats.atBats;\n  return {\n    battingAverage,\n    onBasePercentage,\n    sluggingPercentage,\n    onBasePlusSlugging: onBasePercentage + sluggingPercentage,\n    isolatedPower: sluggingPercentage - battingAverage,\n  };\n};\n\nexport const formatDecimal = (val: number) => {\n  const formatted = val.toFixed(3);\n  return val >= 1 ? formatted : formatted.slice(1);\n};\n","import { createSelector } from '@reduxjs/toolkit';\nimport _ from 'lodash';\n\nimport { getGameHistory, getTeams } from 'state/game/selectors';\nimport { aggregateStats, getRateStats, initialStats, formatDecimal } from './stats';\n\nimport { BoxScoreRow } from './types';\n\nexport const getBoxScore = createSelector(getGameHistory, getTeams, (history, teams) => {\n  const allStats = aggregateStats(history);\n  return teams.map(({ lineup }) =>\n    lineup.map((playerId, index) => {\n      const playerStats = allStats[playerId] ?? initialStats;\n      return {\n        playerId,\n        lineupSpot: index + 1,\n        ...playerStats,\n        ..._.mapValues(getRateStats(playerStats), val =>\n          _.isNaN(val) ? '---' : formatDecimal(val)\n        ),\n      };\n    })\n  ) as [BoxScoreRow[], BoxScoreRow[]];\n});\n","import React, { FC } from 'react';\nimport { Box, Card, DataTable, Text } from 'grommet';\nimport { Redirect } from 'react-router-dom';\n\nimport { isGameInProgress, getPlayerPosition } from 'state/game/selectors';\nimport { getShortPlayerName } from 'state/players/selectors';\nimport { getBoxScore } from 'state/stats/selectors';\nimport { useAppSelector } from 'utils/hooks';\nimport { getPositionAbbreviation } from 'utils/labels';\n\nimport { TeamRole } from 'state/game/types';\nimport { BoxScoreRow } from 'state/stats/types';\n\ninterface NameCellProps {\n  playerId: string;\n  lineupSpot: number;\n}\n\nconst NameCell: FC<NameCellProps> = ({ playerId, lineupSpot }) => {\n  const name = useAppSelector(state => getShortPlayerName(state, playerId));\n  const position = useAppSelector(state => getPlayerPosition(state, playerId));\n\n  return (\n    <Box direction=\"row\" align=\"center\" gap=\"xsmall\">\n      <Text size=\"small\" color=\"dark-3\">\n        {lineupSpot}\n      </Text>\n      <Text weight=\"bold\" style={{ whiteSpace: 'nowrap' }}>\n        {name}\n      </Text>\n      <Text style={{ fontStyle: 'italic' }}>{getPositionAbbreviation(position)}</Text>\n    </Box>\n  );\n};\n\ninterface TeamBoxScoreProps {\n  rows: BoxScoreRow[];\n  team: TeamRole;\n}\n\nconst TeamBoxScore: FC<TeamBoxScoreProps> = ({ rows, team }) => {\n  return (\n    <Card pad=\"small\" background=\"light-1\" margin=\"small\">\n      <DataTable<BoxScoreRow>\n        margin=\"small\"\n        columns={[\n          {\n            property: 'playerId',\n            header: <Text>{team === TeamRole.AWAY ? 'Away' : 'Home'} Batters</Text>,\n            primary: true,\n            render: ({ playerId, lineupSpot }) => (\n              <NameCell playerId={playerId} lineupSpot={lineupSpot} />\n            ),\n          },\n          { property: 'atBats', header: 'AB' },\n          { property: 'runsScored', header: 'R' },\n          { property: 'hits', header: 'H' },\n          { property: 'runsBattedIn', header: 'RBI' },\n          { property: 'walks', header: 'BB' },\n          { property: 'leftOnBase', header: 'LOB' },\n          { property: 'battingAverage', header: 'AVG' },\n          { property: 'onBasePlusSlugging', header: 'OPS' },\n        ]}\n        data={rows}\n      />\n    </Card>\n  );\n};\n\nconst BoxScore = () => {\n  const gameInProgress = useAppSelector(isGameInProgress);\n  const [awayStats, homeStats] = useAppSelector(getBoxScore);\n\n  if (!gameInProgress) {\n    return <Redirect to=\"/teams\" />;\n  }\n\n  return (\n    <Box flex direction=\"row\" wrap justify=\"around\" align=\"center\">\n      <TeamBoxScore rows={awayStats} team={TeamRole.AWAY} />\n      <TeamBoxScore rows={homeStats} team={TeamRole.HOME} />\n    </Box>\n  );\n};\n\nexport default BoxScore;\n","import React, { FC } from 'react';\nimport { Text, Box } from 'grommet';\n\nimport { getPlateAppearanceLabel } from 'utils/labels';\n\nimport { PlateAppearanceType } from 'state/game/types';\nimport { PlayDescription } from 'state/plays/types';\n\nconst PlayTypeTag: FC<{ type: PlateAppearanceType }> = ({ type }) => {\n  let background = '';\n  switch (type) {\n    case PlateAppearanceType.WALK:\n      background = 'neutral-1';\n      break;\n    case PlateAppearanceType.OUT:\n    case PlateAppearanceType.FIELDERS_CHOICE:\n    case PlateAppearanceType.DOUBLE_PLAY:\n      background = 'neutral-4';\n      break;\n    default:\n      background = 'neutral-3';\n      break;\n  }\n  return (\n    <Box\n      round={{ size: '2px' }}\n      background={background}\n      alignSelf=\"center\"\n      pad={{ vertical: 'xxsmall', horizontal: 'xsmall' }}\n      flex={false}\n    >\n      <Text size=\"xsmall\">{getPlateAppearanceLabel(type).toUpperCase()}</Text>\n    </Box>\n  );\n};\n\nconst ScoreTag: FC<{ score: [number, number] }> = ({ score: [away, home] }) => (\n  <Box\n    round={{ size: '2px' }}\n    border\n    alignSelf=\"start\"\n    pad={{ vertical: 'xxsmall', horizontal: 'xsmall' }}\n    flex={false}\n    margin={{ top: 'xsmall' }}\n  >\n    <Text size=\"xsmall\">\n      AWAY {away} - HOME {home}\n    </Text>\n  </Box>\n);\n\nconst Play: FC<PlayDescription> = ({ description, outs, score, type }) => (\n  <Box pad={{ vertical: 'small' }} direction=\"row\" justify=\"between\" gap=\"xsmall\">\n    <Box>\n      <Text>\n        <Text>{description}</Text>\n        {outs && (\n          <Text weight=\"bold\" margin={{ left: 'xsmall' }}>\n            {outs} {outs > 1 ? 'outs' : 'out'}{' '}\n          </Text>\n        )}\n      </Text>\n      {score && <ScoreTag score={score} />}\n    </Box>\n    {type && <PlayTypeTag type={type} />}\n  </Box>\n);\n\nexport default Play;\n","import React, { FC } from 'react';\nimport { Card, CardHeader, Text, CardBody } from 'grommet';\n\nimport Play from './Play';\n\nimport { getOrdinalInning } from 'utils/labels';\n\nimport { HalfInning } from 'state/game/types';\nimport { HalfInningPlaysGroup } from 'state/plays/types';\n\nconst HalfInningPlays: FC<HalfInningPlaysGroup> = ({ inning, halfInning, plays }) => (\n  <Card background=\"light-1\">\n    <CardHeader background=\"light-2\" pad=\"medium\">\n      <Text>\n        {halfInning === HalfInning.TOP ? 'Top' : 'Bottom'} {getOrdinalInning(inning)}\n      </Text>\n    </CardHeader>\n    <CardBody pad={{ horizontal: 'medium', vertical: 'small' }} gap=\"small\" border=\"between\">\n      {plays.map((play, i) => (\n        <Play key={i} {...play} />\n      ))}\n    </CardBody>\n  </Card>\n);\n\nexport default HalfInningPlays;\n","import _ from 'lodash';\n\nimport { getNewBase, getBaseForRunner, forEachRunner } from 'state/game/utils';\nimport { formatShortBaseName, getHitLabelFromContact } from 'utils/labels';\n\nimport {\n  PlateAppearanceType,\n  FieldingPosition,\n  ContactType,\n  HitContactType,\n  RecordedPlay,\n  BaseType,\n  HitType,\n} from 'state/game/types';\nimport { RawPlayDescription } from './types';\n\nconst getPositionTitle = (position: FieldingPosition) =>\n  ({\n    [FieldingPosition.PITCHER]: 'pitcher',\n    [FieldingPosition.CATCHER]: 'catcher',\n    [FieldingPosition.FIRST_BASE]: 'first baseman',\n    [FieldingPosition.SECOND_BASE]: 'second baseman',\n    [FieldingPosition.THIRD_BASE]: 'third baseman',\n    [FieldingPosition.SHORTSTOP]: 'shortstop',\n    [FieldingPosition.LEFT_FIELD]: 'left fielder',\n    [FieldingPosition.CENTER_FIELD]: 'center fielder',\n    [FieldingPosition.LEFT_CENTER]: 'left center fielder',\n    [FieldingPosition.RIGHT_CENTER]: 'right center fielder',\n    [FieldingPosition.RIGHT_FIELD]: 'right fielder',\n  }[position]);\n\nconst getContactVerb = (contactType: ContactType) =>\n  ({\n    [ContactType.NONE]: 'strikes',\n    [ContactType.GROUNDER]: 'grounds',\n    [ContactType.LAZY_FLY]: 'flies',\n    [ContactType.LINE_DRIVE]: 'lines',\n    [ContactType.LONG_FLY]: 'flies',\n    [ContactType.POPUP]: 'pops',\n  }[contactType]);\n\nconst getHitVerb = (hitType: HitType) =>\n  ({\n    [PlateAppearanceType.SINGLE]: 'singles',\n    [PlateAppearanceType.DOUBLE]: 'doubles',\n    [PlateAppearanceType.TRIPLE]: 'triples',\n    [PlateAppearanceType.HOMERUN]: 'homers',\n  }[hitType]);\n\nconst formatBaseName = (base: BaseType | null) => {\n  if (base === null) return 'home';\n  return {\n    [BaseType.FIRST]: '1st base',\n    [BaseType.SECOND]: '2nd base',\n    [BaseType.THIRD]: '3rd base',\n  }[base];\n};\n\nconst makeOutPhrase = (runnerId: string, base: BaseType | null) =>\n  `{${runnerId}} out at ${formatShortBaseName(base)}.`;\n\nexport const getPlayDescription = ({\n  gameState,\n  event,\n  runnersScored,\n  runnersAfter,\n  scoreAfter,\n}: RecordedPlay): RawPlayDescription => {\n  const sentences: string[] = [];\n  const playerIds: string[] = [];\n  let position: FieldingPosition | undefined;\n  let newNumOuts: number | undefined;\n  let newScore: [number, number] | undefined;\n\n  const finishSentence = (parts: string[]) => {\n    sentences.push([...parts, '.'].join(''));\n  };\n\n  if (event.kind === 'stolenBaseAttempt') {\n    const endBase = getNewBase(getBaseForRunner(gameState.runners, event.runnerId));\n    if (event.success) {\n      sentences.push(`{${event.runnerId}} steals ${formatBaseName(endBase)}.`);\n    } else {\n      sentences.push(`{${event.runnerId}} is caught stealing ${formatBaseName(endBase)}.`);\n      newNumOuts = gameState.outs + 1;\n    }\n    playerIds.push(event.runnerId);\n  } else {\n    const { atBat, runners, outs } = gameState;\n    const { fieldedBy, contactType, runnersOutOnPlay, basesTaken, outsOnBasepaths } = event;\n    playerIds.push(atBat);\n    const fielderToken = fieldedBy && `${getPositionTitle(fieldedBy)} {${fieldedBy}}`;\n\n    switch (event.type) {\n      case PlateAppearanceType.WALK:\n        sentences.push(`{${atBat}} walks.`);\n        break;\n      case PlateAppearanceType.FIELDERS_CHOICE: {\n        const parts = [`{${atBat}} hits into a fielder's choice`];\n        if (fielderToken) {\n          parts.push(`, fielded by ${fielderToken}`);\n          position = event.fieldedBy;\n        }\n        finishSentence(parts);\n        sentences.push(\n          makeOutPhrase(\n            runnersOutOnPlay[0],\n            getNewBase(getBaseForRunner(runners, runnersOutOnPlay[0]))\n          )\n        );\n        playerIds.push(runnersOutOnPlay[0]);\n        newNumOuts = outs + 1;\n        break;\n      }\n      case PlateAppearanceType.SACRIFICE_FLY: {\n        const parts = [`{${atBat}} out on a sacrifice fly`];\n        if (fielderToken) {\n          parts.push(` to ${fielderToken}`);\n          position = fieldedBy;\n        }\n        finishSentence(parts);\n        newNumOuts = outs + 1;\n        break;\n      }\n      case PlateAppearanceType.DOUBLE_PLAY:\n        sentences.push(`{${atBat}} ${getContactVerb(contactType!)} into a double play.`);\n        runnersOutOnPlay.forEach(runnerId => {\n          let outBase: BaseType | null;\n          if (runnerId === atBat) {\n            outBase = BaseType.FIRST;\n          } else {\n            const startBase = getBaseForRunner(runners, runnerId);\n            outBase = contactType === ContactType.GROUNDER ? getNewBase(startBase) : startBase;\n          }\n          if (contactType === ContactType.GROUNDER || runnerId !== atBat) {\n            sentences.push(makeOutPhrase(runnerId, outBase));\n            playerIds.push(runnerId);\n          }\n        });\n        newNumOuts = outs + 2;\n        break;\n      case PlateAppearanceType.OUT: {\n        const parts = [`{${atBat}} ${getContactVerb(contactType!)} out`];\n        if (contactType !== ContactType.NONE && fielderToken) {\n          parts.push(` to ${fielderToken}`);\n          position = fieldedBy;\n        }\n        finishSentence(parts);\n        newNumOuts = outs + 1;\n        break;\n      }\n      case PlateAppearanceType.HOMERUN:\n      case PlateAppearanceType.TRIPLE:\n      case PlateAppearanceType.DOUBLE:\n      case PlateAppearanceType.SINGLE: {\n        const parts: string[] = [];\n        if (event.type === PlateAppearanceType.HOMERUN && _.size(runners) === 3) {\n          parts.push(`{${atBat}} hits a grand slam`);\n        } else {\n          parts.push(`{${atBat}} ${getHitVerb(event.type)}`);\n        }\n        if (contactType) {\n          parts.push(\n            ` on a ${getHitLabelFromContact(contactType as HitContactType).toLowerCase()}`\n          );\n        }\n        if (fieldedBy) {\n          const token =\n            event.type === PlateAppearanceType.HOMERUN\n              ? getPositionTitle(fieldedBy).slice(0, -2)\n              : fielderToken;\n          parts.push(` to ${token}`);\n          position = fieldedBy;\n        }\n        finishSentence(parts);\n        break;\n      }\n    }\n    if (runnersScored.length) {\n      runnersScored.forEach(runnerId => {\n        if (runnerId !== atBat) {\n          sentences.push(`{${runnerId}} scores.`);\n          playerIds.push(runnerId);\n        }\n      });\n      newScore = scoreAfter;\n    }\n    forEachRunner(runnersAfter, (runnerId, base) => {\n      if (runners[base] !== runnerId && runnerId !== atBat) {\n        sentences.push(`{${runnerId}} to ${formatShortBaseName(base)}.`);\n        playerIds.push(runnerId);\n      }\n    });\n    _.forEach(outsOnBasepaths, (base, runnerId) => {\n      sentences.push(`{${runnerId}} thrown out at ${formatShortBaseName(base)}.`);\n      playerIds.push(runnerId);\n      newNumOuts = (newNumOuts ?? outs) + 1;\n    });\n    if (atBat in basesTaken) {\n      sentences.push(`{${atBat}} to ${formatShortBaseName(basesTaken[atBat])} on the throw.`);\n    }\n  }\n\n  return {\n    description: sentences.join(' '),\n    playerIds,\n    position,\n    newNumOuts,\n    newScore,\n  };\n};\n","import { createSelector } from '@reduxjs/toolkit';\nimport _ from 'lodash';\n\nimport { getFuture, getGameHistory, getPlayerAtPosition } from 'state/game/selectors';\nimport { getShortPlayerName } from 'state/players/selectors';\nimport { getPlayDescription } from './plays';\n\nimport { HalfInning, RecordedPlay } from 'state/game/types';\nimport { AppState } from 'state/store';\nimport { HalfInningPlaysGroup, PlayDescription } from './types';\n\nconst makeInterpolatedPlayDescription = (state: AppState, play: RecordedPlay): PlayDescription => {\n  const { description, playerIds, position, newNumOuts, newScore } = getPlayDescription(play);\n  let interpolatedDescription = description;\n  if (position) {\n    interpolatedDescription = description.replace(\n      new RegExp(`{${position}}`),\n      getShortPlayerName(state, getPlayerAtPosition(state, 1 - play.gameState.halfInning, position))\n    );\n  }\n  playerIds.forEach(playerId => {\n    interpolatedDescription = interpolatedDescription.replace(\n      new RegExp(`{${playerId}}`, 'g'),\n      getShortPlayerName(state, playerId)\n    );\n  });\n\n  return {\n    description: interpolatedDescription,\n    outs: newNumOuts,\n    score: newScore,\n    type: play.event.kind === 'plateAppearance' ? play.event.type : undefined,\n  };\n};\n\nexport const getAllPlays = createSelector(\n  getGameHistory,\n  state => state,\n  (history, state): HalfInningPlaysGroup[] => {\n    const groupedPlaysByInning = history.reduce((groupedPlays, play) => {\n      const { inning, halfInning } = play.gameState;\n      if (!groupedPlays.length) {\n        groupedPlays.push({ inning, halfInning, plays: [play] });\n      } else {\n        const lastGroup = _.last(groupedPlays)!;\n        if (lastGroup.inning !== inning || lastGroup.halfInning !== halfInning) {\n          groupedPlays.push({ inning, halfInning, plays: [play] });\n        } else {\n          lastGroup.plays.push(play);\n        }\n      }\n      return groupedPlays;\n    }, [] as { inning: number; halfInning: HalfInning; plays: RecordedPlay[] }[]);\n\n    return groupedPlaysByInning.map(({ inning, halfInning, plays }) => ({\n      inning,\n      halfInning,\n      plays: plays.map(play => makeInterpolatedPlayDescription(state, play)),\n    }));\n  }\n);\n\nexport const getScoringPlays = createSelector(getAllPlays, groups =>\n  groups\n    .map(({ inning, halfInning, plays }) => ({\n      inning,\n      halfInning,\n      plays: plays.filter(play => !!play.score),\n    }))\n    .filter(group => group.plays.length)\n);\n\nexport const getLastPlay = createSelector(\n  getGameHistory,\n  state => state,\n  (history, state) => {\n    const lastPlay = _.last(history);\n    return lastPlay && makeInterpolatedPlayDescription(state, lastPlay);\n  }\n);\n\nexport const getNextPlay = createSelector(\n  getFuture,\n  state => state,\n  (future, state) => {\n    const nextPlay = _.last(_.first(future)?.gameHistory);\n    return nextPlay && makeInterpolatedPlayDescription(state, nextPlay);\n  }\n);\n","import React, { useCallback, useMemo, useState } from 'react';\nimport { Text, Box, Heading, ThemeContext } from 'grommet';\nimport _ from 'lodash';\nimport { Redirect } from 'react-router-dom';\n\nimport HalfInningPlays from './HalfInningPlays';\n\nimport { getInning, isGameInProgress } from 'state/game/selectors';\nimport { getAllPlays, getScoringPlays } from 'state/plays/selectors';\nimport { useAppSelector } from 'utils/hooks';\n\nconst Plays = () => {\n  const gameStarted = useAppSelector(isGameInProgress);\n  const scoringPlays = useAppSelector(getScoringPlays);\n  const allPlays = useAppSelector(getAllPlays);\n  const currentInning = useAppSelector(getInning);\n\n  const [selectedInning, setSelectedInning] = useState(currentInning);\n\n  const allPlaysForInning = useMemo(\n    () => allPlays.filter(({ inning }) => inning === selectedInning),\n    [allPlays, selectedInning]\n  );\n\n  const selectInning = useCallback(\n    (inning: number) => () => {\n      setSelectedInning(inning);\n    },\n    [setSelectedInning]\n  );\n\n  if (!gameStarted) {\n    return <Redirect to=\"/teams\" />;\n  }\n\n  return (\n    <Box pad=\"medium\" flex={{ shrink: 0 }} basis=\"auto\" gap=\"small\">\n      <Box direction=\"row\" justify=\"between\">\n        <Heading level={4} margin=\"none\">\n          Scoring\n        </Heading>\n        <Heading level={4} alignSelf=\"end\" margin=\"none\">\n          All Plays\n        </Heading>\n      </Box>\n      <Box direction=\"row\" gap=\"small\">\n        <Box gap=\"small\" basis=\"0\" flex>\n          {scoringPlays.map(group => (\n            <HalfInningPlays key={`${group.inning}_${group.halfInning}`} {...group} />\n          ))}\n        </Box>\n        <Box gap=\"small\" basis=\"0\" flex margin={{ left: 'small' }}>\n          {!allPlaysForInning.length && <Text alignSelf=\"center\">No plays yet this inning.</Text>}\n          {allPlaysForInning.map(group => (\n            <HalfInningPlays key={`${group.inning}_${group.halfInning}`} {...group} />\n          ))}\n        </Box>\n        <ThemeContext.Extend value={{ global: { size: { xxsmall: '32px' } } }}>\n          <Box gap=\"xsmall\" flex={false}>\n            {_.range(1, currentInning + 1).map(inning => (\n              <Box\n                key={inning}\n                round={{ size: '4px' }}\n                border={{ size: 'small' }}\n                width=\"xxsmall\"\n                height=\"xxsmall\"\n                justify=\"center\"\n                align=\"center\"\n                hoverIndicator={!(inning === selectedInning)}\n                background={inning === selectedInning ? 'brand' : undefined}\n                onClick={selectInning(inning)}\n              >\n                <Text>{inning}</Text>\n              </Box>\n            ))}\n          </Box>\n        </ThemeContext.Extend>\n      </Box>\n    </Box>\n  );\n};\n\nexport default Plays;\n","import { ThemeType } from 'grommet';\n\nconst theme: ThemeType = {\n  global: {\n    colors: {\n      brand: '#1c5253',\n      'accent-3': '#C3DFE0',\n      'status-critical-light': '#ffcccc',\n    },\n    focus: {\n      outline: {\n        color: 'transparent',\n      },\n    },\n  },\n  rangeInput: {\n    track: {\n      height: '6px',\n      extend: {\n        borderRadius: '3px',\n      },\n    },\n  },\n  accordion: {\n    border: undefined,\n  },\n};\n\nexport default theme;\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport _ from 'lodash';\nimport { v1 as uuidv1 } from 'uuid';\n\nimport { Player, NewPlayer, NewPlayerWithId, PlayerStats } from './types';\n\nconst initialStats: PlayerStats = {\n  atBats: 0,\n  hits: 0,\n  doubles: 0,\n  triples: 0,\n  homeRuns: 0,\n  walks: 0,\n  stolenBases: 0,\n  caughtStealing: 0,\n  runsBattedIn: 0,\n  runsScored: 0,\n  strikeouts: 0,\n  sacrificeFlies: 0,\n  groundIntoDoublePlays: 0,\n  leftOnBase: 0,\n};\n\nconst doesPlayerExist = (newPlayer: NewPlayer, players: Record<string, Player>) =>\n  _.some(\n    players,\n    player => player.firstName === newPlayer.firstName && player.lastName === newPlayer.lastName\n  );\n\nconst { actions, reducer } = createSlice({\n  name: 'players',\n  initialState: {} as Record<string, Player>,\n  reducers: {\n    addPlayer: {\n      reducer(state, { payload }: PayloadAction<NewPlayerWithId>) {\n        if (!doesPlayerExist(payload, state)) {\n          state[payload.playerId] = { ...payload, games: 0, stats: initialStats };\n        }\n      },\n      prepare: (player: NewPlayer) => ({ payload: { ...player, playerId: uuidv1() } }),\n    },\n  },\n});\n\nexport const { addPlayer } = actions;\nexport default reducer;\n","export const players = [\n  'Sam Myers',\n  'Steven Chan',\n  'Cameron Walls',\n  'Carlos Ortega',\n  'Yukhi Yamashita',\n  'James Lockwood',\n  'Matthew Chinn',\n  'Jason Tong',\n  'Andrew Silva',\n  'Quincy Zhao',\n  'Dale Zelmon',\n  'Wynn Padula',\n  'Leland Bailey',\n  'Michael Cross',\n  'Brendan Wilson',\n  'Dan Keating',\n  'Max Bruk',\n  'Hector Franco',\n  'Mike Basta',\n];\n","import { Box, Button, Heading, Main } from 'grommet';\nimport React, { useCallback } from 'react';\nimport { Redirect } from 'react-router-dom';\n\nimport {\n  getCurrentGameLength,\n  getGameStatus,\n  getMaxGameLength,\n  getScore,\n} from 'state/game/selectors';\nimport { gameActions } from 'state/game/slice';\nimport { GameStatus } from 'state/game/types';\nimport { useAppDispatch, useAppSelector } from 'utils/hooks';\n\nconst GameOver = () => {\n  const dispatch = useAppDispatch();\n\n  const gameStatus = useAppSelector(getGameStatus);\n  const [awayScore, homeScore] = useAppSelector(getScore);\n  const gameLength = useAppSelector(getCurrentGameLength);\n  const maxGameLength = useAppSelector(getMaxGameLength);\n\n  const onClickExtendGame = useCallback(() => {\n    dispatch(gameActions.extendGame());\n  }, [dispatch]);\n\n  const onClickResetGame = useCallback(() => {\n    dispatch(gameActions.resetGame());\n  }, [dispatch]);\n\n  const onClickFullResetGame = useCallback(() => {\n    dispatch(gameActions.fullResetGame());\n  }, [dispatch]);\n\n  if (gameStatus === GameStatus.IN_PROGRESS) {\n    return <Redirect to=\"/field\" />;\n  }\n  if (gameStatus === GameStatus.NOT_STARTED) {\n    return <Redirect to=\"/teams\" />;\n  }\n\n  return (\n    <Main flex background=\"brand\" justify=\"center\" align=\"center\">\n      <Box align=\"center\">\n        <Heading level={2} margin={{ bottom: 'small' }}>\n          {awayScore > homeScore ? 'Away' : 'Home'} team wins!\n        </Heading>\n        <Heading margin={{ bottom: 'large' }}>\n          {awayScore} - {homeScore}\n        </Heading>\n      </Box>\n      <Box gap=\"small\">\n        {gameLength < maxGameLength && (\n          <Button\n            color=\"light-1\"\n            plain={false}\n            label=\"Play another inning\"\n            onClick={onClickExtendGame}\n          />\n        )}\n        <Button\n          color=\"status-ok\"\n          plain={false}\n          label=\"New Game (same teams)\"\n          onClick={onClickResetGame}\n        />\n        <Button\n          color=\"status-ok\"\n          plain={false}\n          label=\"New Game (reset teams)\"\n          onClick={onClickFullResetGame}\n        />\n      </Box>\n    </Main>\n  );\n};\n\nexport default GameOver;\n","import React, { useEffect } from 'react';\nimport { Grommet, Main, Box } from 'grommet';\nimport { Switch, Route, Redirect, useLocation, useHistory } from 'react-router-dom';\n\nimport TopBar from './TopBar';\nimport Bases from './Bases';\nimport Teams from './Teams';\nimport BoxScore from './BoxScore';\nimport Plays from './plays/Plays';\n\nimport theme from 'theme';\nimport { isGameOver } from 'state/game/selectors';\nimport { addPlayer } from 'state/players/slice';\nimport { players } from 'state/players/testData';\nimport { useMount, useAppDispatch, useAppSelector } from 'utils/hooks';\nimport GameOver from './GameOver';\n\nconst App = () => {\n  const dispatch = useAppDispatch();\n\n  const { pathname } = useLocation();\n  const history = useHistory();\n\n  const gameOver = useAppSelector(isGameOver);\n\n  useMount(() => {\n    players.forEach(player => {\n      const [firstName, lastName] = player.split(' ');\n      dispatch(addPlayer({ firstName, lastName }));\n    });\n  });\n\n  useEffect(() => {\n    if (gameOver && pathname !== '/game-over') {\n      history.replace('/game-over');\n    }\n  }, [pathname, gameOver, history]);\n\n  return (\n    <Grommet full theme={theme}>\n      <Box height=\"100%\">\n        {!gameOver && <TopBar />}\n        <Main flex overflow={{ vertical: 'auto' }}>\n          <Switch>\n            <Route path=\"/game-over\">\n              <GameOver />\n            </Route>\n            <Route path=\"/teams\">\n              <Teams />\n            </Route>\n            <Route path=\"/field\">\n              <Bases />\n            </Route>\n            <Route path=\"/box-score\">\n              <BoxScore />\n            </Route>\n            <Route path=\"/plays\">\n              <Plays />\n            </Route>\n            <Route path=\"/\">\n              <Redirect to=\"/teams\" />\n            </Route>\n          </Switch>\n        </Main>\n      </Box>\n    </Grommet>\n  );\n};\n\nexport default App;\n","import { configureStore, getDefaultMiddleware } from '@reduxjs/toolkit';\nimport { persistStore, persistCombineReducers } from 'redux-persist';\nimport storage from 'redux-persist/lib/storage';\n\nimport game from './game/slice';\nimport players from './players/slice';\nimport prompts from './prompts/slice';\n\nconst reducer = persistCombineReducers(\n  { key: 'root', storage },\n  {\n    game,\n    players,\n    prompts,\n  }\n);\n\nexport const store = configureStore({\n  reducer,\n  middleware: getDefaultMiddleware({ serializableCheck: false, immutableCheck: false }),\n});\nexport const persistor = persistStore(store);\n\nexport type AppState = ReturnType<typeof store.getState>;\nexport type AppDispatch = typeof store.dispatch;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://cra.link/PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://cra.link/PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://cra.link/PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log('No internet connection found. App is running in offline mode.');\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then((registration) => {\n        registration.unregister();\n      })\n      .catch((error) => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Provider } from 'react-redux';\nimport { BrowserRouter } from 'react-router-dom';\nimport { PersistGate } from 'redux-persist/integration/react';\n\nimport App from 'components/App';\n\nimport { store, persistor } from 'state/store';\nimport reportWebVitals from './reportWebVitals';\nimport * as serviceWorkerRegistration from './serviceWorkerRegistration';\n\nimport './index.css';\n\nReactDOM.render(\n  <Provider store={store}>\n    <PersistGate loading={null} persistor={persistor}>\n      <BrowserRouter>\n        <React.StrictMode>\n          <App />\n        </React.StrictMode>\n      </BrowserRouter>\n    </PersistGate>\n  </Provider>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://cra.link/PWA\nserviceWorkerRegistration.register();\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}